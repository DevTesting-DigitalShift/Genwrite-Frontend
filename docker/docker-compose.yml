# =============================================================================
# GenWrite Frontend - Docker Compose (Production)
# =============================================================================
# Production configuration for GenWrite Frontend
# Usage: docker compose up -d
# =============================================================================

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Pass environment variables as build arguments
        # These are embedded during the Vite build process
        - VITE_API_URL=${VITE_API_URL}
        - VITE_GOOGLE_CLIENT_ID=${VITE_GOOGLE_CLIENT_ID}
        - VITE_STRIPE_PUBLIC_KEY=${VITE_STRIPE_PUBLIC_KEY}
        - VITE_RECAPTCHA_SITE_KEY=${VITE_RECAPTCHA_SITE_KEY}
        - VITE_SOCKET_URL=${VITE_SOCKET_URL}
        - VITE_GA_MEASUREMENT_ID=${VITE_GA_MEASUREMENT_ID}
    image: genwrite-frontend:latest
    container_name: genwrite-frontend
    ports:
      - "80:80"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 256M
        reservations:
          cpus: "0.25"
          memory: 128M
    # Logging configuration
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

# Optional: Network configuration
networks:
  default:
    name: genwrite-network
    driver: bridge
