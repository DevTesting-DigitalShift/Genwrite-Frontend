import{u as E,a as A,g as S,j as a,A as L,H as R,m as D,b as v}from"./index-BETk9C_M.js";import{b as s}from"./chunk-tiptap-Diw-eXXG.js";import{d as y}from"./dayjs.min-BeGhjYCo.js";import{l as _}from"./lodash-Bq_SkVDy.js";import{T as z,F as P}from"./index-CAWgie3R.js";import{I as M}from"./index-B-ey4HLH.js";import{R as G}from"./SearchOutlined-xQfelIMZ.js";import{S as u,E as k}from"./index-BJVh2y9F.js";import{S as F}from"./index-DFU1yNMm.js";import"./useIcons-DggjAwr7.js";import"./index-DxnGe-kA.js";import"./LeftOutlined-BVhGyULB.js";import"./EllipsisOutlined-Bx_He8-X.js";import"./Overflow-Clx5udWb.js";import"./Pagination-DhMnDdxh.js";import"./Input-BBXn3cf4.js";const{Option:g}=u,se=()=>{const l=E(),{logs:m,loading:p,totalLogs:b}=A(e=>e.creditLogs),[i,N]=s.useState(""),[o,O]=s.useState("24h"),[d,U]=s.useState([]),[r,c]=s.useState({current:1,pageSize:10}),I=[10,20,50,100],w=["BLOG_GENERATION","QUICK_BLOG_GENERATION","AI_PROOFREADING","COMPETITOR_ANALYSIS","SUBSCRIPTION_PAYMENT","OTHER"],C=s.useMemo(()=>_.debounce(e=>{N(e),c(t=>({...t,current:1}))},500),[]),x=e=>{const t=y();switch(e){case"24h":return{start:t.subtract(24,"hours").startOf("hour").toISOString(),end:t.endOf("hour").toISOString()};case"7d":return{start:t.subtract(7,"days").startOf("day").toISOString(),end:t.endOf("day").toISOString()};case"30d":return{start:t.subtract(30,"days").startOf("day").toISOString(),end:t.endOf("day").toISOString()};default:return{}}};s.useEffect(()=>{const e={page:r.current,limit:r.pageSize,...x(o)};l(S(e))},[l,o,r.current,r.pageSize]);const T=s.useMemo(()=>{let e=m;return i&&(e=e.filter(t=>{var n,h;return(h=(n=t.metadata)==null?void 0:n.title)==null?void 0:h.toLowerCase().includes(i.toLowerCase())})),d.length>0&&(e=e.filter(t=>d.includes(t.purpose))),e},[m,i,d]),f={BLOG_GENERATION:"bg-blue-100 text-blue-700",QUICK_BLOG_GENERATION:"bg-indigo-100 text-indigo-700",AI_PROOFREADING:"bg-green-100 text-green-700",COMPETITOR_ANALYSIS:"bg-yellow-100 text-yellow-800",SUBSCRIPTION_PAYMENT:"bg-purple-100 text-purple-700",OTHER:"bg-gray-100 text-gray-700"},j=s.useMemo(()=>[{title:"Blog Topic",dataIndex:["metadata","title"],key:"blogTitle",render:e=>a.jsx("div",{children:a.jsx("span",{className:"text-sm text-gray-700 capitalize",children:e||"-"})})},{title:"Date",dataIndex:"createdAt",key:"createdAt",sorter:(e,t)=>new Date(e.createdAt)-new Date(t.createdAt),render:e=>a.jsx("span",{className:"text-sm text-gray-600",children:y(e).format("DD MMM YYYY, hh:mm A")})},{title:"Type",dataIndex:"category",key:"category",filters:[{text:"Deduction",value:"DEDUCTION"},{text:"Adjustment",value:"ADJUSTMENT"}],onFilter:(e,t)=>t.category===e,render:e=>a.jsx(z,{color:e==="DEDUCTION"?"red":"green",className:"font-medium px-3 py-1 rounded-full text-xs",children:e})},{title:"Purpose",dataIndex:"purpose",key:"purpose",filters:w.map(e=>({text:e.toLowerCase().replace(/_/g," "),value:e})),onFilter:(e,t)=>t.purpose===e,render:e=>{const t=f[e]||"bg-gray-100 text-gray-700",n=(e==null?void 0:e.toLowerCase().replace(/_/g," "))||"-";return a.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-semibold capitalize ${t}`,children:n})}},{title:"Amount",dataIndex:"amount",key:"amount",sorter:(e,t)=>e.amount-t.amount,render:e=>a.jsx("span",{className:`font-semibold ${e<0?"text-red-500":"text-green-600"}`,children:e>0?`+${e}`:e})},{title:"Remaining Credits",dataIndex:"remainingCredits",key:"remainingCredits",render:e=>a.jsx("span",{className:"text-sm font-medium text-gray-800",children:e})}],[f]);return s.useEffect(()=>{const e=v();if(!e)return;const t=n=>{r.current===1&&l(S({page:1,limit:r.pageSize,...x(o)}))};return e.on("credit-log",t),()=>{e.off("credit-log",t)}},[l,o,r.pageSize,r.current]),a.jsxs(L,{children:[a.jsx(R,{children:a.jsx("title",{children:"Credit Logs | GenWrite"})}),a.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3},className:"p-6 bg-white rounded-2xl shadow-md border border-gray-200",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[a.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Credit Logs"}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[a.jsx(M,{prefix:a.jsx(G,{className:"text-gray-400"}),placeholder:"Search by blog title",onChange:e=>C(e.target.value),className:"w-full sm:w-64 rounded-lg border-gray-300 hover:border-blue-400 transition-all","aria-label":"Search credit logs by blog title"}),a.jsxs(u,{value:o,onChange:e=>{O(e),c(t=>({...t,current:1}))},className:"w-full sm:w-48 rounded-lg",popupClassName:"rounded-lg","aria-label":"Select date range",children:[a.jsx(g,{value:"24h",children:"Last 24 Hours"}),a.jsx(g,{value:"7d",children:"Last 7 Days"}),a.jsx(g,{value:"30d",children:"Last 30 Days"})]}),a.jsx(u,{value:r.pageSize,onChange:e=>c(t=>({...t,pageSize:e,current:1})),options:I.map(e=>({label:`${e} / page`,value:e})),className:"w-full sm:w-32 rounded-lg",popupClassName:"rounded-lg","aria-label":"Select page size"})]})]}),a.jsx(P,{dataSource:T,columns:j,loading:p,rowKey:"_id",pagination:{current:r.current,pageSize:r.pageSize,total:b,showSizeChanger:!1,showTotal:e=>`Total ${e} logs`,onChange:(e,t)=>{c({current:e,pageSize:t})}},className:"rounded-xl overflow-hidden",rowClassName:"hover:bg-gray-50 transition-colors duration-200",bordered:!1,scroll:{x:"max-content"},locale:{emptyText:p?a.jsx(F,{tip:"Loading logs..."}):a.jsx(k,{description:i||d.length>0?"No logs match the filters":"No logs found"})}})]})]})};export{se as default};
