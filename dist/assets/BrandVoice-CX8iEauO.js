var ee=Object.defineProperty,ae=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var H=(d,t,n)=>t in d?ee(d,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[t]=n,u=(d,t)=>{for(var n in t||(t={}))te.call(t,n)&&H(d,n,t[n]);if($)for(var n of $(t))re.call(t,n)&&H(d,n,t[n]);return d},h=(d,t)=>ae(d,se(t));var O=(d,t,n)=>new Promise((f,b)=>{var N=m=>{try{s(n.next(m))}catch(o){b(o)}},L=m=>{try{s(n.throw(m))}catch(o){b(o)}},s=m=>m.done?f(m.value):Promise.resolve(m.value).then(N,L);s((n=n.apply(d,t)).next())});import{a as q,u as ie,aH as oe,r as l,aN as D,X as j,aO as ne,aP as le,V as de,aQ as ce,aR as me,j as e,m as p,H as pe,T as I,Z as xe}from"./index-DWalI_BQ.js";import{F as ue,a as he}from"./index-UbubGxr9.js";import{u as fe}from"./useQuery-CBPUTn-x.js";import{I as R}from"./info-bykb9H9p.js";import{L as T}from"./loader-circle-Cy3zQqBA.js";import{U as be}from"./upload-USvCu144.js";import"./iconBase-D4xs-Ft-.js";import"./createLucideIcon-Cuzl3erx.js";const Ue=()=>{const d=q(a=>a.auth.user),t=ie(),n=oe(),[f,b]=l.useState(""),[N,L]=l.useState(!1),[s,m]=l.useState({nameOfVoice:"",postLink:"",keywords:[],describeBrand:"",sitemapUrl:"",selectedVoice:null,_id:void 0}),[o,g]=l.useState({}),{siteInfo:w}=q(a=>a.brand),[B,C]=l.useState(""),[E,y]=l.useState(!1),[U,_]=l.useState(!1),{data:k=[],isLoading:A,error:we}=fe({queryKey:["brands"],queryFn:()=>O(null,null,function*(){return yield t(xe()).unwrap()})});l.useEffect(()=>(s._id||V(),()=>{V(),t(D())}),[t]),l.useEffect(()=>{w.data&&!E&&(m(a=>h(u({},a),{nameOfVoice:w.data.nameOfVoice||a.nameOfVoice,describeBrand:w.data.describeBrand||a.describeBrand,keywords:w.data.keywords||a.keywords,postLink:w.data.postLink||a.postLink,sitemapUrl:w.data.sitemap||a.sitemapUrl})),g(a=>h(u({},a),{nameOfVoice:void 0,describeBrand:void 0,keywords:void 0,postLink:void 0,sitemapUrl:void 0})),C(s.postLink))},[w,s.postLink,E]);const V=l.useCallback(()=>{m({nameOfVoice:"",postLink:"",keywords:[],describeBrand:"",sitemapUrl:"",selectedVoice:k&&k.length>0?k[0]:null,_id:void 0}),b(""),g({}),C(""),y(!0),_(!1)},[k]),P=l.useCallback(()=>{const a={};if(s.nameOfVoice.trim()||(a.nameOfVoice="Name of Voice is required."),!s.postLink.trim())a.postLink="Post link is required.";else try{new URL(s.postLink)}catch(r){a.postLink="Please enter a valid URL (e.g., https://example.com)."}if(s.keywords.length===0&&(a.keywords="At least one keyword is required."),s.describeBrand.trim()||(a.describeBrand="Brand description is required."),!s.sitemapUrl.trim())a.sitemapUrl="Sitemap URL is required.";else try{new URL(s.sitemapUrl)}catch(r){a.sitemapUrl="Please enter a valid URL (e.g., https://example.com/sitemap.xml)."}return g(a),Object.keys(a).length===0},[s]),S=l.useCallback(a=>{const{name:r,value:i}=a.target;m(c=>h(u({},c),{[r]:i})),g(c=>h(u({},c),{[r]:void 0})),r==="postLink"&&i!==B&&C(""),y(!1)},[B]),z=l.useCallback(a=>{if(a.key==="Enter"&&f.trim()){a.preventDefault();const r=s.keywords.map(x=>x.toLowerCase()),i=new Set,c=f.split(",").map(x=>x.trim()).filter(x=>{const F=x.toLowerCase();return!x||r.includes(F)||i.has(F)?!1:(i.add(F),!0)});if(c.length===0)return;m(x=>h(u({},x),{keywords:[...x.keywords,...c]})),b(""),g(x=>h(u({},x),{keywords:void 0})),y(!1)}},[f,s.keywords]),K=l.useCallback(a=>{m(r=>h(u({},r),{keywords:r.keywords.filter(i=>i!==a)})),y(!1)},[]),Q=l.useCallback(a=>{const r=a.target.files[0];if(!r)return;if(!r.name.toLowerCase().endsWith(".csv")){j.error("Invalid file type. Please upload a .csv file."),a.target.value=null;return}const i=20*1024;if(r.size>i){j.error("File size exceeds 20KB limit. Please upload a smaller file."),a.target.value=null;return}if(r.type!=="text/csv"){j.error("Please upload a valid CSV file."),a.target.value=null;return}const c=new FileReader;c.onload=x=>{const J=x.target.result.split(/,|\n|;/).map(v=>v.trim()).filter(v=>v.length>0);m(v=>h(u({},v),{keywords:[...new Set([...v.keywords,...J])]})),g(v=>h(u({},v),{keywords:void 0})),y(!1)},c.onerror=()=>j.error("Error reading CSV file."),c.readAsText(r),a.target.value=null},[]),M=l.useCallback(()=>O(null,null,function*(){if(!P())return;L(!0);const a={nameOfVoice:s.nameOfVoice.trim(),postLink:s.postLink.trim(),keywords:s.keywords.map(i=>i.trim()).filter(Boolean),describeBrand:s.describeBrand.trim(),sitemap:s.sitemapUrl.trim(),userId:d==null?void 0:d._id};if(k.some(i=>i.postLink===a.postLink&&(s._id?i._id!==s._id:!0))){j.error("A brand voice already exists with that name and link."),L(!1);return}try{s._id?yield t(ne({id:s._id,payload:a})).unwrap():yield t(le({payload:a})).unwrap(),V(),n.invalidateQueries(["brands"]),t(D())}catch(i){console.error("Error saving brand voice:",i),j.error(s._id?"Failed to update brand voice.":"Failed to create brand voice.")}finally{L(!1)}}),[s,d,t,P,V,k,n]),W=l.useCallback(a=>{m({nameOfVoice:a.nameOfVoice||"",postLink:a.postLink||"",keywords:Array.isArray(a.keywords)?a.keywords:[],describeBrand:a.describeBrand||"",sitemapUrl:a.sitemap||"",selectedVoice:a,_id:a._id}),g({}),C(a.postLink||""),y(!1),_(!1)},[]),Y=l.useCallback(a=>{de.confirm({title:"Delete Brand Voice?",content:"Are you sure you want to delete this brand voice? This action cannot be undone.",okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0,className:"px-3 sm:px-4 py-2"},cancelButtonProps:{className:"px-3 sm:px-4 py-2"},onOk:()=>O(null,null,function*(){var r;try{n.setQueryData(["brands"],(i=[])=>i.filter(c=>c._id!==a._id)),yield t(ce({id:a._id})).unwrap(),n.invalidateQueries(["brands"]),((r=s.selectedVoice)==null?void 0:r._id)===a._id&&(V(),t(D()))}catch(i){console.error("Failed to delete brand voice:",i),n.invalidateQueries(["brands"])}})})},[t,s.selectedVoice,V,n]),X=l.useCallback(a=>{m(r=>h(u({},r),{selectedVoice:a})),y(!1)},[]),G=l.useCallback(()=>{const a=s.postLink.trim();if(!a){g(r=>h(u({},r),{postLink:"Post link is required to fetch site info."}));return}if(a===B){j.info("This URL has already been fetched.");return}try{new URL(a),t(me(a)).unwrap().then(()=>{y(!1)}).catch(()=>j.error("Failed to fetch site info. Please try a different URL."))}catch(r){g(i=>h(u({},i),{postLink:"Please enter a valid URL (e.g., https://example.com)."}))}},[s.postLink,B,t]),Z=l.useMemo(()=>{const r=U?s.keywords:s.keywords.slice(0,12),i=s.keywords.length-12;return e.jsxs("div",{className:`flex flex-wrap gap-2 ${s.keywords.length>0?"mb-1":"hidden"}`,children:[r.map(c=>e.jsxs(p.div,{className:"flex items-center bg-indigo-100 text-indigo-700 rounded-md px-2 sm:px-3 py-1",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,scale:.8},whileHover:{scale:1.05},children:[e.jsx("span",{className:"text-xs sm:text-sm truncate max-w-[100px] sm:max-w-[120px]",children:c}),e.jsx(ue,{className:"ml-1 cursor-pointer text-indigo-500 hover:text-indigo-700 transition-colors w-3 sm:w-4 h-3 sm:h-4",onClick:x=>{x.stopPropagation(),K(c)},"aria-label":`Remove ${c}`})]},c)),i>0&&e.jsx("button",{type:"button",className:"text-xs sm:text-sm text-indigo-600 hover:text-indigo-800 font-medium",onClick:()=>_(!U),children:U?"Show Less":`Show More (+${i})`})]})},[s.keywords,K,U]);return e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col lg:flex-row gap-4 sm:gap-6 p-4 sm:p-6 md:p-8 max-w-7xl mx-auto",children:[e.jsx(pe,{children:e.jsx("title",{children:"Brand Voice | GenWrite"})}),e.jsxs(p.div,{className:"w-full lg:w-[60%] bg-white rounded-xl p-4 sm:p-6 shadow-lg border border-gray-100",initial:{x:-20},animate:{x:0},children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Create Your Brand Voice"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 sm:mb-6",children:"Define your brand's unique tone and style to ensure consistent content creation."}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"postLink",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Post or Blog Link ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(I,{title:"Add a link of your home page to fetch site info",overlayStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"220px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(R,{className:"w-4 sm:w-5 h-4 sm:h-5 text-blue-500"})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(p.input,{id:"postLink",type:"url",name:"postLink",value:s.postLink,onChange:S,placeholder:"e.g., https://example.com/blog",className:`flex-grow p-2 sm:p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm sm:text-base ${o.postLink?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!o.postLink,"aria-describedby":o.postLink?"postLink-error":void 0}),e.jsx(p.button,{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-3 sm:px-4 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",onClick:G,whileHover:{scale:1.03},whileTap:{scale:.98},disabled:w.loading||s.postLink&&s.postLink===B,"aria-label":"Fetch Site Info",children:w.loading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"animate-spin w-4 sm:w-5 h-4 sm:h-5"}),"Fetching..."]}):"Fetch Site Info"})]}),o.postLink&&e.jsx("p",{id:"postLink-error",className:"text-red-500 text-xs sm:text-sm mt-1",children:o.postLink})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"nameOfVoice",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Name of Voice ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p.input,{id:"nameOfVoice",type:"text",name:"nameOfVoice",value:s.nameOfVoice,onChange:S,placeholder:"e.g., Friendly Tech",className:`w-full p-2 sm:p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm sm:text-base ${o.nameOfVoice?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!o.nameOfVoice,"aria-describedby":o.nameOfVoice?"nameOfVoice-error":void 0}),o.nameOfVoice&&e.jsx("p",{id:"nameOfVoice-error",className:"text-red-500 text-xs sm:text-sm mt-1",children:o.nameOfVoice})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"keywords",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Keywords ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(I,{title:"Upload a .csv file in the format: `Keyword` as header",overlayStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"220px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(R,{className:"w-4 sm:w-5 h-4 sm:h-5 text-blue-500"})})})]}),e.jsxs(p.div,{className:`flex bg-white border rounded-lg p-2 sm:p-3 flex-col gap-2 ${o.keywords?"border-red-500":"border-gray-300"}`,whileHover:{boxShadow:"0 0 0 3px rgba(99, 102, 241, 0.2)"},children:[Z,e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2",children:[e.jsx("input",{id:"keywords",type:"text",value:f,onChange:a=>b(a.target.value),onKeyDown:z,className:"flex-grow p-2 sm:p-3 bg-transparent border-none outline-none text-sm sm:text-base",placeholder:"Type a keyword and press Enter","aria-describedby":o.keywords?"keywords-error":void 0}),e.jsx("label",{htmlFor:"file-upload",className:"flex items-center cursor-pointer",children:e.jsx(p.div,{className:"bg-indigo-100 p-2 rounded-lg",whileHover:{scale:1.1},whileTap:{scale:.95},"aria-label":"Upload CSV file",children:e.jsx(be,{className:"w-4 sm:w-5 h-4 sm:h-5 text-indigo-600"})})}),e.jsx("input",{id:"file-upload",type:"file",className:"hidden",onChange:Q,accept:".csv"})]})]}),o.keywords&&e.jsx("p",{id:"keywords-error",className:"text-red-500 text-xs sm:text-sm mt-1",children:o.keywords})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"sitemapUrl",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Sitemap URL ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(I,{title:"Paste the URL of your XML sitemap (e.g., https://example.com/sitemap.xml)",overlayStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"320px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(R,{className:"w-4 sm:w-5 h-4 sm:h-5 text-blue-500"})})})]}),e.jsx(p.input,{id:"sitemapUrl",type:"url",name:"sitemapUrl",value:s.sitemapUrl,onChange:S,placeholder:"e.g., https://example.com/sitemap.xml",className:`w-full p-2 sm:p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm sm:text-base ${o.sitemapUrl?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!o.sitemapUrl,"aria-describedby":o.sitemapUrl?"sitemapUrl-error":void 0}),o.sitemapUrl&&e.jsx("p",{id:"sitemapUrl-error",className:"text-red-500 text-xs sm:text-sm mt-1",children:o.sitemapUrl})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"describeBrand",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Describe Your Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p.textarea,{id:"describeBrand",name:"describeBrand",value:s.describeBrand,onChange:S,placeholder:"Describe your brand's tone and personality",className:`w-full p-2 sm:p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm sm:text-base ${o.describeBrand?"border-red-500":"border-gray-300"}`,rows:4,whileFocus:{scale:1.01},"aria-invalid":!!o.describeBrand,"aria-describedby":o.describeBrand?"describeBrand-error":void 0}),o.describeBrand&&e.jsx("p",{id:"describeBrand-error",className:"text-red-500 text-xs sm:text-sm mt-1",children:o.describeBrand})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 justify-end",children:[e.jsx(p.button,{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-3 sm:px-4 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",onClick:M,whileHover:{scale:1.03,y:-2},whileTap:{scale:.98},disabled:N,"aria-label":s._id?"Update Brand Voice":"Save Brand Voice",children:N?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"animate-spin w-4 sm:w-5 h-4 sm:h-5"}),"Saving..."]}):s._id?"Update Brand Voice":"Save Brand Voice"}),e.jsx(p.button,{className:"bg-gradient-to-tr from-red-700 from-10% via-red-500 via-80% to-red-700 to-100% text-white px-3 sm:px-4 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base",onClick:V,whileHover:{scale:1.03,y:-2},whileTap:{scale:.98},disabled:N,"aria-label":"Clear Form",children:"Clear"})]})]})]}),e.jsxs(p.div,{className:"w-full lg:w-[40%] bg-white rounded-xl p-4 sm:p-6 shadow-lg border border-gray-100",initial:{x:20},animate:{x:0},children:[e.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-gray-800 mb-4",children:"Your Brand Voices"}),e.jsx("div",{className:"space-y-3 overflow-y-auto max-h-[calc(100vh-300px)] sm:max-h-[calc(100vh-250px)]",children:A?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx(T,{className:"animate-spin w-8 h-8 text-indigo-600"})}):k.length>0?k.map(a=>{var r;return e.jsx(ge,{id:a._id,brandName:a.nameOfVoice,brandVoice:a.describeBrand,onSelect:()=>X(a),isSelected:((r=s.selectedVoice)==null?void 0:r._id)===a._id,onEdit:i=>{i.stopPropagation(),W(a)},onDelete:i=>{i.stopPropagation(),Y(a)}},a._id)}):e.jsx("div",{className:"p-4 sm:p-6 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center text-gray-500 text-xs sm:text-sm",children:"No brand voices created yet. Start by adding one on the left."})})]}),e.jsx("style",{children:`
          .ant-modal-content {
            border-radius: 8px !important;
            padding: 12px sm:p-16px !important;
          }
          .ant-modal-header {
            border-radius: 8px 8px 0 0 !important;
          }
          .ant-input, .ant-input-textarea {
            border-radius: 8px !important;
            border: 1px solid #d1d5db !important;
            padding: 6px 12px !important;
          }
          .ant-input:focus,
          .ant-input:hover,
          .ant-input-textarea:focus,
          .ant-input-textarea:hover {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2) !important;
          }
          .ant-btn {
            display: flex;
            align-items: center;
          }
          @media (max-width: 640px) {
            .ant-modal-content {
              padding: 12px !important;
            }
            .ant-input, .ant-input-textarea {
              font-size: 12px !important;
              padding: 4px 8px !important;
            }
            .ant-btn {
              font-size: 12px !important;
              padding: 4px 8px !important;
            }
          }
          @media (max-width: 768px) {
            .ant-modal {
              width: 100% !important;
              margin: 8px !important;
              max-width: 400px !important;
            }
          }
        `})]})},ge=({id:d,brandName:t,brandVoice:n,onSelect:f,isSelected:b,onEdit:N,onDelete:L})=>e.jsxs(p.div,{className:`p-4 mt-2 rounded-xl cursor-pointer transition-all ${b?"bg-gradient-to-r from-indigo-100 to-purple-100 border-2 border-indigo-300 shadow-md":"bg-white border border-gray-200 hover:bg-gray-50"}`,onClick:f,whileHover:{y:-2,boxShadow:"0 4px 15px rgba(99, 64, 241, 0.1)"},whileTap:{scale:.98},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},role:"button",tabIndex:0,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),f())},"aria-label":`Select ${t} brand voice`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:`font-medium text-sm ${b?"text-indigo-700":"text-gray-700"} truncate max-w-[70%]`,children:t}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p.button,{className:"text-indigo-500 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 rounded",whileHover:{scale:1.1},whileTap:{scale:.9},onClick:N,"aria-label":`Edit ${t}`,title:"Edit",children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(p.button,{className:"text-gray-500 hover:text-red-400 focus:outline-none focus:ring-2 focus:ring-red-300 rounded",whileHover:{scale:1.1},whileTap:{scale:.9},onClick:L,"aria-label":`Delete ${t}`,title:"Delete",children:e.jsx("img",{src:"/Images/trash.png",alt:"Delete",className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-3",children:n})]});export{Ue as default};
