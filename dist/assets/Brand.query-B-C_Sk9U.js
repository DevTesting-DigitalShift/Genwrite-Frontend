var B=Object.defineProperty,U=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var E=r=>{throw TypeError(r)};var $=(r,t,e)=>t in r?B(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,n=(r,t)=>{for(var e in t||(t={}))k.call(t,e)&&$(r,e,t[e]);if(x)for(var e of x(t))A.call(t,e)&&$(r,e,t[e]);return r},p=(r,t)=>U(r,T(t));var a=(r,t,e)=>$(r,typeof t!="symbol"?t+"":t,e),I=(r,t,e)=>t.has(r)||E("Cannot "+e);var u=(r,t,e)=>(I(r,t,"read from private field"),e?e.call(r):t.get(r)),C=(r,t,e)=>t.has(r)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),g=(r,t,e,s)=>(I(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e),O=(r,t,e)=>(I(r,t,"access private method"),e);var d=(r,t,e)=>new Promise((s,i)=>{var h=o=>{try{l(e.next(o))}catch(q){i(q)}},c=o=>{try{l(e.throw(o))}catch(q){i(q)}},l=o=>o.done?s(o.value):Promise.resolve(o.value).then(h,c);l((e=e.apply(r,t)).next())});import{u as R}from"./useQuery-0631SnkH.js";import{c6 as W,c9 as z,d_ as j,d$ as G,cj as _,Q as H,r as S,cb as J,ck as N,e0 as X,at as w}from"./index-6vE63f-j.js";import{u as Y}from"./useInfiniteQuery-wr-AFLnQ.js";var b,K,y,f,m,D,F,L,Z=(L=class extends W{constructor(t,e){super();C(this,m);C(this,b);C(this,K);C(this,y);C(this,f);g(this,b,t),this.setOptions(e),this.bindMethods(),O(this,m,D).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const e=this.options;this.options=u(this,b).defaultMutationOptions(t),z(this.options,e)||u(this,b).getMutationCache().notify({type:"observerOptionsUpdated",mutation:u(this,y),observer:this}),e!=null&&e.mutationKey&&this.options.mutationKey&&j(e.mutationKey)!==j(this.options.mutationKey)?this.reset():((s=u(this,y))==null?void 0:s.state.status)==="pending"&&u(this,y).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=u(this,y))==null||t.removeObserver(this)}onMutationUpdate(t){O(this,m,D).call(this),O(this,m,F).call(this,t)}getCurrentResult(){return u(this,K)}reset(){var t;(t=u(this,y))==null||t.removeObserver(this),g(this,y,void 0),O(this,m,D).call(this),O(this,m,F).call(this)}mutate(t,e){var s;return g(this,f,e),(s=u(this,y))==null||s.removeObserver(this),g(this,y,u(this,b).getMutationCache().build(u(this,b),this.options)),u(this,y).addObserver(this),u(this,y).execute(t)}},b=new WeakMap,K=new WeakMap,y=new WeakMap,f=new WeakMap,m=new WeakSet,D=function(){var e,s;const t=(s=(e=u(this,y))==null?void 0:e.state)!=null?s:G();g(this,K,p(n({},t),{isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}))},F=function(t){_.batch(()=>{var e,s,i,h,c,l,o,q;if(u(this,f)&&this.hasListeners()){const v=u(this,K).variables,M=u(this,K).context,P={client:u(this,b),meta:this.options.meta,mutationKey:this.options.mutationKey};if((t==null?void 0:t.type)==="success"){try{(s=(e=u(this,f)).onSuccess)==null||s.call(e,t.data,v,M,P)}catch(Q){Promise.reject(Q)}try{(h=(i=u(this,f)).onSettled)==null||h.call(i,t.data,null,v,M,P)}catch(Q){Promise.reject(Q)}}else if((t==null?void 0:t.type)==="error"){try{(l=(c=u(this,f)).onError)==null||l.call(c,t.error,v,M,P)}catch(Q){Promise.reject(Q)}try{(q=(o=u(this,f)).onSettled)==null||q.call(o,void 0,t.error,v,M,P)}catch(Q){Promise.reject(Q)}}}this.listeners.forEach(v=>{v(u(this,K))})})},L);function V(r,t){const e=H(),[s]=S.useState(()=>new Z(e,r));S.useEffect(()=>{s.setOptions(r)},[s,r]);const i=S.useSyncExternalStore(S.useCallback(c=>s.subscribe(_.batchCalls(c)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),h=S.useCallback((c,l)=>{s.mutate(c,l).catch(J)},[s]);if(i.error&&N(s.options.throwOnError,[i.error]))throw i.error;return p(n({},i),{mutate:h,mutateAsync:i.mutate})}class ee{constructor(){a(this,"queryClient",X);a(this,"defaultQueryOptions",{staleTime:1/0,gcTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!1,retry:1});a(this,"useFetchQuery",(t,e,s)=>R(n(n({queryKey:[...this.baseKey,t],queryFn:e},this.defaultQueryOptions),s)));a(this,"useParamQuery",(t,e,s,i)=>R(n(n({queryKey:[...this.baseKey,t,s],queryFn:()=>e(s)},this.defaultQueryOptions),i)));a(this,"useInfiniteQuery",(t,e,s,i,h)=>Y(n(n({queryKey:[...this.baseKey,t,i],queryFn:({pageParam:c=1})=>e(p(n({},i),{page:c})),getNextPageParam:s,initialPageParam:1},this.defaultQueryOptions),h)));a(this,"useMutate",(t,e)=>V(n({mutationFn:t},e)));a(this,"setData",(t,e,s)=>{this.queryClient.setQueryData([...this.baseKey,t,e],s)});a(this,"invalidate",t=>this.queryClient.invalidateQueries({queryKey:t?[...this.baseKey,t]:this.baseKey}));a(this,"prefetch",(t,e,s)=>d(this,null,function*(){try{return yield this.queryClient.prefetchQuery(n({queryKey:[...this.baseKey,t],queryFn:e},s)),!0}catch(i){return console.warn(`Prefetch error [${this.baseKey}]:`,i),!1}}));a(this,"prefetchParam",(t,e,s,i)=>d(this,null,function*(){try{return yield this.queryClient.prefetchQuery(n({queryKey:[...this.baseKey,t,s],queryFn:()=>e(s)},i)),!0}catch(h){return console.warn(`Prefetch error [${this.baseKey}]:`,h),!1}}))}}class te extends ee{constructor(){super(...arguments);a(this,"useList",e=>this.useFetchQuery("list",()=>this.api.list(),e));a(this,"useListParams",(e,s)=>this.useParamQuery("list",this.api.list,e,s));a(this,"useDetail",(e,s)=>this.useFetchQuery(`detail-${e}`,()=>this.api.get(e),s));a(this,"useCreate",e=>this.useMutate(this.api.create,p(n({},e),{onSuccess:s=>{var i;this.queryClient.setQueryData([...this.baseKey,"list"],(h=[])=>[...h||[],s]),(i=e==null?void 0:e.onSuccess)==null||i.call(e,s)}})));a(this,"useUpdate",e=>this.useMutate(({id:s,data:i})=>this.api.update(s,i),p(n({},e),{onSuccess:s=>{var i;this.queryClient.setQueryData([...this.baseKey,"list"],(h=[])=>h.map(c=>c._id===s._id?s:c)),this.queryClient.setQueryData([...this.baseKey,`detail-${s._id}`],s),(i=e==null?void 0:e.onSuccess)==null||i.call(e,s)}})));a(this,"useDelete",e=>this.useMutate(this.api.delete,p(n({},e),{onSuccess:(s,i)=>{var h;this.queryClient.setQueryData([...this.baseKey,"list"],(c=[])=>c.filter(l=>l._id!==i)),this.queryClient.removeQueries({queryKey:[...this.baseKey,`detail-${i}`]}),(h=e==null?void 0:e.onSuccess)==null||h.call(e,i)}})));a(this,"prefetchList",e=>this.prefetch("list",()=>this.api.list(e)));a(this,"prefetchDetail",e=>this.prefetch(`detail-${e}`,()=>this.api.get(e)));a(this,"invalidateList",()=>this.invalidate("list"));a(this,"invalidateDetail",e=>this.invalidate(`detail-${e}`))}}const se={list:()=>d(null,null,function*(){return(yield w.get("/brand")).data}),get:r=>d(null,null,function*(){return(yield w.get(`/brand/${r}`)).data}),create:r=>d(null,null,function*(){return(yield w.post("/brand/addBrand",r)).data}),update:(r,t)=>d(null,null,function*(){return(yield w.put(`/brand/${r}`,t)).data}),delete:r=>d(null,null,function*(){yield w.delete(`/brand/${r}`)}),getSiteInfo:r=>d(null,null,function*(){return(yield w.get("/brand/site-info",{params:{url:r}})).data})};class re extends te{constructor(){super(...arguments);a(this,"baseKey",["brand"]);a(this,"api",se);a(this,"useSiteInfo",(e,s)=>this.useFetchQuery(`siteInfo-${e}`,()=>this.api.getSiteInfo(e),s))}}const ne=new re;export{ne as b,V as u};
