var z=(u,K,w)=>new Promise((g,f)=>{var b=i=>{try{p(w.next(i))}catch(c){f(c)}},r=i=>{try{p(w.throw(i))}catch(c){f(c)}},p=i=>i.done?g(i.value):Promise.resolve(i.value).then(b,r);p((w=w.apply(u,K)).next())});import{j as o}from"./tiptap-BabmW22p.js";import{b as y}from"./vendor-CcjAMWu8.js";import{u as $}from"./useAnalysisStore-CRW_-n-r.js";import{M as C,l as q,B as E,_ as Q,m as V,F as X,b as Y}from"./antd-8WQTeuab.js";import{m as h}from"./index-CHEUOGl9.js";import"./useAuthStore-CU2rUJjR.js";import"./DataLayer-DALerVhB.js";import"./react-wNxFir7h.js";import"./analysisApi-DM6-hWp4.js";import"./utils-DIb0lvMo.js";const ie=({closeFnc:u,openSecondStepModal:K,openJobModal:w,visible:g})=>{var T;const[f,b]=y.useState(""),[r,p]=y.useState([]),[i,c]=y.useState(1),[S,k]=y.useState(!1),{keywordAnalysis:l,loading:v,selectedKeywords:a,clearKeywordAnalysis:N,setSelectedKeywords:j,analyzeKeywords:B}=$();y.useEffect(()=>{r.length===0&&(c(1),N())},[r,N]);const _=()=>{const e=f.trim();if(!e)return;const t=r.map(s=>s.toLowerCase()),m=new Set,n=e.split(",").map(s=>s.trim()).filter(s=>s&&!t.includes(s.toLowerCase())&&!m.has(s.toLowerCase())&&m.add(s.toLowerCase()));n.length>0&&(p([...r,...n]),b(""))},D=e=>{var n;const t=r[e],m=r.filter((s,x)=>x!==e);if(p(m),m.length===0&&(dispatch(N()),c(1)),(n=a==null?void 0:a.allKeywords)!=null&&n.includes(t)){const s=a.allKeywords.filter(x=>x!==t);j({focusKeywords:s.slice(0,3),keywords:s,allKeywords:s})}},L=e=>{e.key==="Enter"&&(e.preventDefault(),_())},P=()=>{r.length>0&&(B(r),c(1))},O=()=>{const e={LOW:[],MEDIUM:[],HIGH:[]};l==null||l.forEach(s=>{e[s.competition]&&e[s.competition].push({keyword:s.keyword,competition_index:s.competition_index})});const t=e.LOW.sort((s,x)=>s.competition_index-x.competition_index).slice(0,2),m=e.MEDIUM.sort((s,x)=>s.competition_index-x.competition_index).slice(0,2),n=e.HIGH.sort((s,x)=>s.competition_index-x.competition_index).slice(0,2);return[...t.map(s=>s.keyword),...m.map(s=>s.keyword),...n.map(s=>s.keyword)]},W=()=>{const e=O();if(!e.length||!(l!=null&&l.length)){C.error({title:"No Auto-Selected Keywords",content:"No keywords available to auto-select. Please analyze keywords first."});return}C.info({icon:null,title:o.jsx("div",{className:"flex justify-between items-center",children:o.jsx("span",{children:"Auto-Selected Keywords"})}),content:o.jsxs("div",{children:[o.jsx("p",{children:"We selected these keywords automatically based on competition index:"}),o.jsx("ul",{className:"list-disc ml-5 mt-2",children:e.map(t=>o.jsx("li",{className:"capitalize text-sm sm:text-base",children:t},t))}),o.jsx("p",{className:"mt-3 text-sm sm:text-base",children:"Do you want to add these too?"})]}),okText:"Accept",cancelText:"Decline",closable:!0,onOk(){const t=[...(a==null?void 0:a.allKeywords)||[],...e.filter(m=>{var n;return!((n=a==null?void 0:a.allKeywords)!=null&&n.includes(m))})].slice(0,6);j({focusKeywords:t.slice(0,3),keywords:t,allKeywords:t})},onCancel(){const t=(a==null?void 0:a.allKeywords)||[];j({focusKeywords:t.slice(0,3),keywords:t,allKeywords:t})},okButtonProps:{className:"bg-blue-600 text-white"}})},M=e=>z(null,null,function*(){const t=(a==null?void 0:a.allKeywords)||[];j({focusKeywords:t.slice(0,3),keywords:t.slice(3),allKeywords:t}),u(),setTimeout(()=>{e==="blog"?K():w()},100)}),G=()=>{M("blog")},U=()=>{M("job")},F=[{title:"Keyword",dataIndex:"keyword",key:"keyword",sorter:(e,t)=>e.keyword.localeCompare(t.keyword),render:e=>o.jsx("span",{className:"font-medium capitalize text-sm sm:text-base",children:e})},{title:"Monthly Searches",dataIndex:"avgMonthlySearches",key:"avgMonthlySearches",sorter:(e,t)=>e.avgMonthlySearches-t.avgMonthlySearches,render:e=>new Intl.NumberFormat().format(e)},{title:"Competition",dataIndex:"competition",key:"competition",sorter:(e,t)=>e.competition_index-t.competition_index,render:e=>o.jsx(Y,{color:e==="LOW"?"green":e==="MEDIUM"?"orange":e==="HIGH"?"red":"gray",className:"text-xs sm:text-sm",children:e})},{title:"Competition Index",dataIndex:"competition_index",key:"competition_index",sorter:(e,t)=>e.competition_index-t.competition_index,render:e=>e||"-"}],H=(l==null?void 0:l.map((e,t)=>({key:t,keyword:e.keyword,avgMonthlySearches:e.avgMonthlySearches,competition:e.competition,competition_index:e.competition_index,avgCpc:e.avgCpc,lowBid:e.lowBid,highBid:e.highBid})))||[],I=S?H.filter(e=>{var t;return(t=a==null?void 0:a.allKeywords)==null?void 0:t.includes(e.keyword)}):H,J=e=>c(e);y.useEffect(()=>()=>{p([]),b(""),c(1),k(!1)},[]),y.useEffect(()=>(g?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[g]);const d=((T=a==null?void 0:a.allKeywords)==null?void 0:T.length)>0;return o.jsx(C,{open:g,onCancel:u,closable:!0,footer:[o.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 pt-2 border-t border-gray-100",children:[o.jsx(h.button,{onClick:W,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 w-full sm:w-auto",whileHover:{scale:1.03},whileTap:{scale:.97},disabled:v||!(l!=null&&l.length),style:{opacity:v||!(l!=null&&l.length)?.5:1,cursor:v||!(l!=null&&l.length)?"not-allowed":"pointer"},children:"Show Auto-Selected Keywords"}),o.jsx(h.button,{onClick:G,className:`px-4 py-2 text-sm font-medium rounded-lg w-full sm:w-auto ${d?"text-gray-700 bg-gray-100 hover:bg-gray-200":"text-gray-400 bg-gray-200 cursor-not-allowed"}`,whileHover:{scale:d?1.03:1},whileTap:{scale:d?.97:1},disabled:!d,children:"Create Blog"}),o.jsx(h.button,{onClick:U,className:`px-4 py-2 text-sm font-medium rounded-lg w-full sm:w-auto ${d?"text-gray-700 bg-gray-100 hover:bg-gray-200":"text-gray-400 bg-gray-200 cursor-not-allowed"}`,whileHover:{scale:d?1.03:1},whileTap:{scale:d?.97:1},disabled:!d,children:"Create New Job"}),o.jsx(h.button,{onClick:u,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 w-full sm:w-auto",whileHover:{scale:1.03},whileTap:{scale:.97},children:"Close"})]},"footer-buttons")],width:"90vw",centered:!0,title:"Keyword Research",styles:{content:{maxWidth:"1000px",margin:"0 auto"},body:{padding:"16px"}},className:"rounded-lg sm:rounded-xl",children:o.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[o.jsx("p",{className:"mb-3 sm:mb-4 text-gray-600 text-sm sm:text-base",children:"Find and analyze keywords for your blog"}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4 sm:mb-6",children:[o.jsx(q,{placeholder:"Enter a keyword",value:f,onChange:e=>b(e.target.value),onKeyPress:L,className:"flex-1 text-sm sm:text-base","aria-label":"Enter keyword"}),o.jsx(h.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:o.jsx(E,{type:"primary",onClick:_,className:"w-full sm:w-auto",children:"Add"})})]}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-4 sm:mb-6",children:r.map((e,t)=>o.jsxs(h.div,{initial:{opacity:0,scale:.8},animate:{opacity:1},className:"bg-blue-100 text-blue-800 px-2 sm:px-3 py-1 rounded-full flex items-center text-xs sm:text-sm",children:[o.jsx("span",{className:"lowercase",children:e}),o.jsx(h.div,{whileHover:{scale:1.2},whileTap:{scale:.8},className:"ml-1 sm:ml-2 cursor-pointer",onClick:()=>D(t),children:o.jsx(Q,{className:"text-blue-800 text-xs"})})]},t))}),o.jsx(h.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:o.jsx(E,{block:!0,type:"primary",onClick:P,loading:v,disabled:r.length===0,className:"text-sm sm:text-base",children:"Analyze Keywords"})}),!v&&(l==null?void 0:l.length)>0&&o.jsxs("div",{className:"mt-4 sm:mt-6",children:[o.jsxs("div",{className:"flex items-center mb-3 sm:mb-4",children:[o.jsx(V,{checked:S,onChange:e=>k(e),disabled:!d,size:"small"}),o.jsx("span",{className:"ml-2 text-gray-600 text-sm sm:text-base",children:"Show Selected Keywords Only"})]}),o.jsx("div",{className:"overflow-x-auto",children:o.jsx(X,{columns:F,dataSource:I,pagination:{current:i,pageSize:5,showSizeChanger:!1,onChange:J,total:I.length,responsive:!0},rowSelection:{selectedRowKeys:(a==null?void 0:a.allKeywords)||[],onChange:e=>{j({focusKeywords:e.slice(0,3),keywords:e,allKeywords:e})},getCheckboxProps:e=>({name:e.keyword})},rowKey:e=>e.keyword,scroll:{x:600},className:"min-w-[600px]"})})]})]})})};export{ie as default};
