var k=Object.defineProperty;var C=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var T=(s,t,o)=>t in s?k(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o,j=(s,t)=>{for(var o in t||(t={}))F.call(t,o)&&T(s,o,t[o]);if(C)for(var o of C(t))M.call(t,o)&&T(s,o,t[o]);return s};var v=(s,t,o)=>new Promise((g,l)=>{var i=n=>{try{d(o.next(n))}catch(c){l(c)}},x=n=>{try{d(o.throw(n))}catch(c){l(c)}},d=n=>n.done?g(n.value):Promise.resolve(n.value).then(i,x);d((o=o.apply(s,t)).next())});import{j as r}from"./tiptap-BabmW22p.js";import{b as p}from"./vendor-CcjAMWu8.js";import{a as _,A as z,H as G,m as U}from"./index-CHEUOGl9.js";import{d as A,b as Y,c as y,F as B,S as H,E as $}from"./antd-8WQTeuab.js";import{c as K}from"./react-wNxFir7h.js";import{u as Q}from"./useQuery-CEoF32mJ.js";import{g as q}from"./socket-UX3sw_I2.js";import{F as J}from"./fuse-CLoWdkAE.js";import{S as W}from"./search-Csb6xL5U.js";import"./utils-DIb0lvMo.js";const V=K(s=>({page:1,pageSize:10,searchText:"",dateRange:"24h",purposeFilter:[],setPage:t=>s({page:t}),setPageSize:t=>s({pageSize:t}),setSearchText:t=>s({searchText:t,page:1}),setDateRange:t=>s({dateRange:t,page:1}),setPurposeFilter:t=>s({purposeFilter:t,page:1})})),X=s=>v(null,null,function*(){return(yield _.get("/user/credit-logs",{params:s})).data}),Z=s=>Q({queryKey:["creditLogs",s],queryFn:()=>X(s),keepPreviousData:!0,staleTime:300*1e3}),{Option:f}=y,xe=()=>{const{page:s,pageSize:t,searchText:o,dateRange:g,purposeFilter:l,setPage:i,setPageSize:x,setSearchText:d,setDateRange:n,setPurposeFilter:c}=V(),E=j({page:1,limit:-1},(e=>{const a=A();switch(e){case"24h":return{start:a.subtract(24,"hours").startOf("hour").toISOString(),end:a.endOf("hour").toISOString()};case"7d":return{start:a.subtract(7,"days").startOf("day").toISOString(),end:a.endOf("day").toISOString()};case"30d":return{start:a.subtract(30,"days").startOf("day").toISOString(),end:a.endOf("day").toISOString()};default:return{}}})(g)),{data:m,isLoading:b,refetch:N}=Z(E),u=(m==null?void 0:m.data)||[],S=[10,20,50,100],L=["BLOG_GENERATION","QUICK_BLOG_GENERATION","AI_PROOFREADING","COMPETITOR_ANALYSIS","SUBSCRIPTION_PAYMENT","OTHER"],w=p.useMemo(()=>new J(u,{keys:["metadata.title"],threshold:.4,ignoreLocation:!0,minMatchCharLength:2}),[u]),h=p.useMemo(()=>{let e=u;return o&&(e=w.search(o).map(({item:a})=>a)),l.length>0&&(e=e.filter(a=>l.includes(a.purpose))),e},[u,o,l,w]),O={BLOG_GENERATION:"bg-blue-100 text-blue-700",QUICK_BLOG_GENERATION:"bg-indigo-100 text-indigo-700",AI_PROOFREADING:"bg-green-100 text-green-700",COMPETITOR_ANALYSIS:"bg-yellow-100 text-yellow-800",SUBSCRIPTION_PAYMENT:"bg-purple-100 text-purple-700",OTHER:"bg-gray-100 text-gray-700"},R=p.useMemo(()=>[{title:"Blog Topic",dataIndex:["metadata","title"],key:"blogTitle",render:e=>r.jsx("div",{children:r.jsx("span",{className:"text-xs sm:text-sm text-gray-700 capitalize",children:e||"-"})})},{title:"Date",dataIndex:"createdAt",key:"createdAt",sorter:(e,a)=>new Date(e.createdAt)-new Date(a.createdAt),render:e=>r.jsx("span",{className:"text-xs sm:text-sm text-gray-600",children:A(e).format("DD MMM YYYY, hh:mm A")})},{title:"Type",dataIndex:"category",key:"category",filters:[{text:"Deduction",value:"DEDUCTION"},{text:"Adjustment",value:"ADJUSTMENT"}],onFilter:(e,a)=>a.category===e,render:e=>r.jsx(Y,{color:e==="DEDUCTION"?"red":"green",className:"font-medium px-2 sm:px-3 py-1 rounded-full text-xs",children:e})},{title:"Purpose",dataIndex:"purpose",key:"purpose",filters:L.map(e=>({text:e.toLowerCase().replace(/_/g," "),value:e})),filterMultiple:!0,onFilter:(e,a)=>a.purpose===e,render:e=>{const a=O[e]||"bg-gray-100 text-gray-700",I=(e==null?void 0:e.toLowerCase().replace(/_/g," "))||"-";return r.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-semibold capitalize ${a}`,children:I})}},{title:"Amount",dataIndex:"amount",key:"amount",sorter:(e,a)=>e.amount-a.amount,render:e=>r.jsx("span",{className:`font-semibold text-xs sm:text-sm ${e<0?"text-red-500":"text-green-600"}`,children:e>0?`+${e}`:e})},{title:"Remaining Credits",dataIndex:"remainingCredits",key:"remainingCredits",responsive:["md"],render:e=>r.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-800",children:e})}],[O]);p.useEffect(()=>{const e=q();if(!e)return;const a=()=>{N()};return e.on("credit-log",a),()=>{e.off("credit-log",a)}},[N]);const D=p.useMemo(()=>{const e=(s-1)*t,a=e+t;return h.slice(e,a)},[h,s,t]);return r.jsxs(z,{children:[r.jsx(G,{children:r.jsx("title",{children:"Credit Logs | GenWrite"})}),r.jsxs(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3},className:"p-8 bg-white rounded-2xl w-full max-w-full",children:[r.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[r.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Credit Logs"}),r.jsx("p",{className:"text-gray-500 text-sm max-w-lg",style:{opacity:1},children:"All your credits, all in one spot. Check your activity, track your transactions, and never miss a beat."}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full",children:[r.jsxs("div",{className:"relative w-full",children:[r.jsx("input",{placeholder:"Search by blog title",value:o,onChange:e=>{d(e.target.value),i(1)},className:"w-full rounded-lg border border-gray-300 px-10 py-[5px] text-sm focus:outline-none focus:ring-2 focus:ring-blue-300","aria-label":"Search credit logs by blog title"}),r.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"})]}),r.jsxs(y,{value:g,onChange:e=>{n(e),i(1)},className:"w-full sm:w-48 rounded-lg text-xs sm:text-sm",popupClassName:"rounded-lg","aria-label":"Select date range",children:[r.jsx(f,{value:"24h",children:"Last 24 Hours"}),r.jsx(f,{value:"7d",children:"Last 7 Days"}),r.jsx(f,{value:"30d",children:"Last 30 Days"})]}),r.jsx(y,{value:t,onChange:e=>{x(e),i(1)},options:S.map(e=>({label:`${e} / page`,value:e})),className:"w-full sm:w-32 rounded-lg text-xs sm:text-sm",popupClassName:"rounded-lg","aria-label":"Select page size"})]})]}),r.jsx("style",{children:`
            .ant-table-container {
              overflow-x: auto;
              -webkit-overflow: auto;
            }
            .ant-table-thead {
              position: sticky;
              top: 0;
              z-index: 10;
              background: #fafafa;
            }
            .ant-table-thead > tr > th {
              background: #fafafa !important;
              white-space: nowrap;
            }
            .ant-table-cell {
              white-space: nowrap;
            }
            @media (max-width: 640px) {
              .ant-table-tbody > tr > td {
                padding: 8px !important;
                font-size: 12px !important;
              }
              .ant-table-thead > tr > th {
                padding: 8px !important;
                font-size: 12px !important;
              }
            }
            @media (max-width: 768px) {
              .ant-table-tbody > tr > td {
                padding: 10px !important;
              }
              .ant-table-thead > tr > th {
                padding: 10px !important;
              }
            }
          `}),r.jsx(B,{dataSource:D,columns:R,loading:b,rowKey:"_id",pagination:{current:s,pageSize:t,total:h.length,showSizeChanger:!1,showTotal:e=>`Total ${e} logs`,onChange:e=>{i(e)},responsive:!0,pageSizeOptions:S,className:"text-xs sm:text-sm"},className:"rounded-xl overflow-hidden w-full",rowClassName:"hover:bg-gray-50 transition-colors duration-200",bordered:!1,locale:{emptyText:b?r.jsx(H,{tip:"Loading logs..."}):r.jsx($,{description:o||l.length>0?"No logs match the filters":"No Logs Found"})},onChange:(e,a,I,te)=>{const P=a.purpose||[];c(P),i(e.current),x(e.pageSize)},scroll:{x:"max-content"}})]})]})};export{xe as default};
