var X=Object.defineProperty,J=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var z=(e,r,s)=>r in e?X(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s,D=(e,r)=>{for(var s in r||(r={}))Y.call(r,s)&&z(e,s,r[s]);if(U)for(var s of U(r))Z.call(r,s)&&z(e,s,r[s]);return e},G=(e,r)=>J(e,K(r));var E=(e,r,s)=>new Promise((d,o)=>{var l=i=>{try{n(s.next(i))}catch(h){o(h)}},a=i=>{try{n(s.throw(i))}catch(h){o(h)}},n=i=>i.done?d(i.value):Promise.resolve(i.value).then(l,a);n((s=s.apply(e,r)).next())});import{r as u,as as W,W as $,j as t,H as ee,m as q,A as te,S as se,P as re}from"./index-C88w066y.js";import{l as ae}from"./lodash-CPEgMloM.js";import{S as ne}from"./search-DWVAisQx.js";import{D as F}from"./download-B4VNS5u6.js";import{I as oe}from"./image-BXfHe7xi.js";import{X as ie}from"./x-DtEhUtNk.js";import{S as le}from"./index-Dz2eU1iz.js";import"./index-BKFhnYbf.js";import"./move-BBcfGqif.js";import"./SearchOutlined-D28f-vRu.js";var T=new Map,M=new WeakMap,H=0,ce;function de(e){return e?(M.has(e)||(H+=1,M.set(e,H.toString())),M.get(e)):"0"}function ue(e){return Object.keys(e).sort().filter(r=>e[r]!==void 0).map(r=>`${r}_${r==="root"?de(e.root):e[r]}`).toString()}function me(e){const r=ue(e);let s=T.get(r);if(!s){const d=new Map;let o;const l=new IntersectionObserver(a=>{a.forEach(n=>{var i;const h=n.isIntersecting&&o.some(w=>n.intersectionRatio>=w);e.trackVisibility&&typeof n.isVisible=="undefined"&&(n.isVisible=h),(i=d.get(n.target))==null||i.forEach(w=>{w(h,n)})})},e);o=l.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),s={id:r,observer:l,elements:d},T.set(r,s)}return s}function ge(e,r,s={},d=ce){if(typeof window.IntersectionObserver=="undefined"&&d!==void 0){const i=e.getBoundingClientRect();return r(d,{isIntersecting:d,target:e,intersectionRatio:typeof s.threshold=="number"?s.threshold:0,time:0,boundingClientRect:i,intersectionRect:i,rootBounds:i}),()=>{}}const{id:o,observer:l,elements:a}=me(s),n=a.get(e)||[];return a.has(e)||a.set(e,n),n.push(r),l.observe(e),function(){n.splice(n.indexOf(r),1),n.length===0&&(a.delete(e),l.unobserve(e)),a.size===0&&(l.disconnect(),T.delete(o))}}function pe({threshold:e,delay:r,trackVisibility:s,rootMargin:d,root:o,triggerOnce:l,skip:a,initialInView:n,fallbackInView:i,onChange:h}={}){var w;const[g,L]=u.useState(null),f=u.useRef(h),S=u.useRef(n),[m,I]=u.useState({inView:!!n,entry:void 0});f.current=h,u.useEffect(()=>{if(S.current===void 0&&(S.current=n),a||!g)return;let b;return b=ge(g,(N,C)=>{const A=S.current;S.current=N,!(A===void 0&&!N)&&(I({inView:N,entry:C}),f.current&&f.current(N,C),C.isIntersecting&&l&&b&&(b(),b=void 0))},{root:o,rootMargin:d,threshold:e,trackVisibility:s,delay:r},i),()=>{b&&b()}},[Array.isArray(e)?e.toString():e,g,o,d,l,a,s,i,r]);const x=(w=m.entry)==null?void 0:w.target,R=u.useRef(void 0);!g&&x&&!l&&!a&&R.current!==x&&(R.current=x,I({inView:!!n,entry:void 0}),S.current=n);const y=[L,m.inView,m.entry];return y.ref=y[0],y.inView=y[1],y.entry=y[2],y}const he=(...r)=>E(null,[...r],function*(e={}){const{page:s=1,limit:d=20,tags:o,minScore:l}=e,a=new URLSearchParams;return a.append("page",s),a.append("limit",d),o&&Array.isArray(o)&&o.length>0&&o.forEach(i=>a.append("tags",i)),l!=null&&a.append("minScore",l),(yield W.get(`/image-gallery?${a.toString()}`)).data}),fe=(...r)=>E(null,[...r],function*(e={}){const{q:s,page:d=1,limit:o=20,minScore:l}=e,a=new URLSearchParams;return s&&a.append("q",s),a.append("page",d),a.append("limit",o),l!=null&&a.append("minScore",l),(yield W.get(`/image-gallery/search?${a.toString()}`)).data}),{Option:Ee}=le,xe=({count:e=12})=>{const r=["aspect-[3/4]","aspect-[4/5]","aspect-square","aspect-[2/3]","aspect-[5/6]"];return t.jsx("div",{className:"columns-1 sm:columns-2 lg:columns-3 xl:columns-4 gap-4 space-y-4",children:Array.from({length:e}).map((s,d)=>t.jsx("div",{className:"break-inside-avoid rounded-xl overflow-hidden bg-gray-100 animate-pulse",children:t.jsx("div",{className:`w-full ${r[d%r.length]} bg-gradient-to-br from-gray-200 via-gray-100 to-gray-200 bg-[length:200%_200%] animate-shimmer`})},d))})},Pe=()=>{const[e,r]=u.useState([]),[s,d]=u.useState(!1),[o,l]=u.useState(""),[a,n]=u.useState(1),[i]=u.useState(20),[h,w]=u.useState(0),[g,L]=u.useState(0),[f,S]=u.useState([]),[m,I]=u.useState(null),[x,R]=u.useState(!0),{ref:y,inView:b}=pe({threshold:0,rootMargin:"200px"});u.useEffect(()=>{n(1),R(!0),r([])},[o,g,f]);const N=u.useCallback(()=>E(null,null,function*(){var c;if(!(!x&&a>1)){d(!0);try{const p={page:a,limit:i,minScore:g>0?g:void 0,tags:f.length>0?f:void 0};let v;o.trim()?v=yield fe(G(D({},p),{q:o})):v=yield he(p);const k=v.data||[],P=((c=v.pagination)==null?void 0:c.total)||0;w(P),r(j=>{if(a===1)return k;const Q=new Set(j.map(_=>_._id)),V=k.filter(_=>!Q.has(_._id));return[...j,...V]}),R(k.length===i)}catch(p){console.error("Error fetching images:",p),$.error("Failed to load images")}finally{d(!1)}}}),[a,i,g,f,o,x]);u.useEffect(()=>{N()},[N]),u.useEffect(()=>{b&&x&&!s&&n(c=>c+1)},[b,x,s]);const C=u.useCallback(ae.debounce(c=>{l(c)},500),[]),A=c=>{C(c.target.value)},B=c=>{I(c)},O=(c,p)=>E(null,null,function*(){p&&p.stopPropagation();try{const k=yield(yield fetch(c.url)).blob(),P=window.URL.createObjectURL(k),j=document.createElement("a");j.href=P,j.download=`image-${c._id}.jpg`,document.body.appendChild(j),j.click(),window.URL.revokeObjectURL(P),document.body.removeChild(j),$.success("Image downloaded successfully!")}catch(v){console.error(v),$.error("Failed to download image")}});return o||f.length>0||g>0,t.jsxs(t.Fragment,{children:[t.jsx(ee,{children:t.jsx("title",{children:"Image Gallery | GenWrite"})}),t.jsxs("div",{className:"min-h-screen p-3 md:p-6 lg:p-8",children:[t.jsxs(q.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8 mt-5 md:mt-0",children:[t.jsx("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 mb-8",children:t.jsxs("div",{className:"text-left",children:[t.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Explore Creations"}),t.jsx("p",{className:"text-gray-500 text-sm mt-2 max-w-md",children:"Curated high-quality generations for your next project"})]})}),t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"relative",children:[t.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search...",onChange:A,className:"w-full pl-9 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-gray-400"})]})})]}),t.jsxs("div",{children:[t.jsx(te,{mode:"wait",children:t.jsx(q.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"columns-1 sm:columns-2 lg:columns-3 xl:columns-4 gap-4 space-y-4",children:e.map((c,p)=>t.jsxs(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:p*.02},className:"break-inside-avoid relative group rounded-xl overflow-hidden cursor-pointer bg-gray-100",onClick:()=>B(c),children:[t.jsx("img",{src:c.url,alt:c.description,className:"w-full h-auto object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("p",{className:"text-white text-sm line-clamp-2 font-medium mr-2",children:c.description}),t.jsx("button",{onClick:v=>O(c,v),className:"p-2 bg-white text-gray-900 rounded-full hover:bg-gray-100 transition-colors duration-200 shadow-lg flex-shrink-0",children:t.jsx(F,{className:"w-4 h-4"})})]})})]},c._id))},`${o}-${f.join(",")}-${g}`)}),s&&e.length===0&&t.jsx(xe,{count:12}),!s&&e.length===0&&t.jsxs("div",{className:"py-20 flex flex-col items-center justify-center",children:[t.jsx(oe,{className:"w-16 h-16 text-gray-300 mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"No images found"}),t.jsx("p",{className:"text-gray-500 text-sm",children:"Try adjusting your search or filters"})]}),x&&e.length>0&&t.jsx("div",{ref:y,className:"py-12 flex justify-center w-full",children:s&&t.jsx(se,{size:"large"})})]}),t.jsx(re,{open:!!m,onCancel:()=>I(null),footer:null,centered:!0,width:1e3,closeIcon:null,className:"image-detail-modal",styles:{content:{padding:0,borderRadius:"24px",overflow:"hidden",backgroundColor:"transparent",boxShadow:"none"}},children:m&&t.jsxs("div",{className:"bg-white rounded-xl overflow-hidden shadow-2xl flex flex-col md:flex-row max-h-[90vh]",children:[t.jsxs("div",{className:"flex-1 relative group flex items-center justify-center p-2",children:[t.jsx("div",{className:"relative max-h-full max-w-full shadow-lg rounded-lg overflow-hidden",children:t.jsx("img",{src:m.url,alt:m.description,className:"max-h-[85vh] w-auto object-contain"})}),t.jsx("button",{onClick:()=>I(null),className:"absolute top-4 left-4 p-2 bg-black/50 hover:bg-black/70 text-white rounded-full transition-all backdrop-blur-sm z-10",children:t.jsx(ie,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"w-full md:w-[350px] bg-white p-6 md:p-4 flex flex-col overflow-y-auto border-l border-gray-100",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-900 leading-snug mb-4",children:"Prompt Details"}),t.jsxs("div",{className:"flex-1 overflow-y-auto pr-2 custom-scrollbar",children:[t.jsx("p",{className:"text-gray-600 leading-relaxed text-sm mb-6",children:m.description||"No description provided for this generation."}),m.tags&&m.tags.length>0&&t.jsxs("div",{className:"mb-6",children:[t.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3",children:"Tags"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:m.tags.map((c,p)=>t.jsxs("span",{className:"px-3 py-1 bg-gray-100 text-gray-600 rounded-lg text-xs font-medium border border-gray-200",children:["#",c]},p))})]})]}),t.jsx("div",{className:"mt-0 md:mt-6 pt-0 md:pt-6 border-t border-gray-100 space-y-3",children:t.jsxs("button",{onClick:()=>O(m),className:"w-full py-4 bg-gray-900 hover:bg-black text-white rounded-xl font-bold transition-all shadow-lg shadow-gray-200 flex items-center justify-center gap-2",children:[t.jsx(F,{className:"w-5 h-5"}),"Download Image"]})})]})]})})]})]})};export{Pe as default};
