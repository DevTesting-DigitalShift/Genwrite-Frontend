var w=(i,r,a)=>new Promise((l,h)=>{var p=n=>{try{c(a.next(n))}catch(m){h(m)}},j=n=>{try{c(a.throw(n))}catch(m){h(m)}},c=n=>n.done?l(n.value):Promise.resolve(n.value).then(p,j);c((a=a.apply(i,r)).next())});import{j as e}from"./tiptap-BabmW22p.js";import{b as o,h as I}from"./vendor-CcjAMWu8.js";import{m as u,a as k}from"./index-CHEUOGl9.js";import{I as O,T as V,G as g,B as x,K as z,C as v,S as T,q as C,R,L as E,N,F as D}from"./antd-8WQTeuab.js";import{R as A}from"./LinkOutlined-BLM-fbyQ.js";import"./utils-DIb0lvMo.js";var H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M882 272.1V144c0-17.7-14.3-32-32-32H174c-17.7 0-32 14.3-32 32v128.1c-16.7 1-30 14.9-30 31.9v131.7a177 177 0 0014.4 70.4c4.3 10.2 9.6 19.8 15.6 28.9v345c0 17.6 14.3 32 32 32h676c17.7 0 32-14.3 32-32V535a175 175 0 0015.6-28.9c9.5-22.3 14.4-46 14.4-70.4V304c0-17-13.3-30.9-30-31.9zM214 184h596v88H214v-88zm362 656.1H448V736h128v104.1zm234 0H640V704c0-17.7-14.3-32-32-32H416c-17.7 0-32 14.3-32 32v136.1H214V597.9c2.9 1.4 5.9 2.8 9 4 22.3 9.4 46 14.1 70.4 14.1s48-4.7 70.4-14.1c13.8-5.8 26.8-13.2 38.7-22.1.2-.1.4-.1.6 0a180.4 180.4 0 0038.7 22.1c22.3 9.4 46 14.1 70.4 14.1 24.4 0 48-4.7 70.4-14.1 13.8-5.8 26.8-13.2 38.7-22.1.2-.1.4-.1.6 0a180.4 180.4 0 0038.7 22.1c22.3 9.4 46 14.1 70.4 14.1 24.4 0 48-4.7 70.4-14.1 3-1.3 6-2.6 9-4v242.2zm30-404.4c0 59.8-49 108.3-109.3 108.3-40.8 0-76.4-22.1-95.2-54.9-2.9-5-8.1-8.1-13.9-8.1h-.6c-5.7 0-11 3.1-13.9 8.1A109.24 109.24 0 01512 544c-40.7 0-76.2-22-95-54.7-3-5.1-8.4-8.3-14.3-8.3s-11.4 3.2-14.3 8.3a109.63 109.63 0 01-95.1 54.7C233 544 184 495.5 184 435.7v-91.2c0-.3.2-.5.5-.5h655c.3 0 .5.2.5.5v91.2z"}}]},name:"shop",theme:"outlined"};function b(){return b=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(i[l]=a[l])}return i},b.apply(this,arguments)}const $=(i,r)=>o.createElement(O,b({},i,{ref:r,icon:H})),B=o.forwardRef($),{Title:y,Text:d,Paragraph:P}=V,U=()=>{const i=I(),[r,a]=o.useState(!1),[l,h]=o.useState(!1),[p,j]=o.useState(null),[c,n]=o.useState([]);o.useEffect(()=>{function t(){return w(this,null,function*(){try{const s=yield window.shopify.idToken(),f=yield k.post("/callbacks/verify",{type:"SHOPIFY",token:s});f.status==200?(h(!0),n(f.data.blogs),j(null)):console.error("Auth failed")}catch(s){console.error("Error fetching token or data:",s)}finally{a(!1)}})}return window!=null&&window.shopify?t():window.addEventListener("shopify.loaded",t),()=>window.removeEventListener("shopify.loaded",t)},[]);const m=[{title:"Blog Title",dataIndex:["blogId","title"],key:"title",sorter:(t,s)=>t.blogId.title.localeCompare(s.blogId.title),filterMode:"tree",filterSearch:!0,filters:c.map(t=>({text:t.blogId.title,value:t.blogId.title})).filter((t,s,f)=>f.findIndex(S=>S.value===t.value)===s),onFilter:(t,s)=>s.blogId.title===t,render:t=>e.jsx(d,{strong:!0,children:t})},{title:"Posted On",dataIndex:"postedOn",key:"postedOn",sorter:(t,s)=>new Date(t.postedOn)-new Date(s.postedOn),defaultSortOrder:"descend",render:t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},{title:"Actions",key:"actions",render:(t,s)=>e.jsxs(g,{size:"middle",children:[e.jsx(x,{type:"link",icon:e.jsx(z,{}),onClick:()=>window.open(`/blog/${s.blogId._id}`,"_blank"),children:"View in Editor"}),e.jsx(x,{type:"link",icon:e.jsx(A,{}),onClick:()=>window.open(s.link,"_blank"),children:"View on Shopify"})]})}];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-teal-50 to-cyan-50 flex items-center justify-center p-4",children:e.jsx(u.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"w-full max-w-7xl",children:e.jsx(v,{className:"shadow-2xl border-0 overflow-hidden rounded-2xl",children:r?e.jsx("div",{className:"py-16 text-center",children:e.jsxs(g,{direction:"vertical",size:"large",className:"w-full",children:[e.jsx(u.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:e.jsx(B,{className:"text-7xl text-purple-500"})}),e.jsxs("div",{children:[e.jsx(y,{level:3,className:"text-gray-800",children:"Verifying Shopify Integration"}),e.jsxs(P,{className:"text-gray-600",children:["Please wait while we connect to your Shopify store...",DUMMY_MODE&&e.jsx("div",{className:"mt-2",children:e.jsx(d,{type:"secondary",className:"text-xs",children:"(Running in dummy simulation mode)"})})]})]}),e.jsx(T,{indicator:e.jsx(C,{style:{fontSize:32},spin:!0})})]})}):p?e.jsx(R,{status:"error",icon:e.jsx(u.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,damping:15},children:e.jsx(E,{className:"text-6xl text-red-500"})}),title:e.jsx(y,{level:2,className:"text-red-700",children:"Verification Failed"}),subTitle:e.jsxs("div",{className:"text-left max-w-md mx-auto",children:[e.jsx(d,{className:"text-gray-600 block mb-4",children:p}),e.jsx(v,{className:"bg-gray-50 border-gray-200 text-left",children:e.jsxs(g,{direction:"vertical",size:"small",className:"w-full",children:[e.jsx(d,{strong:!0,className:"text-sm",children:"Troubleshooting:"}),e.jsxs("ul",{className:"text-xs text-gray-600 pl-4 space-y-1",children:[e.jsx("li",{children:"Ensure this page is accessed from within Shopify Admin"}),e.jsx("li",{children:"Check if the Shopify App Bridge script is loaded"}),e.jsx("li",{children:"Verify your API key is correctly configured"}),e.jsx("li",{children:"Check your backend server is running"})]})]})})]}),extra:[e.jsx(x,{type:"primary",onClick:()=>window.location.reload(),className:"bg-purple-600 hover:bg-purple-700 border-0",children:"Try Again"},"retry"),e.jsx(x,{onClick:()=>i("/"),children:"Go Home"},"home")]}):l?e.jsxs("div",{className:"p-6",children:[e.jsx(u.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},className:"mb-6",children:e.jsxs(g,{direction:"vertical",size:"middle",className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"text-4xl text-emerald-500"}),e.jsxs("div",{children:[e.jsx(y,{level:2,className:"!mb-0 text-emerald-700",children:"You Are Verified!"}),e.jsx(d,{className:"text-gray-600",children:"Your Shopify store has been successfully verified and connected to GenWrite."})]})]}),e.jsx(v,{className:"bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"text-emerald-600"}),e.jsx(d,{strong:!0,children:"Session Token Verified"})]})})]})}),e.jsx(y,{level:4,className:"mb-4",children:"Posted Blogs"}),e.jsx(D,{columns:m,dataSource:c,rowKey:"_id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:t=>`Total ${t} blogs`},className:"shadow-sm"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(x,{type:"primary",size:"large",onClick:()=>i("/dashboard"),className:"bg-gradient-to-r from-purple-600 to-teal-600 hover:from-purple-700 hover:to-teal-700 border-0 font-semibold shadow-lg",children:"Go to Dashboard"})})]}):null})})})};export{U as default};
