var Oe=Object.defineProperty,ze=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var Ne=Object.getOwnPropertySymbols;var He=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var ve=(o,r,t)=>r in o?Oe(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,ke=(o,r)=>{for(var t in r||(r={}))He.call(r,t)&&ve(o,t,r[t]);if(Ne)for(var t of Ne(r))$e.call(r,t)&&ve(o,t,r[t]);return o},Ce=(o,r)=>ze(o,We(r));var Le=(o,r,t)=>new Promise((M,i)=>{var b=x=>{try{j(t.next(x))}catch(u){i(u)}},v=x=>{try{j(t.throw(x))}catch(u){i(u)}},j=x=>x.done?M(x.value):Promise.resolve(x.value).then(b,v);j((t=t.apply(o,r)).next())});import{j as e}from"./tiptap-BabmW22p.js";import{b as m,h as Fe}from"./vendor-CcjAMWu8.js";import{g as Se}from"./getEstimatedCost-DzNasHfA.js";import{r as qe}from"./analysisApi-DM6-hWp4.js";import{getBlogById as Re}from"./blogApi-mE4NxLdq.js";import{u as Ve}from"./useAuthStore-CU2rUJjR.js";import{u as Ye}from"./useBlogStore-BQIN_wgC.js";import{u as Qe}from"./useAnalysisStore-CRW_-n-r.js";import{u as Ue,b as Ge,L as Je,m as p}from"./index-CHEUOGl9.js";import{u as Xe}from"./blogQueries-anuKp3p3.js";import{M as Ze,c as W,l as De,b as I,E as et,w as tt,x as st,C as H,B as Me,q as at,o as S,e as $,s as nt}from"./antd-8WQTeuab.js";import{A as F}from"./Dashboard-Bg0J7aZZ.js";import{E as Ae}from"./external-link-begc_cRZ.js";import{L as it}from"./link-Beq0l1Jq.js";import"./utils-DIb0lvMo.js";import"./DataLayer-DALerVhB.js";import"./react-wNxFir7h.js";import"./useQuery-CEoF32mJ.js";import"./useJobStore-0ufV0pgR.js";import"./x-z7Bk40f8.js";import"./sparkles-CoI3F60w.js";import"./zap-DSuKdz2Q.js";import"./arrow-left-D6iFa1kI.js";import"./arrow-right-D4AZYMai.js";import"./index-B-4cM6gv.js";import"./iconBase-jLLagxb6.js";import"./pen-tool-B8SuCrxg.js";import"./wand-sparkles-DmuHGkb_.js";import"./globe-BdpK_R9r.js";import"./search-Csb6xL5U.js";import"./rocket-BA6hy582.js";import"./youtube-CboCbLhy.js";import"./image-lSAt2h0F.js";import"./coins-HDNjU8ii.js";import"./trending-up-5qho0oV1.js";import"./file-text-KIhDxHtJ.js";import"./cloud-upload-DA2vKEBT.js";import"./chevron-right-DI-Tux5P.js";const{Panel:L}=S,Vt=({closeFnc:o,open:r})=>{var Z,D,ee,te,se,ae,ne,ie,re,le,de,oe,ce,me,xe,he,ge,ue,pe,ye,be,je,fe;const[t,M]=m.useState({title:"",content:"",keywords:[],focusKeywords:[],contentType:"markdown",selectedProject:null,generatedMetadata:null}),[i,b]=m.useState(null),[v,j]=m.useState(null),[x,u]=m.useState(!1),[_e,y]=m.useState(null),[P,T]=m.useState(0),Ie=Fe(),{user:f}=Ve(),{handlePopup:Pe}=Ue();Ge();const{analysisResult:E,loading:w,setAnalysisResult:Te,setLoading:q}=Qe(),B=E==null?void 0:E[(Z=t==null?void 0:t.selectedProject)==null?void 0:Z._id];m.useEffect(()=>{!w&&B&&b(B)},[B,w]),m.useEffect(()=>{r||(M({title:"",content:"",keywords:[],focusKeywords:[],contentType:"markdown",selectedProject:null,generatedMetadata:null}),b(null),j(null),u(!1),y(null),T(0))},[r]);const{data:k}=Xe(),N=Array.isArray(k)?k:(k==null?void 0:k.blogs)||[];m.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[r]),m.useEffect(()=>{v&&(u(!0),Re(v).then(s=>{s!=null&&s._id&&M(a=>Ce(ke({},a),{title:s.title,content:s.content||"",keywords:s.keywords||[],focusKeywords:s.focusKeywords||[],selectedProject:s,contentType:"markdown",generatedMetadata:s.generatedMetadata||null}))}).catch(s=>{console.error("Failed to fetch blog by ID:",s)}).finally(()=>u(!1)))},[v]),m.useEffect(()=>{var g,c,C,z,_;const s=O.length>0,a=((c=(g=t==null?void 0:t.generatedMetadata)==null?void 0:g.outboundLinks)==null?void 0:c.length)>0,n=((z=(C=t==null?void 0:t.generatedMetadata)==null?void 0:C.internalLinks)==null?void 0:z.length)>0,d=!!i,l=!!((_=t==null?void 0:t.generatedMetadata)!=null&&_.competitorsAnalysis);y(d?"results":s?"competitors":a||n?"links":l?"initial-analysis":null)},[i,(D=t==null?void 0:t.generatedMetadata)==null?void 0:D.competitors,(ee=t==null?void 0:t.generatedMetadata)==null?void 0:ee.outboundLinks,(te=t==null?void 0:t.generatedMetadata)==null?void 0:te.internalLinks,(se=t==null?void 0:t.generatedMetadata)==null?void 0:se.competitorsAnalysis]);const Ee=s=>{const a=N==null?void 0:N.find(n=>n._id===s);a&&(j(a._id),b(null),T(n=>n+1))},Be=()=>Le(null,null,function*(){var n,d,l,g;if(!t.title.trim()||!t.content.trim()||t.keywords.length===0&&t.focusKeywords.length===0)return;if(t.content.length<500){nt.warning("Your content is too short. This may affect competitive analysis accuracy.");return}const s=Se("analysis.competitors"),a=(((n=f==null?void 0:f.credits)==null?void 0:n.base)||0)+(((d=f==null?void 0:f.credits)==null?void 0:d.extra)||0);if(a<s){Pe({title:"Insufficient Credits",description:e.jsxs("div",{children:[e.jsx("p",{children:"You don't have enough credits to run this competitive analysis."}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Required:"})," ",s," credits"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Available:"})," ",a," credits"]})]}),okText:"Buy Credits",onConfirm:()=>{Ie("/pricing"),o()}});return}u(!0),q(!0);try{const c=yield qe({title:t.title,content:t.content,keywords:[...new Set([...t.keywords,...t.focusKeywords])],contentType:t.contentType,blogId:(l=t==null?void 0:t.selectedProject)==null?void 0:l._id});Te((g=t==null?void 0:t.selectedProject)==null?void 0:g._id,c),b(c)}catch(c){console.error("Error fetching analysis:",c)}finally{u(!1),q(!1)}}),h=s=>s?s.replace(/#{1,3}\s/g,"").replace(/[\*_~`]/g,"").replace(/\n+/g,`
`).trim():"",K=s=>s?h(s).split(`
`).filter(a=>a.trim()!=="").map((a,n)=>e.jsx("p",{className:"mb-2 text-sm md:text-base",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:a.trim().replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}})},n)):[],Ke=s=>!s||s.length===0?null:e.jsx(S,{accordion:!0,className:"bg-white border border-gray-200 rounded-lg",children:s.map((a,n)=>{var d;return e.jsx(L,{header:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center w-full pr-2",children:[e.jsx("span",{className:"font-medium text-gray-800 truncate max-w-[80%] sm:max-w-[60%] text-sm md:text-base",children:h(a.title)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 sm:mt-0",children:[e.jsx($,{title:"Relatable Score",children:a.score&&e.jsxs(I,{color:"blue",children:[(a.score*100).toFixed(2),"%"]})}),e.jsxs("a",{href:(d=a==null?void 0:a.link)!=null?d:a==null?void 0:a.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-sm hover:underline flex items-center gap-1",onClick:l=>l.stopPropagation(),children:["Visit ",e.jsx(Ae,{className:"w-4 h-4"})]})]})]}),className:"text-sm md:text-base text-gray-700 leading-relaxed",children:a!=null&&a.content?e.jsx("div",{children:K(a.content)}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2 font-medium",children:h(a.snippet||a.content)}),e.jsx("div",{children:K(a.summary)})]})},n)})},P),R=(s,a)=>!s||s.length===0?null:e.jsx(H,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded text-blue-500",children:e.jsx(it,{size:20,strokeWidth:2})}),e.jsx("span",{className:"text-base md:text-lg font-semibold text-gray-800",children:a})]}),className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:e.jsx(S,{accordion:!0,children:s.map((n,d)=>e.jsxs(L,{header:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center w-full",children:[e.jsx("span",{className:"text-sm md:text-base font-medium text-gray-800",children:h(n.title)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 sm:mt-0",children:[e.jsx($,{title:"Relatable Score",children:n.score&&e.jsxs(I,{color:"blue",children:[(n.score*100).toFixed(2),"%"]})}),e.jsxs("a",{href:n.link||n.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-sm hover:underline flex items-center gap-1",onClick:l=>l.stopPropagation(),children:["Visit ",e.jsx(Ae,{className:"w-4 h-4"})]})]})]}),className:"text-sm md:text-base text-gray-700 leading-relaxed",children:[e.jsx("p",{className:"text-gray-600",children:h(n.snippet||n.content)}),n.summary&&e.jsx("div",{children:K(n.summary)})]},d))},P)}),V=s=>{if(!s)return null;const{analysis:a,suggestions:n}=s;return e.jsx(H,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-100 rounded text-purple-500",children:e.jsx(F,{size:20,strokeWidth:2})}),e.jsx("span",{className:"text-base md:text-lg font-semibold text-gray-800",children:"Competitors Analysis"})]}),className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:e.jsxs(S,{accordion:!0,expandIconPosition:"right",children:[e.jsx(L,{header:e.jsx("span",{className:"font-semibold text-gray-800 text-sm md:text-base",children:"Analysis"}),children:e.jsx(S,{accordion:!0,children:Object.entries(a).map(([d,l],g)=>{var we;const{score:c,maxScore:C,feedback:z}=l,_=h((we=l==null?void 0:l.feedback)==null?void 0:we.replace(/\s*\(\d+\/\d+\)$/,"").trim());return e.jsx(L,{header:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center w-full pr-2",children:[e.jsx("span",{className:"font-medium text-gray-800 text-sm md:text-base",children:h(d)}),e.jsx($,{title:"Relatable Score",children:c&&C&&e.jsxs(I,{color:"blue",children:[c,"/",C]})})]}),className:"text-sm md:text-base text-gray-700 leading-relaxed",children:e.jsx("p",{children:_})},d)})})},"analysis"),e.jsx(L,{header:e.jsx("span",{className:"font-semibold text-gray-800 text-sm md:text-base",children:"Suggestions"}),children:e.jsx("ul",{className:"list-decimal pl-6 space-y-3 text-sm md:text-base text-gray-700",children:(Array.isArray(n)?n:n.split(/(?:\d+\.\s)/)).filter(Boolean).map((d,l)=>e.jsx("li",{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:h(d.trim()).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}})},l))})},"suggestions")]},P)})},O=m.useMemo(()=>{var l;const s=((l=t==null?void 0:t.generatedMetadata)==null?void 0:l.competitors)||[],a=(i==null?void 0:i.competitors)||[],n=[],d=new Set;return[...s,...a].forEach(g=>{const c=g.url||g.link;d.has(c)||(d.add(c),n.push(g))}),n},[(ae=t==null?void 0:t.generatedMetadata)==null?void 0:ae.competitors,i==null?void 0:i.competitors]),Y=m.useMemo(()=>[...new Set([...t.keywords,...t.focusKeywords])],[t.keywords,t.focusKeywords]),Q=O.length>0,U=((ie=(ne=t==null?void 0:t.generatedMetadata)==null?void 0:ne.outboundLinks)==null?void 0:ie.length)>0,G=((le=(re=t==null?void 0:t.generatedMetadata)==null?void 0:re.internalLinks)==null?void 0:le.length)>0,J=!!i,X=!!((de=t==null?void 0:t.generatedMetadata)!=null&&de.competitorsAnalysis),A=Ye(s=>s.loading);return x||A||w?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:e.jsx(Je,{})}):e.jsx(Ze,{open:r,title:e.jsxs(p.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg text-white",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})}),e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-gray-900",children:"Competitive Analysis Dashboard"})]}),onCancel:o,footer:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated Cost:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[Se("analysis.competitors")," credits"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(Me,{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition w-full sm:w-auto",children:"Close"}),e.jsx(Me,{onClick:Be,className:`px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition w-full sm:w-auto ${x||A||w?"opacity-50 cursor-not-allowed":""}`,disabled:x||A||w,children:x||A||w?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(at,{}),i?"Re-Analyzing...":"Analyzing..."]}):i?"Re-Run Analysis":"Run Competitive Analysis"})]})]},"footer")],width:"100%",className:"w-full max-w-[90vw] md:max-w-3xl lg:max-w-4xl",centered:!0,closable:!0,transitionName:"",maskTransitionName:"",styles:{body:{maxHeight:"80vh",overflowY:"auto",padding:"12px sm:16px"}},children:e.jsxs("div",{className:"space-y-4 sm:space-y-6 p-5",children:[e.jsxs(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx("label",{className:"block text-sm md:text-base font-medium text-gray-700 mb-2",children:"Select Blog Post"}),e.jsxs(W,{showSearch:!0,filterOption:(s,a)=>{var n;return(n=a==null?void 0:a.children)==null?void 0:n.toLowerCase().includes(s.toLowerCase())},className:"w-full rounded-md text-sm md:text-base",onChange:Ee,value:((oe=t.selectedProject)==null?void 0:oe._id)||"",placeholder:"Select a blog",children:[e.jsx(W.Option,{value:"",children:"Select a blog"}),N==null?void 0:N.map(s=>e.jsx(W.Option,{value:s._id,children:s.title.charAt(0).toUpperCase()+s.title.slice(1)},s._id))]})]}),t.selectedProject&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-3 sm:p-4 bg-gray-50 border-b border-gray-200",children:e.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-700",children:"Blog Details"})}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("label",{className:"block text-sm md:text-base font-medium text-gray-600 mb-1",children:"Title"}),e.jsx(De,{name:"title",value:t.title,readOnly:!0,className:"w-full bg-gray-100 cursor-not-allowed text-sm md:text-base"})]}),Y.length>0&&e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("label",{className:"block text-sm md:text-base font-medium text-gray-600 mb-1",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map((s,a)=>e.jsx(I,{className:"flex items-center gap-1 bg-blue-50 text-blue-700 border-blue-100 text-sm",children:h(s)},s))})]}),t.content?e.jsx("div",{className:"text-gray-700 max-h-60 overflow-y-auto p-3 sm:p-4 bg-gray-50 rounded-md text-sm md:text-base prose prose-sm max-w-none [&_img]:max-w-full [&_img]:h-auto [&_img]:rounded-lg",dangerouslySetInnerHTML:{__html:t.content}}):e.jsx(et,{description:"No content available for this blog"})]})]}),((ce=t.generatedMetadata)==null?void 0:ce.seo_meta)&&e.jsxs(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-3 sm:p-4 bg-gray-50 border-b border-gray-200",children:e.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-700",children:"SEO Metadata"})}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("p",{className:"text-sm md:text-base text-gray-600",children:[e.jsx("strong",{children:"Title:"})," ",h(t.generatedMetadata.seo_meta.title)]}),e.jsxs("p",{className:"text-sm md:text-base text-gray-600 mt-2",children:[e.jsx("strong",{children:"Description:"})," ",h(t.generatedMetadata.seo_meta.description)]})]})]})]}),!t.selectedProject&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8 sm:py-10 bg-gray-50 rounded-xl border border-gray-200 shadow-sm",children:e.jsx("p",{className:"text-gray-600 text-sm md:text-lg",children:"Select a blog to view details and analysis"})}),(Q||U||G||J||X)&&e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(tt,{activeKey:_e,onChange:s=>{y(s),T(a=>a+1)},type:"card",className:"w-full",children:[J&&e.jsx("div",{tab:e.jsxs("span",{className:"flex items-center gap-2 text-sm md:text-base",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 3v18h18"}),e.jsx("path",{d:"m19 9-5 5-4-4-3 3"})]}),"Analysis Results"]}),children:e.jsxs(p.div,{animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"space-y-4 sm:space-y-6",children:[e.jsxs(p.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.2,duration:.5},className:"flex flex-col items-center my-10",children:[e.jsx(st,{type:"dashboard",percent:Number((xe=(me=i.insights)==null?void 0:me.blogScore)!=null?xe:0),width:120,format:s=>`${s} / 100`,strokeColor:{"0%":"#1B6FC9","100%":"#4C9FE8"},trailColor:"#e5e7eb"}),e.jsx("div",{className:"text-gray-800 text-base md:text-lg font-semibold mt-3",children:"Blog SEO Score"})]}),e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},children:e.jsx(H,{title:"Suggestions to Beat Competitors",className:"bg-white border border-gray-200 rounded-lg shadow-sm",headStyle:{background:"#f9fafb",fontWeight:600,fontSize:"0.9rem sm:1.1rem"},children:e.jsx("ul",{className:"list-decimal pl-6 space-y-3 text-sm md:text-base text-gray-700",children:(ye=Array.isArray((he=i==null?void 0:i.insights)==null?void 0:he.suggestions)?(ge=i==null?void 0:i.insights)==null?void 0:ge.suggestions:(pe=(ue=i==null?void 0:i.insights)==null?void 0:ue.suggestions)==null?void 0:pe.split(/(?:\d+\.\s)/))==null?void 0:ye.filter(Boolean).map((s,a)=>e.jsx("li",{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:h(s.trim()).replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}})},a))})})}),V(i==null?void 0:i.insights)]})},"results"),Q&&e.jsx("div",{tab:e.jsxs("span",{className:"flex items-center gap-2 text-sm md:text-base",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]}),"Competitors"]}),children:Ke(O)},"competitors"),(U||G)&&e.jsx("div",{tab:e.jsxs("span",{className:"flex items-center gap-2 text-sm md:text-base",children:[e.jsx(F,{size:20,strokeWidth:2}),"Links"]}),children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[R((be=t==null?void 0:t.generatedMetadata)==null?void 0:be.outboundLinks,"Outbound Links"),R((je=t==null?void 0:t.generatedMetadata)==null?void 0:je.internalLinks,"Internal Links")]})},"links"),X&&e.jsx("div",{tab:e.jsxs("span",{className:"flex items-center gap-2 text-sm md:text-base",children:[e.jsx(F,{size:20,strokeWidth:2}),"Initial Analysis"]}),children:V((fe=t==null?void 0:t.generatedMetadata)==null?void 0:fe.competitorsAnalysis)},"initial-analysis")]})})]})})};export{Vt as default};
