var B=Object.defineProperty,S=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var C=(s,i,a)=>i in s?B(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a,M=(s,i)=>{for(var a in i||(i={}))H.call(i,a)&&C(s,a,i[a]);if(k)for(var a of k(i))L.call(i,a)&&C(s,a,i[a]);return s},F=(s,i)=>S(s,$(i));var D=(s,i,a)=>new Promise((h,r)=>{var x=n=>{try{l(a.next(n))}catch(d){r(d)}},u=n=>{try{l(a.throw(n))}catch(d){r(d)}},l=n=>n.done?h(n.value):Promise.resolve(n.value).then(x,u);l((a=a.apply(s,i)).next())});import{j as e}from"./tiptap-BabmW22p.js";import{b as f}from"./vendor-CcjAMWu8.js";import{u as K}from"./useAuthStore-CU2rUJjR.js";import{u as V,d as _}from"./toolsQueries-CZX1d2lA.js";import{c as z,u as W,H as G,A as O,m as b}from"./index-CHEUOGl9.js";import{g as Y}from"./getEstimatedCost-DzNasHfA.js";import{F as Z}from"./file-text-KIhDxHtJ.js";import{B as A,V as J,l as Q,s as w}from"./antd-8WQTeuab.js";import{T as X}from"./trash-2-CXprfFVP.js";import{U as ee}from"./upload-DkfPBW6S.js";import{M as te,r as se}from"./index-BZl_8pLc.js";import{U as ae}from"./user-BdDXs_Ke.js";import{L as ie}from"./loader-circle-DcQOKVDQ.js";import{A as oe}from"./arrow-right-D4AZYMai.js";import"./DataLayer-DALerVhB.js";import"./react-wNxFir7h.js";import"./utils-DIb0lvMo.js";const re=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]],P=z("brain-circuit",re);const le=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}]],ne=z("file",le);function de(s,i,a="gemini"){var x,u;const h=Y(i,a),r=(((x=s==null?void 0:s.credits)==null?void 0:x.base)||0)+(((u=s==null?void 0:s.credits)==null?void 0:u.extra)||0);return{hasEnough:r>=h,required:h,available:r}}function ce(s,i,a="this feature"){return{title:"Insufficient Credits",description:e.jsxs("div",{children:[e.jsxs("p",{children:["You don't have enough credits to use ",a,"."]}),e.jsxs("p",{className:"mt-2",children:[e.jsx("strong",{children:"Required:"})," ",s," credits"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Available:"})," ",i," credits"]})]}),okText:"Buy Credits"}}const{Dragger:me}=J,{TextArea:he}=Q,ze=()=>{const{pdfChat:s,resetPdfChat:i}=V(),{cacheKey:a}=s,{mutateAsync:h,isLoading:r}=_(),{user:x}=K(),{handlePopup:u}=W(),[l,n]=f.useState(null),[d,g]=f.useState([{id:1,role:"model",content:"Hi! Upload a PDF and I'll analyze it for you. Then you can ask me anything about it.",timestamp:new Date}]),[p,j]=f.useState(""),y=f.useRef(null),q=()=>{var t;(t=y.current)==null||t.scrollIntoView({behavior:"smooth"})};f.useEffect(()=>{q()},[d,r]);const R=t=>{const{status:c}=t.file;if(c==="done"){const o=t.file.originFileObj;if(o.size>2*1024*1024){w.error(`File is too large (${(o.size/1024/1024).toFixed(2)}MB). Max size is 2MB.`);return}n(o),w.success(`${o.name} uploaded successfully!`),g([{id:1,role:"model",content:`I've analyzed "${o.name}". What would you like to know?`,timestamp:new Date}])}else c==="error"&&w.error(`${t.file.name} file upload failed.`)},U=({onSuccess:t})=>{setTimeout(()=>{t("ok")},0)},v=()=>D(null,null,function*(){if(!p.trim()||!l)return;const t=de(x,"tools.chatpdf","gemini");if(!t.hasEnough){const o=ce(t.required,t.available,"Chat with PDF");u(F(M({},o),{onConfirm:()=>{window.location.href="/pricing"}}));return}const c={id:Date.now(),role:"user",content:p,timestamp:new Date};g(o=>[...o,c]),j("");try{let o;if(a){const m=d.slice(-10).map(N=>({role:N.role,content:N.content}));o={cacheKey:a,messages:m,question:c.content}}else{const m=new FormData;m.append("file",l),m.append("question",c.content),o=m}const T=yield h(o);g(m=>[...m,{id:Date.now()+1,role:"model",content:T.text,timestamp:new Date}])}catch(o){w.error((o==null?void 0:o.message)||"Failed to get response")}}),E=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),v())},I=()=>{n(null),i(),g([{id:1,role:"model",content:"Hi! Upload a PDF and I'll analyze it for you. Then you can ask me anything about it.",timestamp:new Date}])};return e.jsxs("div",{className:"min-h-screen bg-[#F8FAFC]",children:[e.jsx(G,{children:e.jsx("title",{children:"Chat with PDF | GenWrite"})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6 lg:p-8 h-screen flex flex-col gap-6",children:[e.jsxs("header",{className:"flex items-center justify-between bg-white/80 backdrop-blur-xl p-4 rounded-2xl border border-white/20 shadow-sm sticky top-0 z-10 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/20 text-white transform hover:scale-105 transition-transform duration-300",children:e.jsx(Z,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-slate-800 tracking-tight",children:"Chat with PDF"}),e.jsx("p",{className:"text-sm text-slate-500 font-medium",children:"Research Assistant"})]})]}),l&&e.jsxs(A,{danger:!0,type:"text",className:"hover:bg-red-50 text-red-600 rounded-xl font-medium flex items-center gap-2",onClick:I,children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"End Session"})]})]}),e.jsx("div",{className:"flex-1 relative overflow-hidden flex flex-col",children:e.jsx(O,{mode:"wait",children:l?e.jsxs(b.div,{initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0},className:"flex flex-col h-full bg-white rounded-3xl shadow-xl shadow-slate-200/40 border border-slate-100 overflow-hidden",children:[e.jsxs("div",{className:"h-14 bg-white border-b border-slate-100 flex items-center justify-between px-6 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-red-50 p-1.5 rounded text-red-500",children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-semibold text-slate-700 truncate max-w-[200px] md:max-w-md",children:l.name})})]}),e.jsxs("div",{className:"text-xs font-mono text-slate-400 bg-slate-100 px-2 py-1 rounded",children:[(l.size/1024/1024).toFixed(2)," MB"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 space-y-8 bg-slate-50/30 scroll-smooth",children:[d.map((t,c)=>e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex gap-4 ${t.role==="user"?"justify-end":"justify-start"}`,children:[t.role==="model"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-violet-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-indigo-500/20 text-white mt-1",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("div",{className:`
                        max-w-[85%] md:max-w-[75%] p-4 md:p-6 rounded-2xl text-[15px] leading-relaxed shadow-sm
                        ${t.role==="user"?"bg-gradient-to-br from-slate-900 to-slate-800 text-white rounded-tr-none":"bg-white text-slate-700 border border-slate-100 rounded-tl-none"}
                      `,children:t.role==="model"?e.jsx("div",{className:"prose prose-sm max-w-none prose-slate",children:e.jsx(te,{remarkPlugins:[se],children:t.content})}):t.content}),t.role==="user"&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center flex-shrink-0 mt-1",children:e.jsx(ae,{className:"w-4 h-4 text-slate-500"})})]},t.id)),r&&e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},className:"flex gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-600 to-violet-600 flex items-center justify-center flex-shrink-0 shadow-lg shadow-indigo-500/20 text-white mt-1",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsxs("div",{className:"bg-white px-6 py-4 rounded-2xl rounded-tl-none border border-slate-100 shadow-sm flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-bounce delay-200"})]})]}),e.jsx("div",{ref:y})]}),e.jsxs("div",{className:"p-4 md:p-6 bg-white border-t border-slate-100",children:[e.jsxs("div",{className:"max-w-4xl mx-auto relative group",children:[e.jsx(he,{value:p,onChange:t=>j(t.target.value),onKeyPress:E,placeholder:"Ask a question about your document...",autoSize:{minRows:1,maxRows:6},className:"!pr-14 !pl-6 !py-4 !rounded-2xl !bg-slate-50 !border-slate-200 focus:!bg-white focus:!border-indigo-500 hover:!border-indigo-300 !text-slate-800 !text-base !resize-none !shadow-inner transition-all",disabled:r}),e.jsx(A,{type:"primary",shape:"circle",size:"large",icon:r?e.jsx(ie,{className:"w-5 h-5 animate-spin"}):e.jsx(oe,{className:"w-5 h-5"}),onClick:v,disabled:!p.trim()||r,className:`absolute right-2 bottom-2 !flex !items-center !justify-center !w-10 !h-10 !border-0 !shadow-lg ${!p.trim()||r?"!bg-slate-200 !text-slate-400":"!bg-gradient-to-r !from-indigo-600 !to-violet-600 !text-white hover:!scale-110"} transition-all duration-300`})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsx("p",{className:"text-xs text-slate-400",children:"AI can assist with key findings, summaries, and data extraction. (Cost: 1 credit/message)"})})]})]},"chat-interface"):e.jsx(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"items-center justify-center",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 inset-x-0 h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"}),e.jsxs("div",{className:"p-4 md:p-8 h-[35rem]",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-50 rounded-2xl flex items-center justify-center mx-auto mb-4 animate-bounce-slow",children:e.jsx(ee,{className:"w-8 h-8 text-indigo-600"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Upload your PDF"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Up to 2MB â€¢ Auto-OCR included"})]}),e.jsx("div",{className:"relative group",children:e.jsx(me,{accept:".pdf",customRequest:U,onChange:R,showUploadList:!1,className:"!border-0 !bg-transparent w-full",style:{padding:0},children:e.jsxs("div",{className:`border-2 border-dashed border-slate-200 rounded-2xl p-10 bg-slate-50/50 \r
                group-hover:bg-indigo-50/30 group-hover:border-indigo-400 \r
                transition-all cursor-pointer text-center h-[20rem]\r
                flex flex-col items-center justify-center`,children:[e.jsx("p",{className:"text-indigo-600 font-medium mb-2",children:"Click to browse"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"or drag and drop here"})]})})})]})]})})},"upload-view")})})]})]})};export{ze as default};
