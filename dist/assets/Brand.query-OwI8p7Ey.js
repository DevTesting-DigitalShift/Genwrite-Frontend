var U=Object.defineProperty,_=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var P=r=>{throw TypeError(r)};var I=(r,t,e)=>t in r?U(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,n=(r,t)=>{for(var e in t||(t={}))k.call(t,e)&&I(r,e,t[e]);if(F)for(var e of F(t))A.call(t,e)&&I(r,e,t[e]);return r},p=(r,t)=>_(r,T(t));var a=(r,t,e)=>I(r,typeof t!="symbol"?t+"":t,e),$=(r,t,e)=>t.has(r)||P("Cannot "+e);var u=(r,t,e)=>($(r,t,"read from private field"),e?e.call(r):t.get(r)),C=(r,t,e)=>t.has(r)?P("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),g=(r,t,e,s)=>($(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e),v=(r,t,e)=>($(r,t,"access private method"),e);var d=(r,t,e)=>new Promise((s,i)=>{var h=o=>{try{l(e.next(o))}catch(Q){i(Q)}},y=o=>{try{l(e.throw(o))}catch(Q){i(Q)}},l=o=>o.done?s(o.value):Promise.resolve(o.value).then(h,y);l((e=e.apply(r,t)).next())});import{u as x}from"./useQuery-le9Y4dQq.js";import{r as w}from"./vendor-D8zynvq1.js";import{ao as j,ar as H,aH as R,aI as J,aB as L,k as W,at as z,aC as G,aJ as N,E as O}from"./index-6Wzook5W.js";import{u as X}from"./useInfiniteQuery-DnSVOttl.js";var f,K,c,b,m,D,E,B,Y=(B=class extends j{constructor(t,e){super();C(this,m);C(this,f);C(this,K);C(this,c);C(this,b);g(this,f,t),this.setOptions(e),this.bindMethods(),v(this,m,D).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const e=this.options;this.options=u(this,f).defaultMutationOptions(t),H(this.options,e)||u(this,f).getMutationCache().notify({type:"observerOptionsUpdated",mutation:u(this,c),observer:this}),e!=null&&e.mutationKey&&this.options.mutationKey&&R(e.mutationKey)!==R(this.options.mutationKey)?this.reset():((s=u(this,c))==null?void 0:s.state.status)==="pending"&&u(this,c).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=u(this,c))==null||t.removeObserver(this)}onMutationUpdate(t){v(this,m,D).call(this),v(this,m,E).call(this,t)}getCurrentResult(){return u(this,K)}reset(){var t;(t=u(this,c))==null||t.removeObserver(this),g(this,c,void 0),v(this,m,D).call(this),v(this,m,E).call(this)}mutate(t,e){var s;return g(this,b,e),(s=u(this,c))==null||s.removeObserver(this),g(this,c,u(this,f).getMutationCache().build(u(this,f),this.options)),u(this,c).addObserver(this),u(this,c).execute(t)}},f=new WeakMap,K=new WeakMap,c=new WeakMap,b=new WeakMap,m=new WeakSet,D=function(){var e,s;const t=(s=(e=u(this,c))==null?void 0:e.state)!=null?s:J();g(this,K,p(n({},t),{isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}))},E=function(t){L.batch(()=>{var e,s,i,h,y,l,o,Q;if(u(this,b)&&this.hasListeners()){const q=u(this,K).variables,S=u(this,K).context,M={client:u(this,f),meta:this.options.meta,mutationKey:this.options.mutationKey};(t==null?void 0:t.type)==="success"?((s=(e=u(this,b)).onSuccess)==null||s.call(e,t.data,q,S,M),(h=(i=u(this,b)).onSettled)==null||h.call(i,t.data,null,q,S,M)):(t==null?void 0:t.type)==="error"&&((l=(y=u(this,b)).onError)==null||l.call(y,t.error,q,S,M),(Q=(o=u(this,b)).onSettled)==null||Q.call(o,void 0,t.error,q,S,M))}this.listeners.forEach(q=>{q(u(this,K))})})},B);function Z(r,t){const e=W(),[s]=w.useState(()=>new Y(e,r));w.useEffect(()=>{s.setOptions(r)},[s,r]);const i=w.useSyncExternalStore(w.useCallback(y=>s.subscribe(L.batchCalls(y)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),h=w.useCallback((y,l)=>{s.mutate(y,l).catch(z)},[s]);if(i.error&&G(s.options.throwOnError,[i.error]))throw i.error;return p(n({},i),{mutate:h,mutateAsync:i.mutate})}class V{constructor(){a(this,"queryClient",N);a(this,"defaultQueryOptions",{staleTime:1/0,gcTime:1/0,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!1,retry:1});a(this,"useFetchQuery",(t,e,s)=>x(n(n({queryKey:[...this.baseKey,t],queryFn:e},this.defaultQueryOptions),s)));a(this,"useParamQuery",(t,e,s,i)=>x(n(n({queryKey:[...this.baseKey,t,s],queryFn:()=>e(s)},this.defaultQueryOptions),i)));a(this,"useInfiniteQuery",(t,e,s,i,h)=>X(n(n({queryKey:[...this.baseKey,t,i],queryFn:({pageParam:y=1})=>e(p(n({},i),{page:y})),getNextPageParam:s,initialPageParam:1},this.defaultQueryOptions),h)));a(this,"useMutate",(t,e)=>Z(n({mutationFn:t},e)));a(this,"setData",(t,e,s)=>{this.queryClient.setQueryData([...this.baseKey,t,e],s)});a(this,"invalidate",t=>this.queryClient.invalidateQueries({queryKey:t?[...this.baseKey,t]:this.baseKey}));a(this,"prefetch",(t,e,s)=>d(this,null,function*(){try{return yield this.queryClient.prefetchQuery(n({queryKey:[...this.baseKey,t],queryFn:e},s)),!0}catch(i){return console.warn(`Prefetch error [${this.baseKey}]:`,i),!1}}));a(this,"prefetchParam",(t,e,s,i)=>d(this,null,function*(){try{return yield this.queryClient.prefetchQuery(n({queryKey:[...this.baseKey,t,s],queryFn:()=>e(s)},i)),!0}catch(h){return console.warn(`Prefetch error [${this.baseKey}]:`,h),!1}}))}}class ee extends V{constructor(){super(...arguments);a(this,"useList",e=>this.useFetchQuery("list",()=>this.api.list(),e));a(this,"useListParams",(e,s)=>this.useParamQuery("list",this.api.list,e,s));a(this,"useDetail",(e,s)=>this.useFetchQuery(`detail-${e}`,()=>this.api.get(e),s));a(this,"useCreate",e=>this.useMutate(this.api.create,p(n({},e),{onSuccess:s=>{var i;this.queryClient.setQueryData([...this.baseKey,"list"],(h=[])=>[...h||[],s]),(i=e==null?void 0:e.onSuccess)==null||i.call(e,s)}})));a(this,"useUpdate",e=>this.useMutate(({id:s,data:i})=>this.api.update(s,i),p(n({},e),{onSuccess:s=>{var i;this.queryClient.setQueryData([...this.baseKey,"list"],(h=[])=>h.map(y=>y._id===s._id?s:y)),this.queryClient.setQueryData([...this.baseKey,`detail-${s._id}`],s),(i=e==null?void 0:e.onSuccess)==null||i.call(e,s)}})));a(this,"useDelete",e=>this.useMutate(this.api.delete,p(n({},e),{onSuccess:(s,i)=>{var h;this.queryClient.setQueryData([...this.baseKey,"list"],(y=[])=>y.filter(l=>l._id!==i)),this.queryClient.removeQueries({queryKey:[...this.baseKey,`detail-${i}`]}),(h=e==null?void 0:e.onSuccess)==null||h.call(e,i)}})));a(this,"prefetchList",e=>this.prefetch("list",()=>this.api.list(e)));a(this,"prefetchDetail",e=>this.prefetch(`detail-${e}`,()=>this.api.get(e)));a(this,"invalidateList",()=>this.invalidate("list"));a(this,"invalidateDetail",e=>this.invalidate(`detail-${e}`))}}const te={list:()=>d(null,null,function*(){return(yield O.get("/brand")).data}),get:r=>d(null,null,function*(){return(yield O.get(`/brand/${r}`)).data}),create:r=>d(null,null,function*(){return(yield O.post("/brand/addBrand",r)).data}),update:(r,t)=>d(null,null,function*(){return(yield O.put(`/brand/${r}`,t)).data}),delete:r=>d(null,null,function*(){yield O.delete(`/brand/${r}`)}),getSiteInfo:r=>d(null,null,function*(){return(yield O.get("/brand/site-info",{params:{url:r}})).data})};class se extends ee{constructor(){super(...arguments);a(this,"baseKey",["brand"]);a(this,"api",te);a(this,"useSiteInfo",(e,s)=>this.useFetchQuery(`siteInfo-${e}`,()=>this.api.getSiteInfo(e),s))}}const ne=new se;export{ne as b,Z as u};
