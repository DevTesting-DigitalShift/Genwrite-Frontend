var ue=Object.defineProperty,he=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var W=(i,r,a)=>r in i?ue(i,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[r]=a,C=(i,r)=>{for(var a in r||(r={}))pe.call(r,a)&&W(i,a,r[a]);if(V)for(var a of V(r))be.call(r,a)&&W(i,a,r[a]);return i},Y=(i,r)=>he(i,xe(r));var Z=(i,r,a)=>new Promise((A,h)=>{var k=o=>{try{v(a.next(o))}catch(I){h(I)}},u=o=>{try{v(a.throw(o))}catch(I){h(I)}},v=o=>o.done?A(o.value):Promise.resolve(o.value).then(k,u);v((a=a.apply(i,r)).next())});import{r as c,u as fe,c as ye,ac as je,a as ve,D as we,K as Ne,j as e,H as Se,m as p,B as X,T as Be,aN as Ce,aO as ke,b as Ie,ar as Te}from"./index-CJ5V2t86.js";import{b as Ae}from"./SkeletonLoader-rUB-LqAD.js";import{l as De}from"./lodash-CoQvHrZK.js";import{d as T}from"./dayjs.min-DppEsH2M.js";import{u as Ee}from"./useQuery-DH2aNwLI.js";import{u as ee}from"./useMutation-DYUdJeko.js";import{R as qe}from"./refresh-ccw-BKeL0r7w.js";import{T as Pe}from"./trash-2-DOVbk0ZS.js";import{S as te}from"./search-DTHDwt_T.js";import{S as se}from"./index-WrERqGyX.js";import{B as Re}from"./index-6wGC6rDM.js";import{c as Fe}from"./createLucideIcon-Cg_J5WWL.js";import{P as Qe}from"./Pagination-BngOUcO9.js";import{I as _e}from"./index-DUKTMT2w.js";import"./clsx-B-dksMZM.js";import"./useBaseQuery-BWZkbQ12.js";import"./index-B6k4LwOc.js";import"./move-Dw8vVWRH.js";import"./useIcons-C2R-rsp3.js";import"./SearchOutlined-BwAeuBI8.js";import"./LeftOutlined-DE_s9tcd.js";import"./RightOutlined-DteW6w5I.js";import"./useBreakpoint-B4ecqabs.js";import"./useForceUpdate-B9cdbTLI.js";import"./Input-C3T9g4MK.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]],Me=Fe("archive-restore",Ke),{Search:ut}=_e,{Option:P}=se,ht=()=>{var H,z,U,J;const[i,r]=c.useState(1),[a,A]=c.useState(15),[h,k]=c.useState(""),[u,v]=c.useState("all"),[o,I]=c.useState([null,null]),Q=fe(),D=ye(),g=je(),f=ve(we),y=(f==null?void 0:f.id)||"guest",ae=200,le=[10,15,20,50];c.useCallback(()=>{k(""),r(1)},[]);const{handlePopup:_}=Ne(),re=c.useCallback(De.debounce(t=>{k(t),r(1)},500,{leading:!1,trailing:!0,maxWait:1e3}),[]),{data:w,isLoading:N}=Ee({queryKey:["trashedBlogs",y,u,h,(z=(H=o[0])==null?void 0:H.toISOString())!=null?z:null,(J=(U=o[1])==null?void 0:U.toISOString())!=null?J:null,i,a],queryFn:()=>Z(null,null,function*(){const t={isArchived:!0,status:u!=="all"?u:void 0,q:h||void 0,start:o[0]?T(o[0]).toISOString():void 0,end:o[1]?T(o[1]).toISOString():void 0,page:i,limit:a},l=yield Te(t);return{trashedBlogs:l.data||[],totalBlogs:l.totalItems||0}})}),R=(w==null?void 0:w.trashedBlogs)||[],K=(w==null?void 0:w.totalBlogs)||0;c.useEffect(()=>{const t=Ie();if(!t||!f)return;const l=(s,d)=>{var E,q,b,S;console.debug(`Blog event: ${d}`,s);const n=["trashedBlogs",y,u,h,(q=(E=o[0])==null?void 0:E.toISOString())!=null?q:null,(S=(b=o[1])==null?void 0:b.toISOString())!=null?S:null,i,a];d==="blog:deleted"||d==="blog:restored"?(g.setQueryData(n,(m={trashedBlogs:[],totalBlogs:0})=>({trashedBlogs:m.trashedBlogs.filter(B=>B._id!==s.blogId),totalBlogs:m.totalBlogs-1})),g.removeQueries({queryKey:["blog",s.blogId]})):d==="blog:archived"?(g.invalidateQueries({queryKey:["trashedBlogs",y],exact:!1}),g.invalidateQueries({queryKey:["blogs",y],exact:!1})):(g.setQueryData(n,(m={trashedBlogs:[],totalBlogs:0})=>{var j;const B=m.trashedBlogs.findIndex(x=>x._id===s.blogId);if(B>-1){const x=T(s.archiveDate||s.updatedAt),F=u==="all"||s.status===u,de=!o[0]||!o[1]||x.isBetween(T(o[0]),T(o[1]),"day","[]"),me=!h||((j=s.title)==null?void 0:j.toLowerCase().includes(h.toLowerCase()));return F&&de&&me?(m.trashedBlogs[B]=C(C({},m.trashedBlogs[B]),s),Y(C({},m),{trashedBlogs:[...m.trashedBlogs]})):{trashedBlogs:m.trashedBlogs.filter(ge=>ge._id!==s.blogId),totalBlogs:m.totalBlogs-1}}return m}),g.setQueryData(["blog",s.blogId],m=>C(C({},m),s)))};return t.on("blog:statusChanged",s=>l(s,"blog:statusChanged")),t.on("blog:updated",s=>l(s,"blog:updated")),t.on("blog:archived",s=>l(s,"blog:archived")),t.on("blog:deleted",s=>l(s,"blog:deleted")),t.on("blog:restored",s=>l(s,"blog:restored")),()=>{t.off("blog:statusChanged"),t.off("blog:updated"),t.off("blog:archived"),t.off("blog:deleted"),t.off("blog:restored")}},[g,f,y,u,h,o,i,a]),c.useEffect(()=>{f||(g.removeQueries({queryKey:["trashedBlogs"]}),r(1),A(15),k(""),v("all"),I([null,null]))},[f,g]);const oe=ee({mutationFn:t=>Q(ke(t)).unwrap(),onSuccess:()=>{g.invalidateQueries({queryKey:["trashedBlogs"],exact:!1}),g.invalidateQueries({queryKey:["blogs"],exact:!1})},onError:t=>{console.error("Failed to restore blog:",t)}}),M=ee({mutationFn:()=>Q(Ce()).unwrap(),onSuccess:()=>{g.invalidateQueries({queryKey:["trashedBlogs"],exact:!1}),r(1)},onError:t=>{console.error("Failed to delete all blogs:",t)}});c.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[i]);const O=c.useCallback((t,l=ae)=>t?t.length>l?t.substring(0,l)+"...":t:"",[]),$=c.useCallback(t=>{var l,s,d;return(d=(s=(l=t==null?void 0:t.replace(/<[^>]*>/g,""))==null?void 0:l.replace(/[\\*#=_~`>\-]+/g,""))==null?void 0:s.replace(/\s{2,}/g," "))==null?void 0:d.trim()},[]),ie=t=>{oe.mutate(t)},ne=c.useCallback(()=>{M.mutate()},[M]),ce=c.useCallback(()=>{g.invalidateQueries({queryKey:["trashedBlogs",y]})},[g,y]),G=c.useCallback(t=>{D(`/toolbox/${t._id}`)},[D]),L=c.useCallback(t=>{D(`/blog-editor/${t._id}`)},[D]);return e.jsxs("div",{className:"p-2 md:p-4 lg:p-8 max-w-full",children:[e.jsx(Se,{children:e.jsx("title",{children:"Trashcan | GenWrite"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:justify-between items-center mt-5 p-2 md:mt-0 md:p-0",children:[e.jsxs("div",{children:[e.jsx(p.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},className:"text-3xl font-extrabold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Trashcan"}),e.jsx(p.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},className:"text-gray-600 text-sm max-w-xl mb-4",children:"Restore valuable work or permanently delete clutter. Trashed items are deleted after 7 days."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(X,{type:"default",icon:e.jsx(qe,{className:"w-4 sm:w-5 h-4 sm:h-5"}),onClick:ce,disabled:N,className:"text-xs sm:text-sm px-4 py-2",children:"Refresh"})}),R.length>0&&e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(X,{type:"default",icon:e.jsx(Pe,{className:"w-4 sm:w-5 h-4 sm:h-5"}),onClick:()=>_({title:"Delete All Trashed Blogs",description:e.jsxs("span",{className:"my-2",children:["All trashed blogs will be ",e.jsx("b",{children:"permanently deleted"}),". This action cannot be undone."]}),onConfirm:ne,confirmProps:{type:"text",className:"border-red-500 hover:bg-red-500 bg-red-100 text-red-600"},cancelProps:{danger:!1}}),disabled:N,className:"text-xs sm:text-sm px-4 py-2",children:"Delete All"})})]})]}),e.jsx(p.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},className:"bg-white/90 p-4 sm:p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{placeholder:"Search by title or keywords...",onChange:t=>re(t.target.value),prefix:e.jsx(te,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-400 mr-2 sm:mr-3"}),className:"w-full rounded-lg border border-gray-300 px-10 py-[5px] text-sm focus:outline-none focus:ring-2 focus:ring-blue-300",disabled:N}),e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"})]}),e.jsxs(se,{value:u,onChange:t=>{v(t),r(1)},className:"w-full sm:w-48 rounded-lg text-xs sm:text-sm",placeholder:"Filter by status",disabled:N,children:[e.jsx(P,{value:"all",children:"All Status"}),e.jsx(P,{value:"complete",children:"Complete"}),e.jsx(P,{value:"failed",children:"Failed"}),e.jsx(P,{value:"pending",children:"Pending"})]})]})}),N?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8",children:[...Array(a)].map((t,l)=>e.jsx("div",{className:"bg-white shadow-md rounded-lg p-4 sm:p-6",children:e.jsx(Ae,{})},l))}):R.length===0?e.jsxs(p.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},className:"flex flex-col justify-center items-center",style:{minHeight:"calc(100vh - 250px)"},children:[e.jsx("img",{src:"Images/trash-can.png",alt:"Trash",className:"w-20 sm:w-24"}),e.jsx("p",{className:"text-lg sm:text-xl mt-5 text-gray-600",children:"No trashed blogs available."})]}):e.jsxs(e.Fragment,{children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8 p-2",children:R.map(t=>{const l=t.isManuallyEdited===!0,{_id:s,title:d,status:n,createdAt:E,shortContent:q,aiModel:b,focusKeywords:S,archiveDate:m,agendaNextRun:B}=t,j=/gemini/gi.test(b);return e.jsx(Re.Ribbon,{text:e.jsx("span",{className:"flex items-center justify-center gap-1 py-1 font-medium tracking-wide text-xs sm:text-sm",children:l?e.jsx(e.Fragment,{children:"Manually Generated"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:`./Images/${j?"gemini":b==="claude"?"claude":"chatgpt"}.png`,alt:j?"Gemini":b==="claude"?"Claude":"ChatGPT",width:16,height:16,loading:"lazy",className:"bg-white"}),j?"Gemini 2.0 flash":b==="claude"?"Claude 4 sonnet":"Gpt 4.1 nano"]})}),className:"absolute top-0",color:l?"#9CA3AF":j?"#4796E3":b==="claude"?"#9368F8":"#74AA9C",children:e.jsxs("div",{className:`bg-white shadow-md hover:shadow-xl transition-all duration-300 rounded-lg p-4 sm:p-6 min-h-[180px] min-w-0 relative ${l?"border-gray-500":n==="failed"?"border-red-500":n==="pending"||n==="in-progress"?"border-yellow-500":"border-green-500"} border-2`,title:d,children:[e.jsx("div",{className:"text-xs font-semibold text-gray-400 mb-2 -mt-2",children:new Date(E).toLocaleDateString("en-US",{dateStyle:"medium"})}),l?e.jsx("div",{className:"cursor-pointer",onClick:()=>L(t),role:"button",tabIndex:0,onKeyDown:x=>x.key==="Enter"&&L(t),"aria-label":`View blog ${d}`,children:e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-base sm:text-lg capitalize font-semibold text-gray-900 !text-left max-w-full",children:d}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-4 line-clamp-3 break-all",children:O($(content))||""})]})}):e.jsx(Be,{title:n==="complete"?d:n==="failed"?"Blog generation failed":n==="pending"?`Pending Blog will be generated ${agendaJob!=null&&agendaJob.nextRunAt?"at "+new Date(agendaJob.nextRunAt).toLocaleString("en-IN",{dateStyle:"medium",timeStyle:"short"}):"shortly"}`:`Blog generation is ${n}`,color:n==="complete"?"green":n==="failed"?"red":"#eab308",children:e.jsx("div",{className:"cursor-pointer",onClick:()=>{(n==="complete"||n==="failed")&&G(t)},role:"button",tabIndex:0,onKeyDown:x=>x.key==="Enter"&&(n==="complete"||n==="failed")&&G(t),"aria-label":`View blog ${d}`,children:e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-base sm:text-lg capitalize font-semibold text-gray-900 !text-left max-w-full",children:d}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-4 line-clamp-3 break-all",children:O($(q))||""})]})})}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1 sm:gap-2",children:S==null?void 0:S.map((x,F)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-semibold px-2 sm:px-2.5 py-0.5 rounded-full",children:x},F))}),e.jsx(p.div,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>_({title:"Restore Blog",description:e.jsxs("span",{className:"my-2",children:["Are you sure to restore ",e.jsx("b",{children:d})," blog?"]}),confirmText:"Yes",onConfirm:()=>{ie(s)},confirmProps:{type:"text",className:"border-green-500 bg-green-50 text-green-600"},cancelProps:{danger:!1}}),children:e.jsx(Me,{className:"w-5 h-5 cursor-pointer"})})]}),e.jsx("div",{className:"mt-3 mb-2 flex justify-end text-xs sm:text-sm text-right text-gray-500 font-medium",children:e.jsxs("span",{className:"block -mb-2",children:["Archive Date:"," ",new Date(m).toLocaleDateString("en-US",{dateStyle:"medium"})]})})]})},s)})}),K>a&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.3},className:"flex justify-center mt-6",children:e.jsx(Qe,{current:i,pageSize:a,total:K,pageSizeOptions:le.filter(t=>t<=100),onChange:(t,l)=>{r(t),l!==a&&(A(l),r(1))},showSizeChanger:!0,showTotal:t=>`Total ${t} blogs`,responsive:!0,disabled:N})})]})]})]})};export{ht as default};
