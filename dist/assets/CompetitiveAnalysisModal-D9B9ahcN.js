import{b as i}from"./chunk-tiptap-DcNQbKmZ.js";import{I as V,ag as D,ah as ee,V as te,u as se,a as F,Y as ae,j as e,L as ne,P as re,m as d,aa as ie}from"./index-BiN8l-P3.js";import{C as g,g as le}from"./getEstimatedCost-ycRXQGiB.js";import{C as w,T as Y}from"./index-BcsZyqCP.js";import{S as C,E as H}from"./index-C0emBpwG.js";import{X as oe}from"./x-EXuY2rFn.js";import{P as de}from"./progress-CVIraczL.js";function L(){return L=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(o[a]=c[a])}return o},L.apply(this,arguments)}const ce=(o,r)=>i.createElement(V,L({},o,{ref:r,icon:D})),ve=i.forwardRef(ce);function M(){return M=Object.assign?Object.assign.bind():function(o){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(o[a]=c[a])}return o},M.apply(this,arguments)}const xe=(o,r)=>i.createElement(V,M({},o,{ref:r,icon:ee})),me=i.forwardRef(xe),{Panel:u}=g,{TabPane:K}=Y,Ne=({closeFnc:o,open:r,blogs:c})=>{var O,A,I,B,E,T,R,$;const[a,y]=i.useState({title:"",content:"",keywords:[],keywordInput:"",contentType:"markdown",selectedProject:null,generatedMetadata:null}),[x,j]=i.useState(null),[v,S]=i.useState(null),[b,p]=i.useState(!1),{handlePopup:U}=te(),N=se(),{analysis:k,loading:m}=F(s=>s.analysis),{blog:he,loading:f}=F(s=>s.blog);i.useEffect(()=>{!m&&k&&j(k)},[k,m]),i.useEffect(()=>{r||(y({title:"",content:"",keywords:[],keywordInput:"",contentType:"markdown",selectedProject:null,generatedMetadata:null}),j(null),S(null),p(!1))},[r]),i.useEffect(()=>(r?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[r]),i.useEffect(()=>{v&&(p(!0),N(ae(v)).unwrap().then(s=>{s!=null&&s._id&&y(t=>({...t,title:s.title,content:s.content||"",keywords:s.focusKeywords||[],selectedProject:s,contentType:"markdown",generatedMetadata:s.generatedMetadata||null}))}).catch(s=>{console.error("Failed to fetch blog by ID:",s)}).finally(()=>p(!1)))},[v,N]);const X=s=>{const t=c.find(n=>n._id===s);t&&(S(t._id),y(n=>({...n,title:t.title,content:t.content||"",keywords:t.focusKeywords||[],selectedProject:t,contentType:"markdown",generatedMetadata:null})),j(null))},q=s=>{y(t=>({...t,keywords:t.keywords.filter((n,l)=>l!==s)}))},G=()=>{a.title.trim()&&a.content.trim()&&a.keywords.length!==0&&U({title:"Analyze Competitors",description:e.jsxs("p",{children:["Competitive Analysis cost: ",e.jsxs("b",{children:[le("analysis.competitors")," credits"]}),e.jsx("br",{}),"Do you wish to proceed?"]}),onConfirm:async()=>{var s;p(!0);try{const t=await N(ie({title:a.title,content:a.content,keywords:a.keywords,contentType:a.contentType,blogId:(s=a==null?void 0:a.selectedProject)==null?void 0:s._id})).unwrap();j(t)}catch(t){console.error("Error fetching analysis:",t)}finally{p(!1)}}})},P=s=>s?s.split(`
`).filter(t=>t.trim()!=="").map((t,n)=>e.jsx("p",{className:"mb-2",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:t.trim().replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}})},n)):[],_=i.useMemo(()=>{var s;return(s=a==null?void 0:a.generatedMetadata)!=null&&s.competitors?e.jsx(g,{accordion:!0,className:"bg-white border border-gray-200 rounded-lg",children:a.generatedMetadata.competitors.map((t,n)=>e.jsxs(u,{header:e.jsxs("div",{className:"flex justify-between items-center w-full pr-2",children:[e.jsx("span",{className:"font-medium text-gray-800 truncate max-w-[60%]",children:t.title}),e.jsx("a",{href:(t==null?void 0:t.link)??(t==null?void 0:t.url),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-sm hover:underline",onClick:l=>l.stopPropagation(),children:"Visit"})]}),className:"text-sm text-gray-700 leading-relaxed",children:[t!=null&&t.content?e.jsx("div",{children:P(t.content)}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2 font-medium",children:t.snippet}),e.jsx("div",{children:P(t.summary)})]}),t.score&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-600",children:["Score: ",(t.score*100).toFixed(2),"%"]})})]},n))}):null},[(O=a==null?void 0:a.generatedMetadata)==null?void 0:O.competitors]),J=i.useMemo(()=>{var s;return(s=a==null?void 0:a.generatedMetadata)!=null&&s.outboundLinks?e.jsx(w,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded text-blue-500",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),e.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]})}),e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"Outbound Links"})]}),className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:e.jsx(g,{accordion:!0,children:a.generatedMetadata.outboundLinks.map((t,n)=>e.jsx(u,{header:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:"text-sm font-medium text-gray-800",children:t.title}),e.jsx("span",{onClick:l=>{l.stopPropagation(),window.open(t.link,"_blank")},className:"text-xs text-blue-600 hover:underline cursor-pointer",children:"Visit"})]}),className:"text-sm text-gray-700 leading-relaxed",children:e.jsx("p",{className:" text-gray-600",children:t.snippet||t.content})},n))})}):null},[(A=a==null?void 0:a.generatedMetadata)==null?void 0:A.outboundLinks]),Q=i.useMemo(()=>{var n;if(!((n=a==null?void 0:a.generatedMetadata)!=null&&n.competitorsAnalysis))return null;const{analysis:s,suggestions:t}=a.generatedMetadata.competitorsAnalysis;return e.jsx(w,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-100 rounded text-purple-500",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),e.jsx("path",{d:"M12 17h.01"})]})}),e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"Competitors Analysis"})]}),className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:e.jsxs(g,{accordion:!0,expandIconPosition:"right",children:[e.jsx(u,{header:e.jsx("span",{className:"font-semibold text-gray-800",children:"Analysis"}),children:e.jsx(g,{accordion:!0,children:Object.entries(s).map(([l,h],ue)=>{const W=h.match(/\((\d+\/\d+)\)$/),z=W?W[1]:null,Z=h.replace(/\s*\(\d+\/\d+\)$/,"").trim();return e.jsx(u,{header:e.jsxs("div",{className:"flex justify-between items-center w-full pr-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:l}),z&&e.jsx("span",{className:"text-sm font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-md",children:z.replace("/"," / ")})]}),className:"text-sm text-gray-700 leading-relaxed",children:e.jsx("p",{children:Z})},l)})})},"analysis"),e.jsx(u,{header:e.jsx("span",{className:"font-semibold text-gray-800",children:"Suggestions"}),children:e.jsx("ul",{className:"list-decimal pl-6 space-y-3 text-sm text-gray-700",children:t.split(/(?:\d+\.\s)/).filter(Boolean).map((l,h)=>e.jsx("li",{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:l.trim().replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}})},h))})},"suggestions")]})})},[(I=a==null?void 0:a.generatedMetadata)==null?void 0:I.competitorsAnalysis]);return b||f||m?e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:e.jsx(ne,{})}):e.jsx(re,{open:r,title:e.jsxs(d.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg text-white",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Competitive Analysis Dashboard"})]}),onCancel:o,footer:[e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition",children:"Close"}),e.jsx("button",{onClick:G,className:`px-4 py-2 text-sm font-medium text-white bg-[#1B6FC9] rounded-md hover:bg-[#1B6FC9]/90 transition ${b||f||m?"opacity-50 cursor-not-allowed":""}`,disabled:b||f||m,children:b||f||m?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(me,{}),x?"Re-Analyzing...":"Analyzing..."]}):x?"Re-Run Analysis":"Run Competitive Analysis"})]},"footer")],width:900,centered:!0,closable:!0,transitionName:"",maskTransitionName:"",bodyStyle:{maxHeight:"80vh",overflowY:"auto",padding:0},children:e.jsxs("div",{className:"space-y-6",children:[!x&&e.jsxs(e.Fragment,{children:[e.jsxs(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Recent Project"}),e.jsxs(C,{showSearch:!0,filterOption:(s,t)=>{var n;return(n=t==null?void 0:t.children)==null?void 0:n.toLowerCase().includes(s.toLowerCase())},className:"w-full rounded-md text-sm",onChange:X,value:((B=a.selectedProject)==null?void 0:B._id)||"",dropdownStyle:{maxHeight:200,overflowY:"auto"},children:[e.jsx(C.Option,{value:"",children:"Select a blog"}),c.map(s=>e.jsx(C.Option,{value:s._id,children:s.title.charAt(0).toUpperCase()+s.title.slice(1)},s._id))]})]}),!a.selectedProject&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 bg-gray-50 rounded-xl border border-gray-200 shadow-sm",children:e.jsx("p",{className:"text-gray-600 text-lg",children:"Select a blog to view content and competitors"})}),a.selectedProject&&e.jsxs("div",{className:"space-y-6",children:[a.content?e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:[e.jsx("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Content Preview"})}),e.jsx("div",{children:e.jsx("div",{className:"text-gray-700 max-h-40 overflow-y-auto whitespace-pre-wrap leading-relaxed p-4 rounded-md",children:a.content.split(`
`).map((s,t)=>s.startsWith("### ")?e.jsx("h3",{className:"text-lg font-semibold mt-2",children:s.replace("### ","").replace(/[*_~>`]/g,"").trim()},t):s.startsWith("## ")?e.jsx("h2",{className:"text-xl font-semibold mt-2",children:s.replace("## ","").replace(/[*_~>`]/g,"").trim()},t):s.startsWith("# ")?e.jsx("h1",{className:"text-2xl font-bold mt-2",children:s.replace("# ","").replace(/[*_~>`]/g,"").trim()},t):e.jsx("p",{className:"text-base mt-2",children:s.replace(/[*_~>`]/g,"").trim()},t))})})]}):e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-10 bg-gray-50 rounded-xl border border-gray-200 shadow-sm",children:e.jsx("p",{className:"text-gray-600 text-lg",children:"No content available for this blog"})}),a.keywords.length>0&&e.jsxs(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"p-4 bg-gray-50 border border-gray-200 rounded-xl shadow-sm",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-2",children:"Keywords"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.keywords.map((s,t)=>e.jsxs(d.span,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:t*.1},className:"px-3 py-1 bg-blue-50 rounded-full text-sm text-blue-700 border border-blue-100 hover:bg-blue-100 transition-colors",children:[s,e.jsx("button",{type:"button",onClick:()=>q(t),className:"ml-2 text-blue-500 hover:text-blue-700",children:e.jsx(oe,{className:"w-4 h-4"})})]},s))})]})]})]}),a.generatedMetadata&&e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(Y,{defaultActiveKey:x?"results":"metadata",children:[e.jsxs("div",{className:"space-y-6",children:[a.generatedMetadata.competitors&&e.jsx(w,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-indigo-100 rounded text-indigo-500",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]})}),e.jsx("span",{className:"text-lg font-semibold text-gray-800",children:"Competitors"})]}),className:"bg-white border border-gray-200 rounded-xl shadow-sm",children:_||e.jsx(H,{description:"No competitor data available"})}),J,Q]}),x&&e.jsxs(e.Fragment,{children:[e.jsx(K,{tab:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 3v18h18"}),e.jsx("path",{d:"m19 9-5 5-4-4-3 3"})]}),"Analysis Results"]}),children:e.jsxs(d.div,{animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"space-y-6",children:[e.jsxs(d.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.2,duration:.5},className:"flex flex-col items-center",children:[e.jsx(de,{type:"dashboard",percent:parseInt(((E=x.insights)==null?void 0:E.blogScore)||0),format:s=>`${s} / 100`,strokeColor:{"0%":"#1B6FC9","100%":"#4C9FE8"},trailColor:"#e5e7eb",size:"large"}),e.jsx("div",{className:"text-gray-800 text-lg font-semibold mt-3",children:"Blog SEO Score"})]}),e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},children:e.jsx(w,{title:"Suggestions to Beat Competitors",className:"bg-white border border-gray-200 rounded-lg shadow-sm",headStyle:{background:"#f9fafb",fontWeight:600,fontSize:"1.1rem"},children:e.jsx("ul",{className:"list-decimal pl-6 space-y-3 text-sm text-gray-700",children:(R=(T=x==null?void 0:x.insights)==null?void 0:T.suggestions)==null?void 0:R.split(/(?:\d+\.\s)/).filter(Boolean).map((s,t)=>e.jsx("li",{children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.trim().replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}})},t))})})}),e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.4},children:e.jsx(g,{accordion:!0,className:"bg-white border border-gray-200 rounded-lg",expandIconPosition:"right",children:Object.entries((($=x.insights)==null?void 0:$.analysis)||{}).map(([s,t])=>{const n=t.match(/^(\d+\/\d+)\s+—\s+(.*)$/),l=n?n[1]:null,h=n?n[2]:t;return e.jsx(u,{header:e.jsxs("div",{className:"flex justify-between items-center w-full pr-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:s}),l&&e.jsx("span",{className:"text-sm text-center w-[10ch] font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-md",children:l.replace("/"," / ")})]}),className:"text-sm text-gray-700 leading-relaxed",children:e.jsx("p",{children:h})},s)})})})]})},"results"),e.jsx(K,{tab:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]}),"Competitors"]}),children:_||e.jsx(H,{description:"No competitor data available"})},"competitors")]})]})})]})})};export{Ne as C,me as R,ve as a};
