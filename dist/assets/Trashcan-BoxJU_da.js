var ue=Object.defineProperty,he=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var Z=(i,r,a)=>r in i?ue(i,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[r]=a,k=(i,r)=>{for(var a in r||(r={}))pe.call(r,a)&&Z(i,a,r[a]);if(Y)for(var a of Y(r))be.call(r,a)&&Z(i,a,r[a]);return i},X=(i,r)=>he(i,xe(r));var J=(i,r,a)=>new Promise((E,h)=>{var I=o=>{try{N(a.next(o))}catch(T){h(T)}},u=o=>{try{N(a.throw(o))}catch(T){h(T)}},N=o=>o.done?E(o.value):Promise.resolve(o.value).then(I,u);N((a=a.apply(i,r)).next())});import{r as d,u as fe,c as ye,a0 as je,a as ve,z as we,$ as Ne,j as e,H as Se,m as x,B as ee,T as Be,b7 as Ce,b8 as ke,b9 as Ie,b as Te}from"./index-BfeyGnjQ.js";import{b as De}from"./SkeletonLoader-CxOfGrrw.js";import{l as Ae}from"./lodash-DxML-7KK.js";import{d as A}from"./dayjs.min-CphpKeRY.js";import{u as Ee}from"./useQuery-0UMyHWNC.js";import{u as te}from"./useMutation-DvABUfvQ.js";import{R as Pe}from"./refresh-ccw-eBVwjkXV.js";import{T as qe,B as Fe}from"./index-CD8Z_mQr.js";import{S as se}from"./search-1_uhvDx2.js";import{S as ae}from"./index-Doobf1FC.js";import{c as Re}from"./createLucideIcon-Du2VtDl2.js";import{P as Oe}from"./Pagination-BrZ9KWc9.js";import{I as Me}from"./index-BWkdPHIK.js";import"./clsx-B-dksMZM.js";import"./Overflow-BI5d6IgA.js";import"./index-LbqWIOYv.js";import"./SearchOutlined-DSAR1FJr.js";import"./LeftOutlined-1YE7jqPf.js";import"./useBreakpoint-DgU8dFnG.js";import"./Input-BiR41ZWi.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]],_e=Re("archive-restore",Qe),{Search:nt}=Me,{Option:F}=ae,ct=()=>{var H,U,W,V;const[i,r]=d.useState(1),[a,E]=d.useState(15),[h,I]=d.useState(""),[u,N]=d.useState("all"),[o,T]=d.useState([null,null]),M=fe(),P=ye(),g=je(),p=ve(we),y=(p==null?void 0:p.id)||"guest",le=85,re=[10,15,20,50];d.useCallback(()=>{I(""),r(1)},[]);const{handlePopup:Q}=Ne(),oe=d.useCallback(Ae.debounce(t=>{I(t),r(1)},500,{leading:!1,trailing:!0,maxWait:1e3}),[]),{data:S,isLoading:B}=Ee({queryKey:["trashedBlogs",y,u,h,(U=(H=o[0])==null?void 0:H.toISOString())!=null?U:null,(V=(W=o[1])==null?void 0:W.toISOString())!=null?V:null,i,a],queryFn:()=>J(null,null,function*(){const t={isArchived:!0,status:u!=="all"?u:void 0,q:h||void 0,start:o[0]?A(o[0]).toISOString():void 0,end:o[1]?A(o[1]).toISOString():void 0,page:i,limit:a},l=yield Ie(t);return{trashedBlogs:l.data||[],totalBlogs:l.totalItems||0}}),keepPreviousData:!0,staleTime:1/0,gcTime:1/0,refetchOnMount:"always",refetchOnWindowFocus:!1,enabled:!!p,onError:t=>{console.error("Failed to fetch trashed blogs:",t)}}),R=(S==null?void 0:S.trashedBlogs)||[],_=(S==null?void 0:S.totalBlogs)||0;d.useEffect(()=>{const t=Te();if(!t||!p)return;const l=(s,m)=>{var q,D,b,C;console.debug(`Blog event: ${m}`,s);const c=["trashedBlogs",y,u,h,(D=(q=o[0])==null?void 0:q.toISOString())!=null?D:null,(C=(b=o[1])==null?void 0:b.toISOString())!=null?C:null,i,a];m==="blog:deleted"||m==="blog:restored"?(g.setQueryData(c,(n={trashedBlogs:[],totalBlogs:0})=>({trashedBlogs:n.trashedBlogs.filter(j=>j._id!==s.blogId),totalBlogs:n.totalBlogs-1})),g.removeQueries({queryKey:["blog",s.blogId]})):m==="blog:archived"?(g.invalidateQueries({queryKey:["trashedBlogs",y],exact:!1}),g.invalidateQueries({queryKey:["blogs",y],exact:!1})):(g.setQueryData(c,(n={trashedBlogs:[],totalBlogs:0})=>{var v;const j=n.trashedBlogs.findIndex(f=>f._id===s.blogId);if(j>-1){const f=A(s.archiveDate||s.updatedAt),w=u==="all"||s.status===u,O=!o[0]||!o[1]||f.isBetween(A(o[0]),A(o[1]),"day","[]"),me=!h||((v=s.title)==null?void 0:v.toLowerCase().includes(h.toLowerCase()));return w&&O&&me?(n.trashedBlogs[j]=k(k({},n.trashedBlogs[j]),s),X(k({},n),{trashedBlogs:[...n.trashedBlogs]})):{trashedBlogs:n.trashedBlogs.filter(ge=>ge._id!==s.blogId),totalBlogs:n.totalBlogs-1}}return n}),g.setQueryData(["blog",s.blogId],n=>k(k({},n),s)))};return t.on("blog:statusChanged",s=>l(s,"blog:statusChanged")),t.on("blog:updated",s=>l(s,"blog:updated")),t.on("blog:archived",s=>l(s,"blog:archived")),t.on("blog:deleted",s=>l(s,"blog:deleted")),t.on("blog:restored",s=>l(s,"blog:restored")),()=>{t.off("blog:statusChanged"),t.off("blog:updated"),t.off("blog:archived"),t.off("blog:deleted"),t.off("blog:restored")}},[g,p,y,u,h,o,i,a]),d.useEffect(()=>{p||(g.removeQueries({queryKey:["trashedBlogs"]}),r(1),E(15),I(""),N("all"),T([null,null]))},[p,g]);const ie=te({mutationFn:t=>M(ke(t)).unwrap(),onSuccess:()=>{g.invalidateQueries({queryKey:["trashedBlogs"],exact:!1}),g.invalidateQueries({queryKey:["blogs"],exact:!1})},onError:t=>{console.error("Failed to restore blog:",t)}}),K=te({mutationFn:()=>M(Ce()).unwrap(),onSuccess:()=>{g.invalidateQueries({queryKey:["trashedBlogs"],exact:!1}),r(1)},onError:t=>{console.error("Failed to delete all blogs:",t)}});d.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[i]);const $=d.useCallback((t,l=le)=>t?t.length>l?t.substring(0,l)+"...":t:"",[]),L=d.useCallback(t=>{var l,s,m;return(m=(s=(l=t==null?void 0:t.replace(/<[^>]*>/g,""))==null?void 0:l.replace(/[\\*#=_~`>\-]+/g,""))==null?void 0:s.replace(/\s{2,}/g," "))==null?void 0:m.trim()},[]),ne=t=>{ie.mutate(t)},ce=d.useCallback(()=>{K.mutate()},[K]),de=d.useCallback(()=>{g.invalidateQueries({queryKey:["trashedBlogs",y]})},[g,y]),G=d.useCallback(t=>{P(`/toolbox/${t._id}`)},[P]),z=d.useCallback(t=>{P(`/blog-editor/${t._id}`)},[P]);return e.jsxs("div",{className:"p-2 md:p-4 lg:p-8 max-w-full",children:[e.jsx(Se,{children:e.jsx("title",{children:"Trashcan | GenWrite"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:justify-between items-center mt-5 p-2 md:mt-0 md:p-0",children:[e.jsxs("div",{children:[e.jsx(x.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},className:"text-3xl font-extrabold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Trashcan"}),e.jsx(x.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},className:"text-gray-600 text-sm max-w-xl mb-4",children:"Restore valuable work or permanently delete clutter. Trashed items are deleted after 7 days."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(ee,{type:"default",icon:e.jsx(Pe,{className:"w-4 sm:w-5 h-4 sm:h-5"}),onClick:de,disabled:B,className:"text-xs sm:text-sm px-4 py-2",children:"Refresh"})}),R.length>0&&e.jsx(x.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(ee,{type:"default",icon:e.jsx(qe,{className:"w-4 sm:w-5 h-4 sm:h-5"}),onClick:()=>Q({title:"Delete All Trashed Blogs",description:e.jsxs("span",{className:"my-2",children:["All trashed blogs will be ",e.jsx("b",{children:"permanently deleted"}),". This action cannot be undone."]}),onConfirm:ce,confirmProps:{type:"text",className:"border-red-500 hover:bg-red-500 bg-red-100 text-red-600"},cancelProps:{danger:!1}}),disabled:B,className:"text-xs sm:text-sm px-4 py-2",children:"Delete All"})})]})]}),e.jsx(x.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},className:"bg-white/90 p-4 sm:p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("input",{placeholder:"Search by title or keywords...",onChange:t=>oe(t.target.value),prefix:e.jsx(se,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-400 mr-2 sm:mr-3"}),className:"w-full rounded-lg border border-gray-300 px-10 py-[5px] text-sm focus:outline-none focus:ring-2 focus:ring-blue-300",disabled:B}),e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"})]}),e.jsxs(ae,{value:u,onChange:t=>{N(t),r(1)},className:"w-full sm:w-48 rounded-lg text-xs sm:text-sm",placeholder:"Filter by status",disabled:B,children:[e.jsx(F,{value:"all",children:"All Status"}),e.jsx(F,{value:"complete",children:"Complete"}),e.jsx(F,{value:"failed",children:"Failed"}),e.jsx(F,{value:"pending",children:"Pending"})]})]})}),B?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8",children:[...Array(a)].map((t,l)=>e.jsx("div",{className:"bg-white shadow-md rounded-lg p-4 sm:p-6",children:e.jsx(De,{})},l))}):R.length===0?e.jsxs(x.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},className:"flex flex-col justify-center items-center",style:{minHeight:"calc(100vh - 250px)"},children:[e.jsx("img",{src:"Images/trash-can.png",alt:"Trash",className:"w-20 sm:w-24"}),e.jsx("p",{className:"text-lg sm:text-xl mt-5 text-gray-600",children:"No trashed blogs available."})]}):e.jsxs(e.Fragment,{children:[e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8 p-2",children:R.map(t=>{const l=t.isManuallyEdited===!0,{_id:s,title:m,status:c,createdAt:q,content:D,aiModel:b,focusKeywords:C,wordpress:n,archiveDate:j,agendaJob:v}=t,f=/gemini/gi.test(b);return e.jsx(Fe.Ribbon,{text:e.jsx("span",{className:"flex items-center justify-center gap-1 py-1 font-medium tracking-wide text-xs sm:text-sm",children:l?e.jsx(e.Fragment,{children:"Manually Generated"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:`./Images/${f?"gemini":b==="claude"?"claude":"chatgpt"}.png`,alt:f?"Gemini":b==="claude"?"Claude":"ChatGPT",width:16,height:16,loading:"lazy",className:"bg-white"}),f?"Gemini 2.0 flash":b==="claude"?"Claude 4 sonnet":"Gpt 4.1 nano"]})}),className:"absolute top-0",color:l?"#9CA3AF":f?"#4796E3":b==="claude"?"#9368F8":"#74AA9C",children:e.jsxs("div",{className:`bg-white shadow-md hover:shadow-xl transition-all duration-300 rounded-lg p-4 sm:p-6 min-h-[180px] min-w-0 relative ${l?"border-gray-500":c==="failed"?"border-red-500":c==="pending"||c==="in-progress"?"border-yellow-500":"border-green-500"} border-2`,title:m,children:[e.jsx("div",{className:"text-xs font-semibold text-gray-400 mb-2 -mt-2",children:new Date(q).toLocaleDateString("en-US",{dateStyle:"medium"})}),l?e.jsx("div",{className:"cursor-pointer",onClick:()=>z(t),role:"button",tabIndex:0,onKeyDown:w=>w.key==="Enter"&&z(t),"aria-label":`View blog ${m}`,children:e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-base sm:text-lg capitalize font-semibold text-gray-900 !text-left max-w-full",children:m}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-4 line-clamp-3 break-all",children:$(L(D))||""})]})}):e.jsx(Be,{title:c==="complete"?m:c==="failed"?"Blog generation failed":c==="pending"?`Pending Blog will be generated ${v!=null&&v.nextRunAt?"at "+new Date(v.nextRunAt).toLocaleString("en-IN",{dateStyle:"medium",timeStyle:"short"}):"shortly"}`:`Blog generation is ${c}`,color:c==="complete"?"green":c==="failed"?"red":"#eab308",children:e.jsx("div",{className:"cursor-pointer",onClick:()=>{(c==="complete"||c==="failed")&&G(t)},role:"button",tabIndex:0,onKeyDown:w=>w.key==="Enter"&&(c==="complete"||c==="failed")&&G(t),"aria-label":`View blog ${m}`,children:e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-base sm:text-lg capitalize font-semibold text-gray-900 !text-left max-w-full",children:m}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mb-4 line-clamp-3 break-all",children:$(L(D))||""})]})})}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1 sm:gap-2",children:C==null?void 0:C.map((w,O)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-semibold px-2 sm:px-2.5 py-0.5 rounded-full",children:w},O))}),e.jsx(x.div,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Q({title:"Restore Blog",description:e.jsxs("span",{className:"my-2",children:["Are you sure to restore ",e.jsx("b",{children:m})," blog?"]}),confirmText:"Yes",onConfirm:()=>{ne(s)},confirmProps:{type:"text",className:"border-green-500 bg-green-50 text-green-600"},cancelProps:{danger:!1}}),children:e.jsx(_e,{className:"w-5 h-5 cursor-pointer"})})]}),e.jsxs("div",{className:"mt-3 mb-2 flex justify-end text-xs sm:text-sm text-right text-gray-500 font-medium",children:[(n==null?void 0:n.postedOn)&&e.jsxs("span",{children:["Posted on:",new Date(n.postedOn).toLocaleDateString("en-US",{dateStyle:"medium"})]}),e.jsxs("span",{className:"block -mb-2",children:["Archive Date:"," ",new Date(j).toLocaleDateString("en-US",{dateStyle:"medium"})]})]})]})},s)})}),_>a&&e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.3},className:"flex justify-center mt-6",children:e.jsx(Oe,{current:i,pageSize:a,total:_,pageSizeOptions:re.filter(t=>t<=100),onChange:(t,l)=>{r(t),l!==a&&(E(l),r(1))},showSizeChanger:!0,showTotal:t=>`Total ${t} blogs`,responsive:!0,disabled:B})})]})]})]})};export{ct as default};
