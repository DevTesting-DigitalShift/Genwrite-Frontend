var E=(g,N,u)=>new Promise((f,b)=>{var v=i=>{try{y(u.next(i))}catch(c){b(c)}},r=i=>{try{y(u.throw(i))}catch(c){b(c)}},y=i=>i.done?f(i.value):Promise.resolve(i.value).then(v,r);y((u=u.apply(g,N)).next())});import{j as o}from"./tiptap-Cw5itmsP.js";import{r as w}from"./vendor-D8zynvq1.js";import{u as $,a as q,N as z,m as p,ba as K,O as Q}from"./index-6Wzook5W.js";import{M as C,I as V,B,j as X,F as Y,a as Z}from"./antd-CNZYc_MN.js";import{R as A}from"./CloseOutlined-CnVwgvOV.js";import"./utils-Djmlt6HM.js";const re=({closeFnc:g,openSecondStepModal:N,openJobModal:u,visible:f})=>{var H;const[b,v]=w.useState(""),[r,y]=w.useState([]),[i,c]=w.useState(1),[S,k]=w.useState(!1),d=$(),{keywordAnalysis:l,loading:j,selectedKeywords:a}=q(e=>e.analysis);w.useEffect(()=>{r.length===0&&(c(1),d(z()))},[r,d]);const M=()=>{const e=b.trim();if(!e)return;const t=r.map(s=>s.toLowerCase()),x=new Set,n=e.split(",").map(s=>s.trim()).filter(s=>s&&!t.includes(s.toLowerCase())&&!x.has(s.toLowerCase())&&x.add(s.toLowerCase()));n.length>0&&(y([...r,...n]),v(""))},D=e=>{var n;const t=r[e],x=r.filter((s,h)=>h!==e);if(y(x),x.length===0&&(d(z()),c(1)),(n=a==null?void 0:a.allKeywords)!=null&&n.includes(t)){const s=a.allKeywords.filter(h=>h!==t);d(K({focusKeywords:s.slice(0,3),keywords:s,allKeywords:s}))}},L=e=>{e.key==="Enter"&&(e.preventDefault(),M())},O=()=>{r.length>0&&(d(Q(r)),c(1))},P=()=>{const e={LOW:[],MEDIUM:[],HIGH:[]};l==null||l.forEach(s=>{e[s.competition]&&e[s.competition].push({keyword:s.keyword,competition_index:s.competition_index})});const t=e.LOW.sort((s,h)=>s.competition_index-h.competition_index).slice(0,2),x=e.MEDIUM.sort((s,h)=>s.competition_index-h.competition_index).slice(0,2),n=e.HIGH.sort((s,h)=>s.competition_index-h.competition_index).slice(0,2);return[...t.map(s=>s.keyword),...x.map(s=>s.keyword),...n.map(s=>s.keyword)]},W=()=>{const e=P();if(!e.length||!(l!=null&&l.length)){C.error({title:"No Auto-Selected Keywords",content:"No keywords available to auto-select. Please analyze keywords first."});return}C.info({icon:null,title:o.jsx("div",{className:"flex justify-between items-center",children:o.jsx("span",{children:"Auto-Selected Keywords"})}),content:o.jsxs("div",{children:[o.jsx("p",{children:"We selected these keywords automatically based on competition index:"}),o.jsx("ul",{className:"list-disc ml-5 mt-2",children:e.map(t=>o.jsx("li",{className:"capitalize text-sm sm:text-base",children:t},t))}),o.jsx("p",{className:"mt-3 text-sm sm:text-base",children:"Do you want to add these too?"})]}),okText:"Accept",cancelText:"Decline",closable:!0,onOk(){const t=[...(a==null?void 0:a.allKeywords)||[],...e.filter(x=>{var n;return!((n=a==null?void 0:a.allKeywords)!=null&&n.includes(x))})].slice(0,6);d(K({focusKeywords:t.slice(0,3),keywords:t,allKeywords:t}))},onCancel(){const t=(a==null?void 0:a.allKeywords)||[];d(K({focusKeywords:t.slice(0,3),keywords:t,allKeywords:t}))},okButtonProps:{className:"bg-blue-600 text-white"}})},_=e=>E(null,null,function*(){const t=(a==null?void 0:a.allKeywords)||[];yield d(K({focusKeywords:t.slice(0,3),keywords:t.slice(3),allKeywords:t})),g(),setTimeout(()=>{e==="blog"?N():u()},100)}),G=()=>{_("blog")},U=()=>{_("job")},F=[{title:"Keyword",dataIndex:"keyword",key:"keyword",sorter:(e,t)=>e.keyword.localeCompare(t.keyword),render:e=>o.jsx("span",{className:"font-medium capitalize text-sm sm:text-base",children:e})},{title:"Monthly Searches",dataIndex:"avgMonthlySearches",key:"avgMonthlySearches",sorter:(e,t)=>e.avgMonthlySearches-t.avgMonthlySearches,render:e=>new Intl.NumberFormat().format(e)},{title:"Competition",dataIndex:"competition",key:"competition",sorter:(e,t)=>e.competition_index-t.competition_index,render:e=>o.jsx(Z,{color:e==="LOW"?"green":e==="MEDIUM"?"orange":e==="HIGH"?"red":"gray",className:"text-xs sm:text-sm",children:e})},{title:"Competition Index",dataIndex:"competition_index",key:"competition_index",sorter:(e,t)=>e.competition_index-t.competition_index,render:e=>e||"-"}],I=(l==null?void 0:l.map((e,t)=>({key:t,keyword:e.keyword,avgMonthlySearches:e.avgMonthlySearches,competition:e.competition,competition_index:e.competition_index,avgCpc:e.avgCpc,lowBid:e.lowBid,highBid:e.highBid})))||[],T=S?I.filter(e=>{var t;return(t=a==null?void 0:a.allKeywords)==null?void 0:t.includes(e.keyword)}):I,J=e=>c(e);w.useEffect(()=>()=>{y([]),v(""),c(1),k(!1)},[]),w.useEffect(()=>(f?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[f]);const m=((H=a==null?void 0:a.allKeywords)==null?void 0:H.length)>0;return o.jsx(C,{open:f,onCancel:g,closable:!0,footer:[o.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 pt-2 border-t border-gray-100",children:[o.jsx(p.button,{onClick:W,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 w-full sm:w-auto",whileHover:{scale:1.03},whileTap:{scale:.97},disabled:j||!(l!=null&&l.length),style:{opacity:j||!(l!=null&&l.length)?.5:1,cursor:j||!(l!=null&&l.length)?"not-allowed":"pointer"},children:"Show Auto-Selected Keywords"}),o.jsx(p.button,{onClick:G,className:`px-4 py-2 text-sm font-medium rounded-lg w-full sm:w-auto ${m?"text-gray-700 bg-gray-100 hover:bg-gray-200":"text-gray-400 bg-gray-200 cursor-not-allowed"}`,whileHover:{scale:m?1.03:1},whileTap:{scale:m?.97:1},disabled:!m,children:"Create Blog"}),o.jsx(p.button,{onClick:U,className:`px-4 py-2 text-sm font-medium rounded-lg w-full sm:w-auto ${m?"text-gray-700 bg-gray-100 hover:bg-gray-200":"text-gray-400 bg-gray-200 cursor-not-allowed"}`,whileHover:{scale:m?1.03:1},whileTap:{scale:m?.97:1},disabled:!m,children:"Create New Job"}),o.jsx(p.button,{onClick:g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 w-full sm:w-auto",whileHover:{scale:1.03},whileTap:{scale:.97},children:"Close"})]},"footer-buttons")],width:"90vw",centered:!0,title:"Keyword Research",styles:{content:{maxWidth:"1000px",margin:"0 auto"},body:{padding:"16px"}},className:"rounded-lg sm:rounded-xl",children:o.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[o.jsx("p",{className:"mb-3 sm:mb-4 text-gray-600 text-sm sm:text-base",children:"Find and analyze keywords for your blog"}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4 sm:mb-6",children:[o.jsx(V,{placeholder:"Enter a keyword",value:b,onChange:e=>v(e.target.value),onKeyPress:L,className:"flex-1 text-sm sm:text-base","aria-label":"Enter keyword"}),o.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:o.jsx(B,{type:"primary",onClick:M,className:"w-full sm:w-auto",children:"Add"})})]}),o.jsx("div",{className:"flex flex-wrap gap-2 mb-4 sm:mb-6",children:r.map((e,t)=>o.jsxs(p.div,{initial:{opacity:0,scale:.8},animate:{opacity:1},className:"bg-blue-100 text-blue-800 px-2 sm:px-3 py-1 rounded-full flex items-center text-xs sm:text-sm",children:[o.jsx("span",{className:"lowercase",children:e}),o.jsx(p.div,{whileHover:{scale:1.2},whileTap:{scale:.8},className:"ml-1 sm:ml-2 cursor-pointer",onClick:()=>D(t),children:o.jsx(A,{className:"text-blue-800 text-xs"})})]},t))}),o.jsx(p.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:o.jsx(B,{block:!0,type:"primary",onClick:O,loading:j,disabled:r.length===0,className:"text-sm sm:text-base",children:"Analyze Keywords"})}),!j&&(l==null?void 0:l.length)>0&&o.jsxs("div",{className:"mt-4 sm:mt-6",children:[o.jsxs("div",{className:"flex items-center mb-3 sm:mb-4",children:[o.jsx(X,{checked:S,onChange:e=>k(e),disabled:!m,size:"small"}),o.jsx("span",{className:"ml-2 text-gray-600 text-sm sm:text-base",children:"Show Selected Keywords Only"})]}),o.jsx("div",{className:"overflow-x-auto",children:o.jsx(Y,{columns:F,dataSource:T,pagination:{current:i,pageSize:5,showSizeChanger:!1,onChange:J,total:T.length,responsive:!0},rowSelection:{selectedRowKeys:(a==null?void 0:a.allKeywords)||[],onChange:e=>{d(K({focusKeywords:e.slice(0,3),keywords:e,allKeywords:e}))},getCheckboxProps:e=>({name:e.keyword})},rowKey:e=>e.keyword,scroll:{x:600},className:"min-w-[600px]"})})]})]})})};export{re as default};
