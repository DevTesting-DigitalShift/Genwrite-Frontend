import{u as v,a as P,r as n,g as m,j as r,A,H as D,m as L,b as R}from"./index-aYFSkxCW.js";import{d as S}from"./dayjs.min-DJ8XQ6RA.js";import{l as z}from"./lodash-BAIwReWa.js";import{T as M}from"./index-D7qzkbYs.js";import{S as y,E as G}from"./index-ChoG752t.js";import{F as k}from"./Table-DYJ9KieL.js";import{S as F}from"./index-BxGnNRVv.js";import"./Overflow-BrHWJOfH.js";import"./useIcons-C722aAyl.js";import"./Pagination-DBT_PGza.js";import"./LeftOutlined-DpFuWCUD.js";import"./Input-KkkcHe-u.js";import"./EllipsisOutlined-DIrzkHXA.js";var U=Object.defineProperty,Y=Object.defineProperties,B=Object.getOwnPropertyDescriptors,b=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,N=(a,s,o)=>s in a?U(a,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[s]=o,d=(a,s)=>{for(var o in s||(s={}))H.call(s,o)&&N(a,o,s[o]);if(b)for(var o of b(s))$.call(s,o)&&N(a,o,s[o]);return a},x=(a,s)=>Y(a,B(s));const{Option:h}=y,ie=()=>{const a=v(),{logs:s,loading:o}=P(e=>e.creditLogs),[p,K]=n.useState(""),[i,I]=n.useState("24h"),[g,w]=n.useState([]),[l,c]=n.useState({current:1,pageSize:10}),_=[10,20,50,100],j=["BLOG_GENERATION","QUICK_BLOG_GENERATION","AI_PROOFREADING","COMPETITOR_ANALYSIS","SUBSCRIPTION_PAYMENT","OTHER"];n.useMemo(()=>z.debounce(e=>{c(t=>x(d({},t),{current:1})),a(m(d({page:1,limit:-1},u(i))))},500),[a,i]);const u=e=>{const t=S();switch(e){case"24h":return{start:t.subtract(24,"hours").startOf("hour").toISOString(),end:t.endOf("hour").toISOString()};case"7d":return{start:t.subtract(7,"days").startOf("day").toISOString(),end:t.endOf("day").toISOString()};case"30d":return{start:t.subtract(30,"days").startOf("day").toISOString(),end:t.endOf("day").toISOString()};default:return{}}};n.useEffect(()=>{const e=d({page:1,limit:-1},u(i));a(m(e))},[a,i]);const O={BLOG_GENERATION:"bg-blue-100 text-blue-700",QUICK_BLOG_GENERATION:"bg-indigo-100 text-indigo-700",AI_PROOFREADING:"bg-green-100 text-green-700",COMPETITOR_ANALYSIS:"bg-yellow-100 text-yellow-800",SUBSCRIPTION_PAYMENT:"bg-purple-100 text-purple-700",OTHER:"bg-gray-100 text-gray-700"},T=n.useMemo(()=>[{title:"Blog Topic",dataIndex:["metadata","title"],key:"blogTitle",render:e=>r.jsx("div",{children:r.jsx("span",{className:"text-sm text-gray-700 capitalize",children:e||"-"})})},{title:"Date",dataIndex:"createdAt",key:"createdAt",sorter:(e,t)=>new Date(e.createdAt)-new Date(t.createdAt),render:e=>r.jsx("span",{className:"text-sm text-gray-600",children:S(e).format("DD MMM YYYY, hh:mm A")})},{title:"Type",dataIndex:"category",key:"category",filters:[{text:"Deduction",value:"DEDUCTION"},{text:"Adjustment",value:"ADJUSTMENT"}],onFilter:(e,t)=>t.category===e,render:e=>r.jsx(M,{color:e==="DEDUCTION"?"red":"green",className:"font-medium px-3 py-1 rounded-full text-xs",children:e})},{title:"Purpose",dataIndex:"purpose",key:"purpose",filters:j.map(e=>({text:e.toLowerCase().replace(/_/g," "),value:e})),filterMultiple:!0,onFilter:(e,t)=>t.purpose===e,render:e=>{const t=O[e]||"bg-gray-100 text-gray-700",f=(e==null?void 0:e.toLowerCase().replace(/_/g," "))||"-";return r.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-semibold capitalize ${t}`,children:f})}},{title:"Amount",dataIndex:"amount",key:"amount",sorter:(e,t)=>e.amount-t.amount,render:e=>r.jsx("span",{className:`font-semibold ${e<0?"text-red-500":"text-green-600"}`,children:e>0?`+${e}`:e})},{title:"Remaining Credits",dataIndex:"remainingCredits",key:"remainingCredits",render:e=>r.jsx("span",{className:"text-sm font-medium text-gray-800",children:e})}],[O,a,p,g,i]);n.useEffect(()=>{const e=R();if(!e)return;const t=f=>{a(m(d({page:1,limit:-1,search:p,purpose:g},u(i))))};return e.on("credit-log",t),()=>{e.off("credit-log",t)}},[a,i,p,g]);const E=n.useMemo(()=>{const e=(l.current-1)*l.pageSize,t=e+l.pageSize;return s.slice(e,t)},[s,l.current,l.pageSize]);return r.jsxs(A,{children:[r.jsx(D,{children:r.jsx("title",{children:"Credit Logs | GenWrite"})}),r.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3},className:"p-6 bg-white rounded-2xl shadow-md border border-gray-200",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4",children:[r.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Credit Logs"}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[r.jsxs(y,{value:i,onChange:e=>{I(e),c(t=>x(d({},t),{current:1})),a(m(d({page:1,limit:-1},u(e))))},className:"w-full sm:w-48 rounded-lg",popupClassName:"rounded-lg","aria-label":"Select date range",children:[r.jsx(h,{value:"24h",children:"Last 24 Hours"}),r.jsx(h,{value:"7d",children:"Last 7 Days"}),r.jsx(h,{value:"30d",children:"Last 30 Days"})]}),r.jsx(y,{value:l.pageSize,onChange:e=>{c(t=>x(d({},t),{pageSize:e,current:1}))},options:_.map(e=>({label:`${e} / page`,value:e})),className:"w-full sm:w-32 rounded-lg",popupClassName:"rounded-lg","aria-label":"Select page size"})]})]}),r.jsx("style",{children:`
            .ant-table-thead {
              position: sticky;
              top: 0;
              z-index: 10;
              background: #fafafa;
            }
            .ant-table-thead > tr > th {
              background: #fafafa !important;
            }
          `}),r.jsx(k,{dataSource:E,columns:T,loading:o,rowKey:"_id",pagination:{current:l.current,pageSize:l.pageSize,total:s.length,showSizeChanger:!1,showTotal:e=>`Total ${e} logs`,onChange:e=>{c(t=>x(d({},t),{current:e}))}},className:"rounded-xl overflow-hidden",rowClassName:"hover:bg-gray-50 transition-colors duration-200",bordered:!1,locale:{emptyText:o?r.jsx(F,{tip:"Loading logs..."}):r.jsx(G,{description:p||g.length>0?"No logs match the filters":"No Logs Found"})},onChange:(e,t,f,Q)=>{const C=t.purpose||[];w(C),c({current:e.current,pageSize:e.pageSize})}})]})]})};export{ie as default};
