import{V as X,u as J,F as ee,aZ as te,Q as p,j as e,H as ae,m as o,B as L,T as se,a_ as le,a$ as re}from"./index-BiN8l-P3.js";import{b as l}from"./chunk-tiptap-DcNQbKmZ.js";import{b as ie}from"./SkeletonLoader-CHi2GkFI.js";import{l as oe}from"./lodash-EzD5AM7H.js";import{h as r}from"./moment-C5S46NFB.js";import{R as ne}from"./refresh-ccw-Cxu4XkPf.js";import{T as ce,B as de}from"./index-Dd5ObnXQ.js";import{I as me}from"./index-DILUNdX8.js";import{S as he}from"./search-CsAQzegS.js";import{S as $}from"./index-C0emBpwG.js";import{P as xe}from"./index-CdqaZapL.js";import{R as ge}from"./QuestionCircleOutlined-CHzp7tSD.js";import{P as pe}from"./Pagination-BweTF5Wh.js";import"./createLucideIcon-Cn4USsaF.js";import"./Input-CO8B-yPm.js";import"./useIcons-DeAJ6z0L.js";import"./Overflow-DbYj3NoT.js";import"./index-CSUDpjMW.js";import"./LeftOutlined-CCav-uP7.js";const{Search:ue}=me,{Option:v}=$,$e=()=>{const[N,T]=l.useState([]),[u,n]=l.useState(1),[d,G]=l.useState(15),[C,k]=l.useState(0),[A,O]=l.useState(""),[f,M]=l.useState("all"),[m,fe]=l.useState([null,null]),[c,B]=l.useState(!1),{handlePopup:_}=X(),P=J(),H=85,z=[10,15,20,50],D=ee();r().subtract(7,"days"),r(),r().subtract(30,"days"),r(),r().subtract(3,"months"),r(),r().startOf("year"),r();const U=l.useCallback(oe.debounce(t=>{O(t),n(1)},500),[]),b=l.useCallback(async()=>{B(!0);try{const t={isArchived:!0,status:f!=="all"?f:void 0,q:A||void 0,start:m[0]?r(m[0]).toISOString():void 0,end:m[1]?r(m[1]).toISOString():void 0,page:u,limit:d},a=await te(t);T(a.data||[]),k(a.totalItems||0)}catch(t){console.error("Failed to fetch trashed blogs:",t),p.error("Failed to load trashed blogs. Please try again.")}finally{B(!1)}},[f,A,m,u,d]);l.useEffect(()=>{b()},[b]),l.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[u]);const R=(t,a=H)=>t?t.length>a?t.substring(0,a)+"...":t:"",F=t=>{var a,h,i;return(i=(h=(a=t==null?void 0:t.replace(/<[^>]*>/g,""))==null?void 0:a.replace(/[\\*#=_~`>\-]+/g,""))==null?void 0:h.replace(/\s{2,}/g," "))==null?void 0:i.trim()},V=async t=>{try{await P(re(t)).unwrap(),b()}catch(a){console.error("Failed to restore blog:",a),p.error("Failed to restore blog. Please try again.")}},q=async()=>{try{await P(le()).unwrap(),T([]),n(1),k(0)}catch(t){console.error("Failed to delete all blogs:",t),p.error("Failed to delete all blogs. Please try again.")}},Y=async()=>{n(1),await b(),p.info("Blog list refreshed")},E=t=>{p.info(`Clicked on blog: ${t.title}`)},Z=t=>{D(`/blog-editor/${t._id}`)};return e.jsxs("div",{className:"p-5",children:[e.jsx(ae,{children:e.jsx("title",{children:"Trashcan | GenWrite"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 mb-6",children:[e.jsx(o.h1,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4},className:"text-3xl sm:text-4xl font-extrabold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Trashcan"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(L,{type:"default",icon:e.jsx(ne,{className:"w-4 h-4"}),onClick:Y,disabled:c,children:"Refresh"})}),N.length>0&&e.jsx(o.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(L,{type:"default",icon:e.jsx(ce,{className:"w-4 h-4"}),onClick:()=>_({title:"Delete All Trashed Blogs",description:e.jsxs("span",{className:"my-2",children:["All trashed blogs will be ",e.jsx("b",{children:"permanently deleted"}),". This action cannot be undone."]}),confirmText:"Delete All",onConfirm:q,confirmProps:{className:"border-red-500 hover:bg-red-500 hover:text-white"},cancelProps:{danger:!1}}),disabled:c,children:"Delete All"})})]})]}),e.jsx(o.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},className:"text-gray-600 text-sm sm:text-base max-w-xl mb-6",children:"Restore valuable work or permanently delete clutter. Trashed items are deleted after 7 days."}),e.jsx(o.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},className:"bg-white/90 backdrop-blur-md rounded-xl shadow-sm border border-gray-100 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(ue,{placeholder:"Search by title or keywords...",onChange:t=>U(t.target.value),prefix:e.jsx(he,{className:"w-5 h-5 text-gray-400 mr-2"}),allowClear:!0,className:"w-full  rounded-lg",disabled:c}),e.jsxs($,{value:f,onChange:t=>{M(t),n(1)},className:"w-full sm:w-1/4 rounded-lg",placeholder:"Filter by status",disabled:c,children:[e.jsx(v,{value:"all",children:"All Statuses"}),e.jsx(v,{value:"complete",children:"Complete"}),e.jsx(v,{value:"failed",children:"Failed"}),e.jsx(v,{value:"pending",children:"Pending"})]})]})}),c?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:[...Array(d)].map((t,a)=>e.jsx("div",{className:"bg-white shadow-md rounded-xl p-4",children:e.jsx(ie,{})},a))}):N.length===0?e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},className:"flex flex-col justify-center items-center",style:{minHeight:"calc(100vh - 250px)"},children:[e.jsx("img",{src:"Images/trash-can.png",alt:"Trash",style:{width:"8rem"}}),e.jsx("p",{className:"text-xl mt-5 text-gray-600",children:"No trashed blogs available."})]}):e.jsxs(e.Fragment,{children:[e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 p-2",children:N.map(t=>{const a=t.isManuallyEdited===!0,{_id:h,title:i,status:s,createdAt:K,content:I,aiModel:x,focusKeywords:S,wordpress:y,archiveDate:Q,agendaJob:j}=t,w=/gemini/gi.test(x);return e.jsx(de.Ribbon,{text:e.jsx("span",{className:"flex items-center justify-center gap-1 py-1 font-medium tracking-wide",children:a?e.jsx(e.Fragment,{children:"Manually Generated"}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:`./Images/${w?"gemini":x==="claude"?"claude":"chatgpt"}.png`,alt:w?"Gemini":x==="claude"?"Claude":"ChatGPT",width:20,height:20,loading:"lazy",className:"bg-white"}),w?"Gemini 2.0 flash":x==="claude"?"Claude 4 sonnet":"Gpt 4.1 nano"]})}),className:"absolute top-0",color:a?"#9CA3AF":w?"#4796E3":x==="claude"?"#9368F8":"#74AA9C",children:e.jsxs("div",{className:`bg-white shadow-md hover:shadow-xl transition-all duration-300 rounded-xl p-4 min-h-[180px] min-w-[390px] relative ${a?"border-gray-500":s==="failed"?"border-red-500":s==="pending"||s==="in-progress"?"border-yellow-500":"border-green-500"} border-2`,title:i,children:[e.jsx("div",{className:"text-xs font-semibold text-gray-400 mb-2 -mt-2",children:new Date(K).toLocaleDateString("en-US",{dateStyle:"medium"})}),a?e.jsx("div",{className:"cursor-pointer",onClick:()=>Z(t),role:"button",tabIndex:0,onKeyDown:g=>g.key==="Enter"&&D("/blog-editor"),"aria-label":`View blog ${i}`,children:e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg capitalize font-semibold text-gray-900 !text-left max-w-76",children:i}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-3 break-all",children:R(F(I))||""})]})}):e.jsx(se,{title:s==="complete"?i:s==="failed"?"Blog generation failed":s==="pending"?`Pending Blog will be generated ${j!=null&&j.nextRunAt?"at "+new Date(j.nextRunAt).toLocaleString("en-IN",{dateStyle:"medium",timeStyle:"short"}):"shortly"}`:`Blog generation is ${s}`,color:s==="complete"?"green":s==="failed"?"red":"#eab308",children:e.jsx("div",{className:"cursor-pointer",onClick:()=>{(s==="complete"||s==="failed")&&E(t)},role:"button",tabIndex:0,onKeyDown:g=>g.key==="Enter"&&(s==="complete"||s==="failed")&&E(t),"aria-label":`View blog ${i}`,children:e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg capitalize font-semibold text-gray-900 !text-left max-w-76",children:i}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-3 break-all",children:R(F(I))||""})]})})}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:S==null?void 0:S.map((g,W)=>e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full",children:g},W))}),e.jsx(xe,{title:"Restore Blog",description:"Are you sure to restore this blog?",icon:e.jsx(ge,{style:{color:"red"}}),okText:"Yes",cancelText:"No",onConfirm:()=>V(h),children:e.jsx(o.div,{whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx("img",{src:"Images/restore.svg",alt:"Restore",width:"20",height:"20",className:"cursor-pointer restore-icon"})})})]}),e.jsxs("div",{className:"mt-3 mb-2 flex justify-end text-xs text-right text-gray-500 font-medium",children:[(y==null?void 0:y.postedOn)&&e.jsxs("span",{children:["Posted on:",new Date(y.postedOn).toLocaleDateString("en-US",{dateStyle:"medium"})]}),e.jsxs("span",{className:"block -mb-2 text-sm text-right",children:["Archive Date:"," ",new Date(Q).toLocaleDateString("en-US",{dateStyle:"medium"})]})]})]})},h)})}),C>15&&e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4,delay:.3},className:"flex justify-center mt-6",children:e.jsx(pe,{current:u,pageSize:d,total:C,pageSizeOptions:z.filter(t=>t<=100),onChange:(t,a)=>{n(t),a!==d&&(G(a),n(1))},showSizeChanger:!1,showTotal:t=>`Total ${t} blogs`,responsive:!0,disabled:c})})]})]})]})};export{$e as default};
