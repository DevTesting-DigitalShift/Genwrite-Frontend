{"version":3,"file":"PreviewBlog-3d9-gocB.js","sources":["../../src/pages/preview/PreviewBlog.jsx"],"sourcesContent":["import { marked } from \"marked\"\r\nimport { useEffect, useState } from \"react\"\r\nimport \"./preview.css\"\r\nimport { useLoaderData } from \"react-router-dom\"\r\nimport { Card, Typography } from \"antd\"\r\nconst { Title, Text } = Typography\r\nimport DOMPurify from \"dompurify\"\r\n\r\nfunction estimateReadingTime(text) {\r\n  const words = text.trim().split(/\\s+/).length\r\n  return `${Math.ceil(words / 200)} min read`\r\n}\r\n\r\nfunction generateTOC(markdown) {\r\n  const lines = markdown.split(\"\\n\")\r\n\r\n  const seen = new Set()\r\n  const toc = []\r\n  let h2Found = false\r\n\r\n  for (const line of lines) {\r\n    if (/^## /.test(line)) {\r\n      h2Found = true\r\n      let text = line.replace(/^## /, \"\").trim()\r\n\r\n      // Strip markdown formatting\r\n      text = text\r\n        .replace(/!\\[.*?\\]\\(.*?\\)/g, \"\")\r\n        .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, \"$1\")\r\n        .replace(/[*_~`]+/g, \"\")\r\n        .replace(/<[^>]*>/g, \"\")\r\n        .trim()\r\n\r\n      const id = text\r\n        .toLowerCase()\r\n        .replace(/[^\\w]+/g, \"-\")\r\n        .replace(/^-+|-+$/g, \"\")\r\n\r\n      if (!seen.has(id)) {\r\n        seen.add(id)\r\n        toc.push({ text, id, level: 2 })\r\n      }\r\n    } else if (/^### /.test(line) && !h2Found) {\r\n      let text = line.replace(/^### /, \"\").trim()\r\n\r\n      // Strip markdown formatting\r\n      text = text\r\n        .replace(/!\\[.*?\\]\\(.*?\\)/g, \"\")\r\n        .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, \"$1\")\r\n        .replace(/[*_~`]+/g, \"\")\r\n        .replace(/<[^>]*>/g, \"\")\r\n        .trim()\r\n\r\n      const id = text\r\n        .toLowerCase()\r\n        .replace(/[^\\w]+/g, \"-\")\r\n        .replace(/^-+|-+$/g, \"\")\r\n\r\n      if (!seen.has(id)) {\r\n        seen.add(id)\r\n        toc.push({ text, id, level: 3 })\r\n      }\r\n    }\r\n  }\r\n\r\n  return toc\r\n}\r\n\r\nfunction addHeadingIds(markdown) {\r\n  return markdown.replace(/^(#{2,3}) (.+)$/gm, (_, hashes, text) => {\r\n    const id = text.toLowerCase().replace(/[^\\w]+/g, \"-\")\r\n    return `${hashes} <a id=\"${id}\"></a>${text}`\r\n  })\r\n}\r\n\r\nexport default function PreviewBlog() {\r\n  const blog = useLoaderData()\r\n  const [html, setHtml] = useState(\"\")\r\n  const [toc, setTOC] = useState([])\r\n\r\n  const isBrowser = typeof window !== \"undefined\"\r\n\r\n  useEffect(() => {\r\n    if (blog && isBrowser) {\r\n      const { title, content } = blog\r\n      const withAnchors = addHeadingIds(content)\r\n      const rawHtml = marked.parse(withAnchors)\r\n      const safeHtml = DOMPurify.sanitize(rawHtml) // only on client\r\n      setHtml(safeHtml)\r\n      setTOC(generateTOC(content))\r\n\r\n      document.title = title\r\n    }\r\n  }, [blog])\r\n\r\n  const { title, author, createdAt, content } = blog\r\n  const readingTime = estimateReadingTime(content)\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto px-4 py-10 scroll-smooth\">\r\n      <Card className=\"rounded-lg shadow-lg\">\r\n        <header className=\"mb-6 text-right\">\r\n          <Title level={1} className=\"mb-2 text-center text-pretty \">\r\n            {title}\r\n          </Title>\r\n          <Text type=\"secondary\">\r\n            By <Text strong>{author?.name}</Text> &nbsp;·&nbsp;\r\n            {new Date(createdAt).toLocaleDateString(\"en-US\", {\r\n              month: \"long\",\r\n              day: \"2-digit\",\r\n              year: \"numeric\",\r\n            })}\r\n            &nbsp;·&nbsp;{readingTime}\r\n          </Text>\r\n        </header>\r\n\r\n        {toc.length > 0 && (\r\n          <Card type=\"inner\" title=\"Table of Contents\" className=\"mb-6\">\r\n            <ul className=\"pl-4 space-y-1\">\r\n              {toc.map(({ text, id, level }) => (\r\n                <li key={id} className={`ml-${level === 3 ? \"4\" : \"0\"} list-disc`}>\r\n                  <a href={`#${id}`} className=\"link no-underline hover:underline\">\r\n                    {text}\r\n                  </a>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </Card>\r\n        )}\r\n\r\n        <article\r\n          className=\"blog-content prose max-w-none\"\r\n          dangerouslySetInnerHTML={{ __html: html }}\r\n        />\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n"],"names":["Title","Text","Typography","estimateReadingTime","text","words","generateTOC","markdown","lines","seen","toc","h2Found","line","id","addHeadingIds","_","hashes","PreviewBlog","blog","useLoaderData","html","setHtml","useState","setTOC","isBrowser","useEffect","title","content","withAnchors","rawHtml","marked","safeHtml","DOMPurify","author","createdAt","readingTime","jsxs","Card","jsx","level"],"mappings":"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"}