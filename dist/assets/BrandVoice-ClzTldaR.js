import{a as D,u as J,r as l,V as E,aI as _,S as b,Q,aJ as X,aK as Z,j as e,m as p,H as ee,T as C,aL as re,aM as ae}from"./index-aYFSkxCW.js";import{F as se,a as te}from"./index-IkAyZDHy.js";import{I as O}from"./info-WCvQjC2P.js";import{L as R}from"./loader-circle-BPL_3AhR.js";import{U as ie}from"./upload-CkVPZaPv.js";import"./iconBase-DlYiHJtC.js";import"./createLucideIcon-D3N6Lln-.js";var oe=Object.defineProperty,le=Object.defineProperties,ne=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,de=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable,$=(c,s,o)=>s in c?oe(c,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[s]=o,u=(c,s)=>{for(var o in s||(s={}))de.call(s,o)&&$(c,o,s[o]);if(T)for(var o of T(s))ce.call(s,o)&&$(c,o,s[o]);return c},f=(c,s)=>le(c,ne(s)),pe=(c,s,o)=>new Promise((y,w)=>{var N=i=>{try{d(o.next(i))}catch(m){w(m)}},a=i=>{try{d(o.throw(i))}catch(m){w(m)}},d=i=>i.done?y(i.value):Promise.resolve(i.value).then(N,a);d((o=o.apply(c,s)).next())});const we=()=>{const c=D(r=>r.auth.user),s=J(),[o,y]=l.useState(""),[w,N]=l.useState(!1),[a,d]=l.useState({nameOfVoice:"",postLink:"",keywords:[],describeBrand:"",sitemapUrl:"",selectedVoice:null,_id:void 0}),[i,m]=l.useState({}),{brands:j,siteInfo:g}=D(r=>r.brand),[V,B]=l.useState(""),[F,v]=l.useState(!1);l.useEffect(()=>{s(E())},[s]),l.useEffect(()=>{j.length>0&&!a.selectedVoice&&d(r=>f(u({},r),{selectedVoice:j[0]}))},[j]),l.useEffect(()=>(a._id||L(),()=>{L(),s(_())}),[s]),l.useEffect(()=>{g.data&&!F&&(d(r=>f(u({},r),{nameOfVoice:g.data.nameOfVoice||r.nameOfVoice,describeBrand:g.data.describeBrand||r.describeBrand,keywords:g.data.keywords||r.keywords,postLink:g.data.postLink||r.postLink,sitemapUrl:g.data.sitemap||r.sitemapUrl})),m(r=>f(u({},r),{nameOfVoice:void 0,describeBrand:void 0,keywords:void 0,postLink:void 0,sitemapUrl:void 0})),B(a.postLink)),g.error&&b.error("Failed to fetch site info. Please try a different URL.")},[g,a.postLink,F]);const L=l.useCallback(()=>{d({nameOfVoice:"",postLink:"",keywords:[],describeBrand:"",sitemapUrl:"",selectedVoice:j[0]||null,_id:void 0}),y(""),m({}),B(""),v(!0)},[j]),P=l.useCallback(()=>{const r={};if(a.nameOfVoice.trim()||(r.nameOfVoice="Name of Voice is required."),!a.postLink.trim())r.postLink="Post link is required.";else try{new URL(a.postLink)}catch(t){r.postLink="Please enter a valid URL (e.g., https://example.com)."}if(a.keywords.length===0&&(r.keywords="At least one keyword is required."),a.describeBrand.trim()||(r.describeBrand="Brand description is required."),!a.sitemapUrl.trim())r.sitemapUrl="Sitemap URL is required.";else try{new URL(a.sitemapUrl)}catch(t){r.sitemapUrl="Please enter a valid URL (e.g., https://example.com/sitemap.xml)."}return m(r),Object.keys(r).length===0},[a]),U=l.useCallback(r=>{const{name:t,value:n}=r.target;d(h=>f(u({},h),{[t]:n})),m(h=>f(u({},h),{[t]:void 0})),t==="postLink"&&n!==V&&B(""),v(!1)},[V]),K=l.useCallback(r=>{if(r.key==="Enter"&&o.trim()){r.preventDefault();const t=a.keywords.map(x=>x.toLowerCase()),n=new Set,h=o.split(",").map(x=>x.trim()).filter(x=>{const S=x.toLowerCase();return!x||t.includes(S)||n.has(S)?!1:(n.add(S),!0)});if(h.length===0)return;d(x=>f(u({},x),{keywords:[...x.keywords,...h]})),y(""),m(x=>f(u({},x),{keywords:void 0})),v(!1)}},[o,a.keywords]),I=l.useCallback(r=>{d(t=>f(u({},t),{keywords:t.keywords.filter(n=>n!==r)})),v(!1)},[]),z=l.useCallback(r=>{const t=r.target.files[0];if(!t)return;if(!t.name.toLowerCase().endsWith(".csv")){b.error("Invalid file type. Please upload a .csv file."),r.target.value=null;return}const n=20*1024;if(t.size>n){b.error("File size exceeds 20KB limit. Please upload a smaller file."),r.target.value=null;return}if(t.type!=="text/csv"){b.error("Please upload a valid CSV file."),r.target.value=null;return}const h=new FileReader;h.onload=x=>{const G=x.target.result.split(/,|\n|;/).map(k=>k.trim()).filter(k=>k.length>0);d(k=>f(u({},k),{keywords:[...new Set([...k.keywords,...G])]})),m(k=>f(u({},k),{keywords:void 0})),v(!1)},h.onerror=()=>b.error("Error reading CSV file."),h.readAsText(t),r.target.value=null},[]),H=l.useCallback(()=>pe(null,null,function*(){if(!P())return;N(!0);const r={nameOfVoice:a.nameOfVoice.trim(),postLink:a.postLink.trim(),keywords:a.keywords.map(t=>t.trim()).filter(Boolean),describeBrand:a.describeBrand.trim(),sitemap:a.sitemapUrl.trim(),userId:c==null?void 0:c._id};try{a._id?yield s(re({id:a._id,payload:r})).unwrap():yield s(ae({payload:r})).unwrap(),L(),s(E()),s(_())}catch(t){b.error(a._id?"Failed to update brand voice.":"Failed to create brand voice.")}finally{N(!1)}}),[a,c,s,P,L]),q=l.useCallback(r=>{d({nameOfVoice:r.nameOfVoice||"",postLink:r.postLink||"",keywords:Array.isArray(r.keywords)?r.keywords:[],describeBrand:r.describeBrand||"",sitemapUrl:r.sitemap||"",selectedVoice:r,_id:r._id}),m({}),B(r.postLink||""),v(!1)},[]),A=l.useCallback(r=>{Q.confirm({title:"Delete Brand Voice?",content:"Are you sure you want to delete this brand voice? This action cannot be undone.",okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>{s(X({id:r._id})).unwrap().then(()=>{var t;((t=a.selectedVoice)==null?void 0:t._id)===r._id&&(L(),s(_()))}).catch(()=>b.error("Failed to delete brand voice."))}})},[s,a.selectedVoice,L]),M=l.useCallback(r=>{d(t=>f(u({},t),{selectedVoice:r})),v(!1)},[]),W=l.useCallback(()=>{const r=a.postLink.trim();if(!r){m(t=>f(u({},t),{postLink:"Post link is required to fetch site info."}));return}if(r===V){b.info("This URL has already been fetched.");return}try{new URL(r),s(Z(r)).unwrap().then(()=>{v(!1)}).catch(()=>b.error("Failed to fetch site info. Please try a different URL."))}catch(t){m(n=>f(u({},n),{postLink:"Please enter a valid URL (e.g., https://example.com)."}))}},[a.postLink,V,s]),Y=l.useMemo(()=>{const r=a.keywords.slice(-3),t=a.keywords.length-r.length;return e.jsxs(e.Fragment,{children:[t>0&&e.jsx(p.div,{className:"flex items-center bg-indigo-100 text-indigo-700 rounded-md px-2 py-1 mr-2",initial:{scale:.8},animate:{scale:1},title:`+${t} more keywords`,children:e.jsx("span",{className:"text-sm",children:`+${t}`})}),r.map(n=>e.jsxs(p.div,{className:"flex items-center bg-indigo-100 text-indigo-700 rounded-md px-2 py-1 mr-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,scale:.8},whileHover:{scale:1.05},children:[e.jsx("span",{className:"text-sm truncate max-w-[100px]",children:n}),e.jsx(se,{className:"ml-1 cursor-pointer text-indigo-500 hover:text-indigo-700 transition-colors",onClick:h=>{h.stopPropagation(),I(n)},"aria-label":`Remove ${n}`})]},n))]})},[a.keywords,I]);return e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col lg:flex-row gap-6 p-4 lg:p-6 max-w-7xl mx-auto",children:[e.jsx(ee,{children:e.jsx("title",{children:"Brand Voice | GenWrite"})}),e.jsxs(p.div,{className:"w-full lg:w-[60%] bg-white rounded-xl p-6 shadow-lg border border-gray-100",initial:{x:-20},animate:{x:0},children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Create Your Brand Voice"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Define your brand's unique tone and style to ensure consistent content creation."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"postLink",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Post or Blog Link ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(C,{title:"Add a link of your home page to fetch site info",overlayInnerStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"220px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(O,{size:16,className:"text-blue-500"})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p.input,{id:"postLink",type:"url",name:"postLink",value:a.postLink,onChange:U,placeholder:"e.g., https://example.com/blog",className:`flex-grow p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${i.postLink?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!i.postLink,"aria-describedby":i.postLink?"postLink-error":void 0}),e.jsx(p.button,{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:W,whileHover:{scale:1.03},whileTap:{scale:.98},disabled:g.loading||a.postLink&&a.postLink===V,"aria-label":"Fetch Site Info",children:g.loading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"animate-spin w-4 h-4"}),"Fetching..."]}):"Fetch Site Info"})]}),i.postLink&&e.jsx("p",{id:"postLink-error",className:"text-red-500 text-xs mt-1",children:i.postLink})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"nameOfVoice",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Name of Voice ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p.input,{id:"nameOfVoice",type:"text",name:"nameOfVoice",value:a.nameOfVoice,onChange:U,placeholder:"e.g., Friendly Tech",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${i.nameOfVoice?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!i.nameOfVoice,"aria-describedby":i.nameOfVoice?"nameOfVoice-error":void 0}),i.nameOfVoice&&e.jsx("p",{id:"nameOfVoice-error",className:"text-red-500 text-xs mt-1",children:i.nameOfVoice})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"keywords",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Keywords ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(C,{title:"Upload a .csv file in the format: `Keyword` as header",overlayInnerStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"220px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(O,{size:16,className:"text-blue-500"})})})]}),e.jsxs(p.div,{className:`flex items-center bg-white border rounded-lg p-2 flex-wrap gap-2 ${i.keywords?"border-red-500":"border-gray-300"}`,whileHover:{boxShadow:"0 0 0 3px rgba(99, 102, 241, 0.2)"},children:[Y,e.jsx("input",{id:"keywords",type:"text",value:o,onChange:r=>y(r.target.value),onKeyDown:K,className:"flex-grow p-2 bg-transparent border-none outline-none text-sm",placeholder:"Type a keyword and press Enter","aria-describedby":i.keywords?"keywords-error":void 0}),e.jsx("label",{htmlFor:"file-upload",className:"flex items-center cursor-pointer",children:e.jsx(p.div,{className:"bg-indigo-100 p-2 rounded-lg",whileHover:{scale:1.1},whileTap:{scale:.95},"aria-label":"Upload CSV file",children:e.jsx(ie,{size:20,className:"text-indigo-600"})})}),e.jsx("input",{id:"file-upload",type:"file",className:"hidden",onChange:z,accept:".csv"})]}),i.keywords&&e.jsx("p",{id:"keywords-error",className:"text-red-500 text-xs mt-1",children:i.keywords})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"sitemapUrl",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Sitemap URL ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(C,{title:"Paste the URL of your XML sitemap (e.g., https://example.com/sitemap.xml)",overlayInnerStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"320px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(O,{size:16,className:"text-blue-500"})})})]}),e.jsx(p.input,{id:"sitemapUrl",type:"url",name:"sitemapUrl",value:a.sitemapUrl,onChange:U,placeholder:"e.g., https://example.com/sitemap.xml",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${i.sitemapUrl?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!i.sitemapUrl,"aria-describedby":i.sitemapUrl?"sitemapUrl-error":void 0}),i.sitemapUrl&&e.jsx("p",{id:"sitemapUrl-error",className:"text-red-500 text-xs mt-1",children:i.sitemapUrl})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"describeBrand",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Describe Your Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(p.textarea,{id:"describeBrand",name:"describeBrand",value:a.describeBrand,onChange:U,placeholder:"Describe your brand's tone and personality",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${i.describeBrand?"border-red-500":"border-gray-300"}`,rows:"4",whileFocus:{scale:1.01},"aria-invalid":!!i.describeBrand,"aria-describedby":i.describeBrand?"describeBrand-error":void 0}),i.describeBrand&&e.jsx("p",{id:"describeBrand-error",className:"text-red-500 text-xs mt-1",children:i.describeBrand})]}),e.jsx("div",{className:"text-right",children:e.jsx(p.button,{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:H,whileHover:{scale:1.03,y:-2},whileTap:{scale:.98},disabled:w,"aria-label":a._id?"Update Brand Voice":"Save Brand Voice",children:w?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"animate-spin w-4 h-4"}),"Saving..."]}):a._id?"Update Brand Voice":"Save Brand Voice"})})]})]}),e.jsxs(p.div,{className:"w-full lg:w-[40%] bg-white rounded-xl p-6 shadow-lg border border-gray-100",initial:{x:20},animate:{x:0},children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Your Brand Voices"}),e.jsx("div",{className:"space-y-3 overflow-y-auto max-h-[calc(100vh-200px)]",children:j.length>0?j.map(r=>{var t;return e.jsx(me,{id:r._id,brandName:r.nameOfVoice,brandVoice:r.describeBrand,onSelect:()=>M(r),isSelected:((t=a.selectedVoice)==null?void 0:t._id)===r._id,onEdit:n=>{n.stopPropagation(),q(r)},onDelete:n=>{n.stopPropagation(),A(r)}},r._id)}):e.jsx("div",{className:"p-6 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center text-gray-500 text-sm",children:"No brand voices created yet. Start by adding one on the left."})})]})]})},me=({id:c,brandName:s,brandVoice:o,onSelect:y,isSelected:w,onEdit:N,onDelete:a})=>e.jsxs(p.div,{className:`p-4 mt-2 rounded-xl cursor-pointer transition-all ${w?"bg-gradient-to-r from-indigo-100 to-purple-100 border-2 border-indigo-300 shadow-md":"bg-white border border-gray-200 hover:bg-gray-50"}`,onClick:y,whileHover:{y:-2,boxShadow:"0 4px 15px rgba(99, 64, 241, 0.1)"},whileTap:{scale:.98},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},role:"button",tabIndex:0,onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),y())},"aria-label":`Select ${s} brand voice`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:`font-medium text-sm ${w?"text-indigo-700":"text-gray-700"} truncate max-w-[70%]`,children:s}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(p.button,{className:"text-indigo-500 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 rounded",whileHover:{scale:1.1},whileTap:{scale:.9},onClick:N,"aria-label":`Edit ${s}`,title:"Edit",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(p.button,{className:"text-gray-500 hover:text-red-400 focus:outline-none focus:ring-2 focus:ring-red-300 rounded",whileHover:{scale:1.1},whileTap:{scale:.9},onClick:a,"aria-label":`Delete ${s}`,title:"Delete",children:e.jsx("img",{src:"/Images/trash.png",alt:"Delete",className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-3",children:o})]});export{we as default};
