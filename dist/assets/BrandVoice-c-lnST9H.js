import{a as I,u as W,U as R,aA as U,Q as u,aB as M,aC as Y,P as G,aD as Q,aE as X,j as e,m as l,H as J,T as C}from"./index-BiN8l-P3.js";import{b as i}from"./chunk-tiptap-DcNQbKmZ.js";import{F as Z,a as ee}from"./index-D27S51U-.js";import{I as S}from"./info-nm78sSb2.js";import{L as D}from"./loader-circle-CCuhjSsF.js";import{U as ae}from"./upload-DsYQhgpU.js";import"./iconBase-BtU3R73c.js";import"./createLucideIcon-Cn4USsaF.js";const me=()=>{const k=I(a=>a.auth.user),o=W(),[b,y]=i.useState(""),[v,N]=i.useState(!1),[r,d]=i.useState({nameOfVoice:"",postLink:"",keywords:[],describeBrand:"",sitemapUrl:"",selectedVoice:null,_id:void 0}),[t,x]=i.useState({}),{brands:g,siteInfo:p}=I(a=>a.brand),[j,L]=i.useState(""),[F,h]=i.useState(!1);i.useEffect(()=>{o(R())},[o]),i.useEffect(()=>{g.length>0&&!r.selectedVoice&&d(a=>({...a,selectedVoice:g[0]}))},[g]),i.useEffect(()=>(r._id||w(),()=>{w(),o(U())}),[o]),i.useEffect(()=>{p.data&&!F&&(d(a=>({...a,nameOfVoice:p.data.nameOfVoice||a.nameOfVoice,describeBrand:p.data.describeBrand||a.describeBrand,keywords:p.data.keywords||a.keywords,postLink:p.data.postLink||a.postLink,sitemapUrl:p.data.sitemap||a.sitemapUrl})),x(a=>({...a,nameOfVoice:void 0,describeBrand:void 0,keywords:void 0,postLink:void 0,sitemapUrl:void 0})),L(r.postLink)),p.error&&u.error("Failed to fetch site info. Please try a different URL.")},[p,r.postLink,F]);const w=i.useCallback(()=>{d({nameOfVoice:"",postLink:"",keywords:[],describeBrand:"",sitemapUrl:"",selectedVoice:g[0]||null,_id:void 0}),y(""),x({}),L(""),h(!0)},[g]),O=i.useCallback(()=>{const a={};if(r.nameOfVoice.trim()||(a.nameOfVoice="Name of Voice is required."),!r.postLink.trim())a.postLink="Post link is required.";else try{new URL(r.postLink)}catch{a.postLink="Please enter a valid URL (e.g., https://example.com)."}if(r.keywords.length===0&&(a.keywords="At least one keyword is required."),r.describeBrand.trim()||(a.describeBrand="Brand description is required."),!r.sitemapUrl.trim())a.sitemapUrl="Sitemap URL is required.";else try{new URL(r.sitemapUrl)}catch{a.sitemapUrl="Please enter a valid URL (e.g., https://example.com/sitemap.xml)."}return x(a),Object.keys(a).length===0},[r]),V=i.useCallback(a=>{const{name:s,value:n}=a.target;d(m=>({...m,[s]:n})),x(m=>({...m,[s]:void 0})),s==="postLink"&&n!==j&&L(""),h(!1)},[j]),T=i.useCallback(a=>{if(a.key==="Enter"&&b.trim()){a.preventDefault();const s=r.keywords.map(c=>c.toLowerCase()),n=new Set,m=b.split(",").map(c=>c.trim()).filter(c=>{const B=c.toLowerCase();return!c||s.includes(B)||n.has(B)?!1:(n.add(B),!0)});if(m.length===0)return;d(c=>({...c,keywords:[...c.keywords,...m]})),y(""),x(c=>({...c,keywords:void 0})),h(!1)}},[b,r.keywords]),E=i.useCallback(a=>{d(s=>({...s,keywords:s.keywords.filter(n=>n!==a)})),h(!1)},[]),_=i.useCallback(a=>{const s=a.target.files[0];if(!s)return;if(!s.name.toLowerCase().endsWith(".csv")){u.error("Invalid file type. Please upload a .csv file."),a.target.value=null;return}const n=20*1024;if(s.size>n){u.error("File size exceeds 20KB limit. Please upload a smaller file."),a.target.value=null;return}if(s.type!=="text/csv"){u.error("Please upload a valid CSV file."),a.target.value=null;return}const m=new FileReader;m.onload=c=>{const A=c.target.result.split(/,|\n|;/).map(f=>f.trim()).filter(f=>f.length>0);d(f=>({...f,keywords:[...new Set([...f.keywords,...A])]})),x(f=>({...f,keywords:void 0})),h(!1)},m.onerror=()=>u.error("Error reading CSV file."),m.readAsText(s),a.target.value=null},[]),P=i.useCallback(async()=>{if(!O())return;N(!0);const a={nameOfVoice:r.nameOfVoice.trim(),postLink:r.postLink.trim(),keywords:r.keywords.map(s=>s.trim()).filter(Boolean),describeBrand:r.describeBrand.trim(),sitemap:r.sitemapUrl.trim(),userId:k==null?void 0:k._id};try{r._id?await o(M({id:r._id,payload:a})).unwrap():await o(Y({payload:a})).unwrap(),w(),o(R()),o(U())}catch(s){console.error("Error saving brand voice:",s),u.error(r._id?"Failed to update brand voice.":"Failed to create brand voice.")}finally{N(!1)}},[r,k,o,O,w]),$=i.useCallback(a=>{d({nameOfVoice:a.nameOfVoice||"",postLink:a.postLink||"",keywords:Array.isArray(a.keywords)?a.keywords:[],describeBrand:a.describeBrand||"",sitemapUrl:a.sitemap||"",selectedVoice:a,_id:a._id}),x({}),L(a.postLink||""),h(!1)},[]),z=i.useCallback(a=>{G.confirm({title:"Delete Brand Voice?",content:"Are you sure you want to delete this brand voice? This action cannot be undone.",okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>{o(Q({id:a._id})).unwrap().then(()=>{var s;((s=r.selectedVoice)==null?void 0:s._id)===a._id&&(w(),o(U()))}).catch(()=>u.error("Failed to delete brand voice."))}})},[o,r.selectedVoice,w]),H=i.useCallback(a=>{d(s=>({...s,selectedVoice:a})),h(!1)},[]),K=i.useCallback(()=>{const a=r.postLink.trim();if(!a){x(s=>({...s,postLink:"Post link is required to fetch site info."}));return}if(a===j){u.info("This URL has already been fetched.");return}try{new URL(a),o(X(a)).unwrap().then(()=>{h(!1)}).catch(()=>u.error("Failed to fetch site info. Please try a different URL."))}catch{x(s=>({...s,postLink:"Please enter a valid URL (e.g., https://example.com)."}))}},[r.postLink,j,o]),q=i.useMemo(()=>{const a=r.keywords.slice(-3),s=r.keywords.length-a.length;return e.jsxs(e.Fragment,{children:[s>0&&e.jsx(l.div,{className:"flex items-center bg-indigo-100 text-indigo-700 rounded-md px-2 py-1 mr-2",initial:{scale:.8},animate:{scale:1},title:`+${s} more keywords`,children:e.jsx("span",{className:"text-sm",children:`+${s}`})}),a.map(n=>e.jsxs(l.div,{className:"flex items-center bg-indigo-100 text-indigo-700 rounded-md px-2 py-1 mr-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,scale:.8},whileHover:{scale:1.05},children:[e.jsx("span",{className:"text-sm truncate max-w-[100px]",children:n}),e.jsx(Z,{className:"ml-1 cursor-pointer text-indigo-500 hover:text-indigo-700 transition-colors",onClick:m=>{m.stopPropagation(),E(n)},"aria-label":`Remove ${n}`})]},n))]})},[r.keywords,E]);return e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col lg:flex-row gap-6 p-4 lg:p-6 max-w-7xl mx-auto",children:[e.jsx(J,{children:e.jsx("title",{children:"Brand Voice | GenWrite"})}),e.jsxs(l.div,{className:"w-full lg:w-[60%] bg-white rounded-xl p-6 shadow-lg border border-gray-100",initial:{x:-20},animate:{x:0},children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Create Your Brand Voice"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Define your brand's unique tone and style to ensure consistent content creation."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"postLink",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Post or Blog Link ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(C,{title:"Add a link of your home page to fetch site info",overlayInnerStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"220px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(S,{size:16,className:"text-blue-500"})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l.input,{id:"postLink",type:"url",name:"postLink",value:r.postLink,onChange:V,placeholder:"e.g., https://example.com/blog",className:`flex-grow p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${t.postLink?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!t.postLink,"aria-describedby":t.postLink?"postLink-error":void 0}),e.jsx(l.button,{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:K,whileHover:{scale:1.03},whileTap:{scale:.98},disabled:p.loading||r.postLink&&r.postLink===j,"aria-label":"Fetch Site Info",children:p.loading?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"animate-spin w-4 h-4"}),"Fetching..."]}):"Fetch Site Info"})]}),t.postLink&&e.jsx("p",{id:"postLink-error",className:"text-red-500 text-xs mt-1",children:t.postLink})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"nameOfVoice",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Name of Voice ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l.input,{id:"nameOfVoice",type:"text",name:"nameOfVoice",value:r.nameOfVoice,onChange:V,placeholder:"e.g., Friendly Tech",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${t.nameOfVoice?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!t.nameOfVoice,"aria-describedby":t.nameOfVoice?"nameOfVoice-error":void 0}),t.nameOfVoice&&e.jsx("p",{id:"nameOfVoice-error",className:"text-red-500 text-xs mt-1",children:t.nameOfVoice})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"keywords",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Keywords ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(C,{title:"Upload a .csv file in the format: `Keyword` as header",overlayInnerStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"220px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(S,{size:16,className:"text-blue-500"})})})]}),e.jsxs(l.div,{className:`flex items-center bg-white border rounded-lg p-2 flex-wrap gap-2 ${t.keywords?"border-red-500":"border-gray-300"}`,whileHover:{boxShadow:"0 0 0 3px rgba(99, 102, 241, 0.2)"},children:[q,e.jsx("input",{id:"keywords",type:"text",value:b,onChange:a=>y(a.target.value),onKeyDown:T,className:"flex-grow p-2 bg-transparent border-none outline-none text-sm",placeholder:"Type a keyword and press Enter","aria-describedby":t.keywords?"keywords-error":void 0}),e.jsx("label",{htmlFor:"file-upload",className:"flex items-center cursor-pointer",children:e.jsx(l.div,{className:"bg-indigo-100 p-2 rounded-lg",whileHover:{scale:1.1},whileTap:{scale:.95},"aria-label":"Upload CSV file",children:e.jsx(ae,{size:20,className:"text-indigo-600"})})}),e.jsx("input",{id:"file-upload",type:"file",className:"hidden",onChange:_,accept:".csv"})]}),t.keywords&&e.jsx("p",{id:"keywords-error",className:"text-red-500 text-xs mt-1",children:t.keywords})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"sitemapUrl",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Sitemap URL ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(C,{title:"Paste the URL of your XML sitemap (e.g., https://example.com/sitemap.xml)",overlayInnerStyle:{backgroundColor:"#4169e1",color:"#fff",borderRadius:"8px",padding:"8px 12px",fontSize:"13px",maxWidth:"320px"},children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(S,{size:16,className:"text-blue-500"})})})]}),e.jsx(l.input,{id:"sitemapUrl",type:"url",name:"sitemapUrl",value:r.sitemapUrl,onChange:V,placeholder:"e.g., https://example.com/sitemap.xml",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${t.sitemapUrl?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!t.sitemapUrl,"aria-describedby":t.sitemapUrl?"sitemapUrl-error":void 0}),t.sitemapUrl&&e.jsx("p",{id:"sitemapUrl-error",className:"text-red-500 text-xs mt-1",children:t.sitemapUrl})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"describeBrand",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Describe Your Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l.textarea,{id:"describeBrand",name:"describeBrand",value:r.describeBrand,onChange:V,placeholder:"Describe your brand's tone and personality",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${t.describeBrand?"border-red-500":"border-gray-300"}`,rows:"4",whileFocus:{scale:1.01},"aria-invalid":!!t.describeBrand,"aria-describedby":t.describeBrand?"describeBrand-error":void 0}),t.describeBrand&&e.jsx("p",{id:"describeBrand-error",className:"text-red-500 text-xs mt-1",children:t.describeBrand})]}),e.jsx("div",{className:"text-right",children:e.jsx(l.button,{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:P,whileHover:{scale:1.03,y:-2},whileTap:{scale:.98},disabled:v,"aria-label":r._id?"Update Brand Voice":"Save Brand Voice",children:v?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"animate-spin w-4 h-4"}),"Saving..."]}):r._id?"Update Brand Voice":"Save Brand Voice"})})]})]}),e.jsxs(l.div,{className:"w-full lg:w-[40%] bg-white rounded-xl p-6 shadow-lg border border-gray-100",initial:{x:20},animate:{x:0},children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Your Brand Voices"}),e.jsx("div",{className:"space-y-3 overflow-y-auto max-h-[calc(100vh-200px)]",children:g.length>0?g.map(a=>{var s;return e.jsx(re,{id:a._id,brandName:a.nameOfVoice,brandVoice:a.describeBrand,onSelect:()=>H(a),isSelected:((s=r.selectedVoice)==null?void 0:s._id)===a._id,onEdit:n=>{n.stopPropagation(),$(a)},onDelete:n=>{n.stopPropagation(),z(a)}},a._id)}):e.jsx("div",{className:"p-6 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center text-gray-500 text-sm",children:"No brand voices created yet. Start by adding one on the left."})})]})]})},re=({id:k,brandName:o,brandVoice:b,onSelect:y,isSelected:v,onEdit:N,onDelete:r})=>e.jsxs(l.div,{className:`p-4 mt-2 rounded-xl cursor-pointer transition-all ${v?"bg-gradient-to-r from-indigo-100 to-purple-100 border-2 border-indigo-300 shadow-md":"bg-white border border-gray-200 hover:bg-gray-50"}`,onClick:y,whileHover:{y:-2,boxShadow:"0 4px 15px rgba(99, 64, 241, 0.1)"},whileTap:{scale:.98},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},role:"button",tabIndex:0,onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),y())},"aria-label":`Select ${o} brand voice`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:`font-medium text-sm ${v?"text-indigo-700":"text-gray-700"} truncate max-w-[70%]`,children:o}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l.button,{className:"text-indigo-500 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 rounded",whileHover:{scale:1.1},whileTap:{scale:.9},onClick:N,"aria-label":`Edit ${o}`,title:"Edit",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx(l.button,{className:"text-gray-500 hover:text-red-400 focus:outline-none focus:ring-2 focus:ring-red-300 rounded",whileHover:{scale:1.1},whileTap:{scale:.9},onClick:r,"aria-label":`Delete ${o}`,title:"Delete",children:e.jsx("img",{src:"/Images/trash.png",alt:"Delete",className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-3",children:b})]});export{me as default};
