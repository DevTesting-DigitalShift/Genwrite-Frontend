import{b as C,a as I,a1 as F,B as k,bR as P,bS as K,bT as R,bU as X,j as e,m as l,H as q,T as L,bp as A}from"./index-C7J8zzTe.js";import{b as o}from"./chunk-tiptap-DryasWDK.js";import{F as z,a as Y}from"./index-C46stefG.js";import{I as S,U as E}from"./upload-Bo7a4THC.js";import"./iconBase-D2YiqqgH.js";const re=()=>{const f=C(a=>a.auth.user),d=I(),[h,g]=o.useState(""),[y,j]=o.useState(!1),[b,p]=o.useState(null),[s,m]=o.useState({nameOfVoice:"",postLink:"",keywords:[],describeBrand:"",selectedVoice:null,uploadedFile:null,_id:void 0}),[t,c]=o.useState({}),{brands:w,selectedVoice:G}=C(a=>a.brand);o.useEffect(()=>{d(F())},[d]),o.useEffect(()=>{w.length>0&&!s.selectedVoice&&m(a=>({...a,selectedVoice:w[0]}))},[w]);const V=o.useCallback(()=>{const a={};if(s.nameOfVoice.trim()||(a.nameOfVoice="Name of Voice is required."),!s.postLink.trim())a.postLink="Post link is required.";else try{new URL(s.postLink)}catch{a.postLink="Please enter a valid URL."}return s.keywords.length===0&&(a.keywords="At least one keyword is required."),s.describeBrand.trim()||(a.describeBrand="Brand description is required."),b||(a.sitemap="Excel file is required."),c(a),Object.keys(a).length===0},[s,b]),v=o.useCallback(a=>{const{name:r,value:i}=a.target;m(n=>({...n,[r]:i})),c(n=>({...n,[r]:void 0}))},[]),O=o.useCallback(a=>{a.key==="Enter"&&h.trim()&&(a.preventDefault(),m(r=>({...r,keywords:[...new Set([...r.keywords,h.trim()])]})),g(""),c(r=>({...r,keywords:void 0})))},[h]),B=o.useCallback(a=>{m(r=>({...r,keywords:r.keywords.filter(i=>i!==a)}))},[]),T=o.useCallback(a=>{const r=a.target.files[0];if(r&&r.type==="text/csv"){const i=new FileReader;i.onload=n=>{const u=n.target.result.split(/,|\n|;/).map(x=>x.trim()).filter(x=>x.length>0);m(x=>({...x,uploadedFile:r.name,keywords:[...new Set([...x.keywords,...u])]})),c(x=>({...x,keywords:void 0}))},i.onerror=()=>k.error("Error reading CSV file."),i.readAsText(r)}else k.error("Please upload a valid CSV file.")},[]),D=o.useCallback(a=>{const r=a.target.files[0];if(!r)return;if(r.type!=="text/xml"&&!r.name.endsWith(".xml")){k.error("Please upload a valid XML file."),c(n=>({...n,sitemap:"Invalid file type, only .xml allowed."}));return}const i=new FileReader;i.onload=n=>{try{const N=n.target.result;p(N),m(u=>({...u,uploadedFile:r.name})),c(u=>({...u,sitemap:void 0}))}catch{k.error("Error processing XML file."),c(u=>({...u,sitemap:"Failed to process XML file."}))}},i.onerror=()=>{k.error("Error reading XML file."),c(n=>({...n,sitemap:"Failed to read XML file."}))},i.readAsText(r)},[]),_=o.useCallback(async()=>{if(!V())return;j(!0);const a={nameOfVoice:s.nameOfVoice.trim(),postLink:s.postLink.trim(),keywords:s.keywords.map(n=>n.trim()).filter(Boolean),describeBrand:s.describeBrand.trim(),siteMap:b,userId:f==null?void 0:f._id},r=()=>{m({nameOfVoice:"",postLink:"",keywords:[],describeBrand:"",selectedVoice:null,uploadedFile:null,_id:void 0}),p(null),g(""),c({})},i=()=>{d(F()),r()};s._id?d(P({id:s._id,payload:a,onSuccess:i})):d(K({payload:a,onSuccess:i})),j(!1)},[s,b,f,d,V]),$=o.useCallback(a=>{m({nameOfVoice:a.nameOfVoice||"",postLink:a.postLink||"",keywords:Array.isArray(a.keywords)?a.keywords:[],describeBrand:a.describeBrand||"",selectedVoice:a,uploadedFile:null,_id:a._id}),p(a.siteMap||null),c({})},[]),U=o.useCallback(a=>{R.confirm({title:"Delete Brand Voice?",content:"Are you sure you want to delete this brand voice? This action cannot be undone.",okText:"Delete",cancelText:"Cancel",okButtonProps:{danger:!0},onOk:()=>{d(X({id:a._id}))}})},[d]),H=o.useCallback(a=>{m(r=>({...r,selectedVoice:a}))},[]),M=o.useMemo(()=>{const a=s.keywords.slice(-3),r=s.keywords.length-a.length;return e.jsxs(e.Fragment,{children:[r>0&&e.jsx(l.div,{className:"flex items-center bg-indigo-100 text-indigo-700 rounded-md px-2 py-1 mr-2",initial:{scale:.8},animate:{scale:1},title:`+${r} more keywords`,children:e.jsx("span",{className:"text-sm",children:`+${r}`})}),a.map(i=>e.jsxs(l.div,{className:"flex items-center bg-indigo-100 text-indigo-700 rounded-md px-2 py-1 mr-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,scale:.8},whileHover:{scale:1.05},children:[e.jsx("span",{className:"text-sm truncate max-w-[100px]",children:i}),e.jsx(z,{className:"ml-1 cursor-pointer text-indigo-500 hover:text-indigo-700 transition-colors",onClick:n=>{n.stopPropagation(),B(i)},"aria-label":`Remove ${i}`})]},i))]})},[s.keywords,B]);return e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col lg:flex-row gap-6 p-4 lg:p-6 max-w-7xl mx-auto",children:[e.jsx(q,{children:e.jsx("title",{children:"Brand Voice | GenWrite"})}),e.jsxs(l.div,{className:"w-full lg:w-[60%] bg-white rounded-xl p-6 shadow-lg border border-gray-100",initial:{x:-20},animate:{x:0},children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Create Your Brand Voice"}),e.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Define your brand's unique tone and style to ensure consistent content creation."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"nameOfVoice",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Name of Voice ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l.input,{id:"nameOfVoice",type:"text",name:"nameOfVoice",value:s.nameOfVoice,onChange:v,placeholder:"e.g., Friendly Tech",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${t.nameOfVoice?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!t.nameOfVoice,"aria-describedby":t.nameOfVoice?"nameOfVoice-error":void 0}),t.nameOfVoice&&e.jsx("p",{id:"nameOfVoice-error",className:"text-red-500 text-xs mt-1",children:t.nameOfVoice})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"postLink",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Post or Blog Link ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l.input,{id:"postLink",type:"url",name:"postLink",value:s.postLink,onChange:v,placeholder:"e.g., https://example.com/blog",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${t.postLink?"border-red-500":"border-gray-300"}`,whileFocus:{scale:1.01},"aria-invalid":!!t.postLink,"aria-describedby":t.postLink?"postLink-error":void 0}),t.postLink&&e.jsx("p",{id:"postLink-error",className:"text-red-500 text-xs mt-1",children:t.postLink})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"keywords",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Keywords ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(L,{title:"Enter keywords or upload a .csv file with format: S.No., Keyword",children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(S,{size:16,className:"text-blue-500"})})})]}),e.jsxs(l.div,{className:`flex items-center bg-white border rounded-lg p-2 flex-wrap gap-2 ${t.keywords?"border-red-500":"border-gray-300"}`,whileHover:{boxShadow:"0 0 0 3px rgba(99, 102, 241, 0.2)"},children:[M,e.jsx("input",{id:"keywords",type:"text",value:h,onChange:a=>g(a.target.value),onKeyDown:O,className:"flex-grow p-2 bg-transparent border-none outline-none text-sm",placeholder:"Type a keyword and press Enter","aria-describedby":t.keywords?"keywords-error":void 0}),e.jsx("label",{htmlFor:"file-upload",className:"flex items-center cursor-pointer",children:e.jsx(l.div,{className:"bg-indigo-100 p-2 rounded-lg",whileHover:{scale:1.1},whileTap:{scale:.95},"aria-label":"Upload CSV file",children:e.jsx(E,{size:20,className:"text-indigo-600"})})}),e.jsx("input",{id:"file-upload",type:"file",className:"hidden",onChange:T,accept:".csv"})]}),t.keywords&&e.jsx("p",{id:"keywords-error",className:"text-red-500 text-xs mt-1",children:t.keywords})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"file-site-upload",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Sitemap (XML File) ",e.jsx("span",{className:"text-red-500",children:"*"}),e.jsx(L,{title:"Upload an XML file (.xml) with sitemap data",children:e.jsx("span",{className:"cursor-pointer",children:e.jsx(S,{size:16,className:"text-blue-500"})})})]}),e.jsxs(l.label,{htmlFor:"file-site-upload",className:`flex items-center justify-between bg-white border rounded-lg p-2 gap-2 hover:ring-2 hover:ring-indigo-300 transition-all ${t.sitemap?"border-red-500":"border-gray-300"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx("span",{className:"text-gray-700 text-sm truncate",children:s.uploadedFile?s.uploadedFile:"Choose .xml file"}),e.jsx(l.div,{className:"bg-indigo-100 p-2 rounded-lg cursor-pointer",whileHover:{scale:1.1},whileTap:{scale:.95},"aria-label":"Upload Excel file",children:e.jsx(E,{size:20,className:"text-indigo-600"})}),e.jsx("input",{id:"file-site-upload",type:"file",accept:".xml",onChange:D,className:"hidden"})]}),t.sitemap&&e.jsx("p",{id:"sitemap-error",className:"text-red-500 text-xs mt-1",children:t.sitemap})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"describeBrand",className:"text-sm font-medium text-gray-700 flex gap-2 mb-1",children:["Describe Your Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l.textarea,{id:"describeBrand",name:"describeBrand",value:s.describeBrand,onChange:v,placeholder:"Describe your brand's tone and personality",className:`w-full p-3 border rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${t.describeBrand?"border-red-500":"border-gray-300"}`,rows:"4",whileFocus:{scale:1.01},"aria-invalid":!!t.describeBrand,"aria-describedby":t.describeBrand?"describeBrand-error":void 0}),t.describeBrand&&e.jsx("p",{id:"describeBrand-error",className:"text-red-500 text-xs mt-1",children:t.describeBrand})]}),e.jsx("div",{className:"text-right",children:e.jsx(l.button,{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:_,whileHover:{scale:1.03,y:-2},whileTap:{scale:.98},disabled:y,"aria-label":s._id?"Update Brand Voice":"Save Brand Voice",children:y?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"animate-spin w-4 h-4"}),"Saving..."]}):s._id?"Update Brand Voice":"Save Brand Voice"})})]})]}),e.jsxs(l.div,{className:"w-full lg:w-[40%] bg-white rounded-xl p-6 shadow-lg border border-gray-100",initial:{x:20},animate:{x:0},children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Your Brand Voices"}),e.jsx("div",{className:"space-y-3 overflow-y-auto max-h-[calc(100vh-200px)]",children:w.length>0?w.map(a=>{var r;return e.jsx(W,{id:a._id,brandName:a.nameOfVoice,brandVoice:a.describeBrand,onSelect:()=>H(a),isSelected:((r=s.selectedVoice)==null?void 0:r._id)===a._id,onEdit:i=>{i.stopPropagation(),$(a)},onDelete:i=>{i.stopPropagation(),U(a)}},a._id)}):e.jsx("div",{className:"p-6 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center text-gray-500 text-sm",children:"No brand voices created yet. Start by adding one on the left."})})]})]})},W=({id:f,brandName:d,brandVoice:h,onSelect:g,isSelected:y,onEdit:j,onDelete:b})=>e.jsxs(l.div,{className:`p-4 mt-2 rounded-xl cursor-pointer transition-all ${y?"bg-gradient-to-r from-indigo-100 to-purple-100 border-2 border-indigo-300 shadow-md":"bg-white border border-gray-200 hover:bg-gray-50"}`,onClick:g,whileHover:{y:-2,boxShadow:"0 4px 15px rgba(99, 64, 241, 0.1)"},whileTap:{scale:.98},initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},role:"button",tabIndex:0,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),g())},"aria-label":`Select ${d} brand voice`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:`font-medium text-sm ca ${y?"text-indigo-700":"text-gray-700"} truncate max-w-[70%]`,children:d}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l.button,{className:"text-indigo-500 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-300 rounded",whileHover:{scale:1.1},whileTap:{scale:.9},onClick:j,"aria-label":`Edit ${d}`,title:"Edit",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx(l.button,{className:"text-gray-500 hover:text-red-400 focus:outline-none focus:ring-2 focus:ring-red-300 rounded",whileHover:{scale:1.1},whileTap:{scale:.9},onClick:b,"aria-label":`Delete ${d}`,title:"Delete",children:e.jsx("img",{src:"/Images/trash.png",alt:"Delete",className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-3",children:h})]});export{re as default};
